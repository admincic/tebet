<link rel="stylesheet" type="text/css" media="all" href="style.css" />
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="TEHUAN para el CIC es una red de confianza 100% ciudadana que enlaza e integra al ciudadano y las autoridades por medio de espacios claros." />
<meta name="keywords" content="CIC,TEHUAN,CICMty,Tehuan,Monterrey">
<meta name="author" content="Jesús Cepeda (@chuycepeda), Jesús Del Bosque (@chuydb)">
<title>CIC || Tehuan V3</title>
<!-- CSS References -->
<link rel="shortcut icon" href="http://mitehuan.cic.mx/wp-content/themes/mitehuan/images/favicon.ico">
<link rel="stylesheet" type="text/css" href="introjs.css"/>
<link rel="stylesheet" type="text/css" href="http://libs.cartocdn.com/cartodb.js/v2/themes/css/cartodb.css" />
<link rel="stylesheet" type="text/css" href="jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" />
<!-- <link rel="stylesheet" type="text/css" href="css/prettyPhoto.css" media="screen" title="prettyPhoto main stylesheet" charset="utf-8" /> -->

<!-- JS References -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=drawing,places"></script>
<script src="http://code.jquery.com/jquery.js"></script> 
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="http://libs.cartocdn.com/cartodb.js/v2/cartodb.js"></script>
<script src="jquery.raptorize.1.0.js"></script>
<script src="jquery.searchMeme.js" ></script>
<script src="jquery.prettyphoto.js"></script>
<script src="spin.js"></script>
<script src="intro.js"></script>
<script src="WordleUtils.js" ></script>
<script src="Wordle.js"></script>
<script src="highcharts.js"></script>
<script src="highcharts-more.js" type="text/javascript"></script>
<script src="funnel.js" type="text/javascript"></script>
<script src="exporting.js"></script>
<script src="regression.js"></script>
<script src="lib/dat.gui.min.js"></script>
<script src="lib/underscore-min.js"></script>
<script src="lib/backbone.js"></script>
<script src="lib/class.js"></script>
<script src="lib/backbone.cartodb.js"></script>
<script src="src/canvas_tile_layer.js"></script>
<script src="src/grid_layer.js"></script>
<script src="src/torque.js"></script>
<script src="d3.min.js"></script>
<script src="d3.layout.min.js"></script>
<script src="date.js"></script>
<!-- PRETTYPHOTO PLUGIN -->
<!-- <script type="text/javascript" charset="utf-8">$(document).ready(function(){ $("a[rel^='prettyPhoto']").prettyPhoto(); });</script> -->
<!-- GOOGLE ANALYTICS -->
<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-23321310-3']);
  _gaq.push(['_setDomainName', 'cic.mx']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
<!-- BROWSER DETECTION -->
<script type="text/javascript">
	var BrowserDetect = {
	init: function () {
		this.browser = this.searchString(this.dataBrowser) || "An unknown browser";
		this.version = this.searchVersion(navigator.userAgent)
			|| this.searchVersion(navigator.appVersion)
			|| "an unknown version";
		this.OS = this.searchString(this.dataOS) || "an unknown OS";
		console.log(this.browser + ", " + this.version + "; running in " + this.OS);
		if (this.browser != 'Chrome' && this.browser != 'Safari' && this.browser != 'Firefox'){ alert("Este sistema ha sido diseñado en plataformas diferentes a la tuya, te recomendamos la descarga de Google Chrome para tener una mejor experienca.")}
	},
	searchString: function (data) {
		for (var i=0;i<data.length;i++)	{
			var dataString = data[i].string;
			var dataProp = data[i].prop;
			this.versionSearchString = data[i].versionSearch || data[i].identity;
			if (dataString) {
				if (dataString.indexOf(data[i].subString) != -1)
					return data[i].identity;
			}
			else if (dataProp)
				return data[i].identity;
		}
	},
	searchVersion: function (dataString) {
		var index = dataString.indexOf(this.versionSearchString);
		if (index == -1) return;
		return parseFloat(dataString.substring(index+this.versionSearchString.length+1));
	},
	dataBrowser: [
		{
			string: navigator.userAgent,
			subString: "Chrome",
			identity: "Chrome"
		},
		{ 	string: navigator.userAgent,
			subString: "OmniWeb",
			versionSearch: "OmniWeb/",
			identity: "OmniWeb"
		},
		{
			string: navigator.vendor,
			subString: "Apple",
			identity: "Safari",
			versionSearch: "Version"
		},
		{
			prop: window.opera,
			identity: "Opera",
			versionSearch: "Version"
		},
		{
			string: navigator.vendor,
			subString: "iCab",
			identity: "iCab"
		},
		{
			string: navigator.vendor,
			subString: "KDE",
			identity: "Konqueror"
		},
		{
			string: navigator.userAgent,
			subString: "Firefox",
			identity: "Firefox"
		},
		{
			string: navigator.vendor,
			subString: "Camino",
			identity: "Camino"
		},
		{		// for newer Netscapes (6+)
			string: navigator.userAgent,
			subString: "Netscape",
			identity: "Netscape"
		},
		{
			string: navigator.userAgent,
			subString: "MSIE",
			identity: "Explorer",
			versionSearch: "MSIE"
		},
		{
			string: navigator.userAgent,
			subString: "Gecko",
			identity: "Mozilla",
			versionSearch: "rv"
		},
		{ 		// for older Netscapes (4-)
			string: navigator.userAgent,
			subString: "Mozilla",
			identity: "Netscape",
			versionSearch: "Mozilla"
		}
	],
	dataOS : [
		{
			string: navigator.platform,
			subString: "Win",
			identity: "Windows"
		},
		{
			string: navigator.platform,
			subString: "Mac",
			identity: "Mac"
		},
		{
			   string: navigator.userAgent,
			   subString: "iPhone",
			   identity: "iPhone/iPod"
	    },
		{
			string: navigator.platform,
			subString: "Linux",
			identity: "Linux"
		}
	]

};

</script>
<!-- CONFIGURATION VARS -->
<script type="text/javascript">
	/* ACCOUNT-DEPENDING CONFIGURATIONS */
	var sourceurl = "http://cic-workshop.biz/testing/"; //Change to source url for marker images
	var sql = new cartodb.SQL({ user: 'cicadmin' });
	var disqus_dashboard = 'tehuan-beta';
	var mapCenter = [25.672938,-100.309296];
	var table_name = 'cic_reports';
	var accountURL = 'nl.cic.mx';
	var accountAPI = 'http://api.cic.mx/ushahidi/nl/api/';
	var area_name = 'mun_poly';
	var twitterID = ["347783020163518464", "347787216354942976", "348846254127726592", "348817018734137344", "348817444414033922", "347786457651503104", "348817995189075971", "348818811291570177", "348819099444453376", "348819379582017539", "348819636558635008", "348819863118159873", "348820099265884160", "348820315805216769"];
	var twitterName = ["Cicmty", "viaCICmty", "spuCICmty", "comCICmty", "emeCICmty", "segCICmty", "segCICsp", "segCICgpe", "segCICsn", "segCICapo", "segCICesc", "segCICgar", "segCICcad", "segCICsc"];
	/* ADDITIONING CATEGORIES/MUNICIPALITIES/FILTER-DEPENDING CONFIGURATIONS */
    var categories = {
		  avisos : false,
		  eventos : false,
		  observador : false,
		  pcomunidad : false,
		  pseguridad : false,
		  pservicios : false,
		  pvialidad : false,
		  incendio : false,
		  robo : false,
		  sitriesgo : false,
		  alcantarillas : false,
		  alumbrado : false,
		  electricidad : false,
		  fuga : false,
		  parques : false,
		  basura : false,
		  accidente : false,
		  bache : false,
		  obras : false,
		  semaforo : false,
		  emergencias : false
	  };
    var mun = {
	  	  mty : false,
	  	  sp : false,
	  	  sn : false,
	  	  sc : false,
	  	  gpe : false,
	  	  apo : false,
	  	  esc : false,
	  	  jua : false,
	  	  gar : false,
	  	  cad : false,
	  	  stg : false
	};
    var publicServices = ['ALCANTARILLAS','ALUMBRADO PUBLICO','BACHE O VIA DAÑADA','FALTA ELECTRICIDAD','FUGA','PARQUES DESCUIDADOS', 'RECOLECCION DE BASURA','SEMAFORO DESCOMPUESTO'];
	var reportOrigins = ['twitter', 'web', 'app', 'crm', 'email', 'sms'];
	/*
		OTHER THINGS THAT MUST BE HIDDEN OR FIXED ACCORDING TO CATEGORY or MUNICIPALITY CHANGES
		
		If any category is added or removed or has changed:
			_tyle_style
			_tyle_style_cluster
			getImg();
			updateCounters()
			updateActiveFilters()
			resetFilters()
			multipleCat()
			filterFromStat()
			displayScore()
			<div id="filtercate">
			
		If any municipality is added or changed	
			getFullName()
			displayStats()
			displayScore()
			<div id"score">
			<div id="filtercate">
		
		If categories, municipalities, or new filters:	
			-ONLOAD JQUERY CHECKBOXES FILTER ACTIVATION	
			-setQ()
			-resetFilters()
		
	*/

	/* STYLES & VIEWS */
    var activeView ='home';
    var loadTwitter = true;
    var _tile_style = "#{{table_name}}{[post_cat='ALCANTARILLAS']{marker-file: url('"+sourceurl+"images/markers/alcantarillas.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='ALUMBRADO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/alumbrado.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='FALTA ELECTRICIDAD']{marker-file: url('"+sourceurl+"images/markers/electricidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='FUGA']{marker-file: url('"+sourceurl+"images/markers/fuga.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='OTROS']{marker-file: url('"+sourceurl+"images/markers/otros.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='PARQUES DESCUIDADOS']{marker-file: url('"+sourceurl+"images/markers/parques.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'RECOLECCION DE BASURA']{marker-file: url('"+sourceurl+"images/markers/basura.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'ACCIDENTE']{marker-file: url('"+sourceurl+"images/markers/accidente.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'BACHE O VIA DAÑADA']{marker-file: url('"+sourceurl+"images/markers/bache.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'OBRAS Y/O VIA CERRADA']{marker-file: url('"+sourceurl+"images/markers/viacerrada.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'SEMAFORO DESCOMPUESTO']{marker-file: url('"+sourceurl+"images/markers/semaforo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/vialidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'INCENDIO']{marker-file: url('"+sourceurl+"images/markers/incendio.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'ROBO']{marker-file: url('"+sourceurl+"images/markers/robo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'SITUACION DE RIESGO']{marker-file: url('"+sourceurl+"images/markers/sitriesgo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA COMUNIDAD']{marker-file: url('"+sourceurl+"images/markers/pcomunidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA SEGURIDAD']{marker-file: url('"+sourceurl+"images/markers/pseguridad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA SERV PUBLICOS']{marker-file: url('"+sourceurl+"images/markers/pservpublicos.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/pvialidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'EMERGENCIAS']{marker-file: url('"+sourceurl+"images/markers/emergencia.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'AVISOS']{marker-file: url('"+sourceurl+"images/markers/aviso.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'EVENTO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/evento.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'OBSERVADOR CIUDADANO']{marker-file: url('"+sourceurl+"images/markers/obscdn.png'); marker-clip: false; marker-allow-overlap: true;}}";
	var _heatmap_style = "#{{table_name}}{marker-fill:#FFCC00;marker-width:12;marker-line-color:#FFF;marker-line-width:3;marker-line-opacity:0.9;marker-opacity:0.9;marker-comp-op:multiply;marker-type:ellipse;marker-placement:point;marker-allow-overlap:true;marker-clip:false;marker-multi-policy:largest;}";
	var _intensity_style = "#{{table_name}}{first/marker-fill:#0011cc;first/marker-opacity:0.01;first/marker-width:80;first/marker-line-width:0;first/marker-placement:point;first/marker-allow-overlap:true;first/marker-comp-op:lighten;second/marker-fill:#00cc11;second/marker-opacity:0.02;second/marker-width:50;second/marker-line-width:0;second/marker-placement:point;second/marker-allow-overlap:true;second/marker-comp-op:lighten;third/marker-fill:#00ff00;third/marker-opacity:0.04;third/marker-width:20;third/marker-line-width:0;third/marker-placement:point;third/marker-allow-overlap:true;third/marker-comp-op:lighten;}";
	var _tile_style_cluster = "#{{table_name}}{[post_cat='ALCANTARILLAS']{marker-file: url('"+sourceurl+"images/markers/alcantarillas.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat='ALUMBRADO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/alumbrado.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat='FALTA ELECTRICIDAD']{marker-file: url('"+sourceurl+"images/markers/electricidad.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat='FUGA']{marker-file: url('"+sourceurl+"images/markers/fuga.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat='OTROS']{marker-file: url('"+sourceurl+"images/markers/otros.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat='PARQUES DESCUIDADOS']{marker-file: url('"+sourceurl+"images/markers/parques.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'RECOLECCION DE BASURA']{marker-file: url('"+sourceurl+"images/markers/basura.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'ACCIDENTE']{marker-file: url('"+sourceurl+"images/markers/accidente.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'BACHE O VIA DAÑADA']{marker-file: url('"+sourceurl+"images/markers/bache.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'OBRAS Y/O VIA CERRADA']{marker-file: url('"+sourceurl+"images/markers/viacerrada.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'SEMAFORO DESCOMPUESTO']{marker-file: url('"+sourceurl+"images/markers/semaforo.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/vialidad.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'INCENDIO']{marker-file: url('"+sourceurl+"images/markers/incendio.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'ROBO']{marker-file: url('"+sourceurl+"images/markers/robo.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'SITUACION DE RIESGO']{marker-file: url('"+sourceurl+"images/markers/sitriesgo.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'PROPUESTA COMUNIDAD']{marker-file: url('"+sourceurl+"images/markers/pcomunidad.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'PROPUESTA SEGURIDAD']{marker-file: url('"+sourceurl+"images/markers/pseguridad.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'PROPUESTA SERV PUBLICOS']{marker-file: url('"+sourceurl+"images/markers/pservpublicos.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'PROPUESTA VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/pvialidad.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'EMERGENCIAS']{marker-file: url('"+sourceurl+"images/markers/emergencia.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'AVISOS']{marker-file: url('"+sourceurl+"images/markers/aviso.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'EVENTO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/evento.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'OBSERVADOR CIUDADANO']{marker-file: url('"+sourceurl+"images/markers/obscdn.png'); marker-clip: false; marker-allow-overlap: false;}}";
	var _tile_style_bubbles = "#{{table_name}}{[post_cat='ALCANTARILLAS']{marker-file: url('"+sourceurl+"images/markers/alcantarillas.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='ALUMBRADO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/alumbrado.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='FALTA ELECTRICIDAD']{marker-file: url('"+sourceurl+"images/markers/electricidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='FUGA']{marker-file: url('"+sourceurl+"images/markers/fuga.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='OTROS']{marker-file: url('"+sourceurl+"images/markers/otros.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat='PARQUES DESCUIDADOS']{marker-file: url('"+sourceurl+"images/markers/parques.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'RECOLECCION DE BASURA']{marker-file: url('"+sourceurl+"images/markers/basura.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'ACCIDENTE']{marker-file: url('"+sourceurl+"images/markers/accidente.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'BACHE O VIA DAÑADA']{marker-file: url('"+sourceurl+"images/markers/bache.png'); marker-clip: false; marker-allow-overlap: false;} [post_cat= 'OBRAS Y/O VIA CERRADA']{marker-file: url('"+sourceurl+"images/markers/viacerrada.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'SEMAFORO DESCOMPUESTO']{marker-file: url('"+sourceurl+"images/markers/semaforo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/vialidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'INCENDIO']{marker-file: url('"+sourceurl+"images/markers/incendio.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'ROBO']{marker-file: url('"+sourceurl+"images/markers/robo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'SITUACION DE RIESGO']{marker-file: url('"+sourceurl+"images/markers/sitriesgo.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA COMUNIDAD']{marker-file: url('"+sourceurl+"images/markers/pcomunidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA SEGURIDAD']{marker-file: url('"+sourceurl+"images/markers/pseguridad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA SERV PUBLICOS']{marker-file: url('"+sourceurl+"images/markers/pservpublicos.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'PROPUESTA VIALIDAD']{marker-file: url('"+sourceurl+"images/markers/pvialidad.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'EMERGENCIAS']{marker-file: url('"+sourceurl+"images/markers/emergencia.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'AVISOS']{marker-file: url('"+sourceurl+"images/markers/aviso.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'EVENTO PUBLICO']{marker-file: url('"+sourceurl+"images/markers/evento.png'); marker-clip: false; marker-allow-overlap: true;} [post_cat= 'OBSERVADOR CIUDADANO']{marker-file: url('"+sourceurl+"images/markers/obscdn.png'); marker-clip: false; marker-allow-overlap: true;}}#{{table_name}}{marker-fill:#FF5C00;marker-line-color:#FFF;marker-line-width:2;marker-line-opacity:1;marker-opacity:0.9;marker-placement:point;marker-type:ellipse;marker-allow-overlap:true;marker-clip:false;marker-multi-policy:largest;}#{{table_name}}[votes<=16.0]{marker-width:60.0;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=15.0]{marker-width:53.9;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=12.0]{marker-width:47.8;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=11.0]{marker-width:41.7;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=9.0]{marker-width:35.6;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=8.0]{marker-width:29.4;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=6.0]{marker-width:23.3;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=5.0]{marker-width:17.2;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=3.0]{marker-width:11.1;marker-line-color:yellow;marker-line-width:10;}#{{table_name}}[votes<=2.0]{marker-width:5.0;marker-line-color:yellow;marker-line-width:10;}";	
	var execRepOffset = 0;
	var execRepLimit = 3;
	
	/* LOADING SPINNER OPTIONS */
	var opts = {
				  lines: 13, // The number of lines to draw
				  length: 8, // The length of each line
				  width: 22, // The line thickness
				  radius: 60, // The radius of the inner circle
				  corners: 0.6, // Corner roundness (0..1)
				  rotate: 63, // The rotation offset
				  direction: 1, // 1: clockwise, -1: counterclockwise
				  color: '#4CAA32', // #rgb or #rrggbb
				  speed: 1.7, // Rounds per second
				  trail: 25, // Afterglow percentage
				  shadow: true, // Whether to render a shadow
				  hwaccel: true, // Whether to use hardware acceleration
				  className: 'spinner', // The CSS class to assign to the spinner
				  zIndex: 2e9, // The z-index (defaults to 2000000000)
				  top: 'auto', // Top position relative to parent in px
				  left: 'auto' // Left position relative to parent in px
	};
				
	/* MAPS RELATED */
	var map, map_T; 
	var geocoder;
	var torque = null; 
	var TorqueOptions;
	var overlay,overlay_T;
	var radDeg;
	var shapesArray=[];
	var drawingManager;
	var layers = [];
	var schema = [["cartodb_id","number"],["created_at","date"],["updated_at","date"]];
	var layerUrl = 'http://cicadmin.cartodb.com/api/v1/viz/14645/viz.json';
	var _interactivity = "cartodb_id,post_title,post_cat,post_url,formatted_address,post_content,status,close_fail,ticket,last_mod,uuid,follow_up,follow_up_external,votes,stars,assets";
	var mapcluster = true;
	var lon, lat;
    var watchID;
	var total = 10;
	var gmarker = null;
	var gmarkers=[];
	var bubbles = false;


    /* FILTER VARIABLES AND JQUERY TRIGGERS FOR QUERY DEFINITION */
    var dates = {
		  calendario :  false,
		  sietedias : false,
		  quincedias : false,
		  treintadias : false,
		  noventadias : false,
		  ulthoras : false,
		  horasdeldia : false,
		  domingo: false,
		  lunes: false, 
		  martes: false,
		  miercoles: false,
		  jueves: false,
		  viernes: false,
		  sabado: false
	  };
    var repStatus = {
	  	  open : false,
	  	  closed : false,
	  	  closed_fail : false
	  };
    var radius = {
	  	  set : false,
	  	  lat : mapCenter[0],
	  	  lng : mapCenter[1],
	  	  rad : 5000
	};
	var normalpob = false;
    var normalkm = false;
    var polyfilter = false;
    var closedistance = false;
    var votos = false;
    var star = false;
    var totalvotos = 0;
	var totalstar = 0;
    var qassets = false;
    var searchInput = "";
    var _query;
    var _geoq;
	var selectedCat, selectedTitle, selectedContent, selectedTicket, selectedAddress, selectedUrl, selectedStatus, selectedFail, selectedCreate, selectedUpdate, selectedFollowup, selectedFollowupExt, selectedVotes, selectedStars, selectedAssets, selectedComments, selectedUUID;
    var des, has, valulthoras = 3, horasdeldia, queryhorasdeldia = "(date_part('hour', "+table_name+".created_at) = 8 ) OR (date_part('hour', "+table_name+".created_at) = 9 ) OR (date_part('hour', "+table_name+".created_at) = 10 ) OR (date_part('hour', "+table_name+".created_at) = 11 ) OR (date_part('hour', "+table_name+".created_at) = 12 )", auxhas = true;
	var anyFilter=false;
	
	///ADD SPLICE TO STRING PROTOTYPE FOR INSERTION
	String.prototype.splice = function( idx, rem, str ) {return (this.slice(0,idx) + str + this.slice(idx + Math.abs(rem)));};
	
	// WORDLE
	var wordle;
	
	// OCCURRENCE
	  var formattedData = new Array(7);  // 7 days, 24 hours array
	  for (var i = 0; i < formattedData.length; i++) {
	    formattedData[i] = new Array(24);
	  }
	  var buckets = 11,
	  colorScheme = 'rbow2',
	  days = [
	    { name: 'Domingo', abbr: 'Do' },
		{ name: 'Lunes', abbr: 'Lu' },
		{ name: 'Martes', abbr: 'Ma' },
		{ name: 'Miércoles', abbr: 'Mi' },
		{ name: 'Jueves', abbr: 'Ju' },
		{ name: 'Viernes', abbr: 'Vi' },
		{ name: 'Sábado', abbr: 'Sá' }
	  ],
	  hours = ['12a', '1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a', '9a', '10a', '11a', '12p', '1p', '2p', '3p', '4p', '5p', '6p', '7p', '8p', '9p', '10p', '11p'];
	  
	 // SCORE
	 var effectPercent = {}; 
	 
	 //DISQUS
	 var disqus_shortname = disqus_dashboard;
     var disqus_identifier = '0';
     var disqus_url = window.location.href.split('?')[0];
     var disqus_developer = '1';
     var disqus_config = function () { this.language = "es_MX";};
     (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();	 
</script>
<!-- MAP & CARTODB -->
<script type="text/javascript">
	/*   MAPS METHODS  */
	google.maps.event.addDomListener(window,'load', init);
	google.maps.visualRefresh = true;
	function init(){
		geocoder = new google.maps.Geocoder();
		var styler = [];
		var styleMap = new google.maps.StyledMapType(styler,{name: "Mapa"});	
		var mapDiv = document.getElementById('map');
		/*  MAP  */
		map = new google.maps.Map(mapDiv, {
			center: new google.maps.LatLng(mapCenter[0], mapCenter[1]),
			zoom: 11,
			/*maxZoom: 17,*/
			minZoom:5,
			zoomControl: true,
			zoomControlOptions: {
				style: google.maps.ZoomControlStyle.DEFAULT	
			},
			mapTypeControlOptions: { mapTypeIds: [google.maps.MapTypeId.SATELLITE, 'style_'],
									  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
			},
			mapTypeControl: false,
			scrollwheel: true,
			streetViewControl: true,
			panControl:true,
			backgroundColor: '#163D74',
			rotateControl:true,
		});
		map.mapTypes.set('style_', styleMap);
		map.setMapTypeId('style_');
		google.maps.event.addListener(map, 'click', function(event) {
	        if (radius.set) {
	            radius.lat = event.latLng.lb;
	            radius.lng = event.latLng.mb;
	            updateRadDeg(radius.rad);
	            drawCircle();
	            updateBounds();
	            setQ();
	        }
		});
	    
	    ///DRAWING POLYGONS
	    drawingManager = new google.maps.drawing.DrawingManager({
		      drawingControl: false,
		      drawingControlOptions: {
		        position: google.maps.ControlPosition.TOP_RIGHT,
		        drawingModes: [google.maps.drawing.OverlayType.POLYGON]
		      },
		      polygonOptions: {
	        	strokeColor: "#0000ff",
	            strokeOpacity: 0.60,
	            strokeWeight: 2,
	            fillColor: "#0000ff",
	            fillOpacity: 0.150,
		        clickable: true,
		        zIndex: 1,
		        editable: true,
		        draggable: false
		      }
		    });
		drawingManager.setMap(map);
	    // Add an event listener for when shape is complete
		google.maps.event.addListener(drawingManager, 'overlaycomplete', function(e) {
	      var newShape = e.overlay;
	      drawingManager.setDrawingMode(null);
	      shapesArray.push(newShape);
	      if (polyfilter) setQ();
	      // Event listener for rightclick
	      google.maps.event.addListener(newShape, 'rightclick', function() {
			//clear shape
			//newShape.setMap(null);
			});
	    newShape.setEditable(false);
	    });
		
		//AUTOCOMPLETE
		var address = (document.getElementById('address'));
		var autocomplete = new google.maps.places.Autocomplete(address);
		autocomplete.bindTo('bounds', map);
		google.maps.event.addListener(autocomplete, 'place_changed', function() {
		    address.className = '';
		    var place = autocomplete.getPlace();
		    if (!place.geometry) {
		      // Inform the user that the place was not found and return.
		      input.className = 'No se encontró la ubicación';
		      return;
		    }
		    // If the place has a geometry, then present it on a map.
		    if (place.geometry.viewport) {
		      map.fitBounds(place.geometry.viewport);
		    }else{
		      map.setCenter(place.geometry.location);
		      map.setZoom(17);
		    }
		});
		
		/* CHECK FOR ANY URL PARAMETERS*/
		var obj = getUrlVars();
		if (obj.table_name) table_name = obj.table_name;
		if (obj.ticket) _query = "SELECT * FROM "+table_name+" WHERE ticket ilike '" + obj.ticket + "'";
		
		 
		/* CARTO */
		var layerOptions = {query: _query, tile_style: _tile_style_cluster,interactivity: _interactivity};
		cartodb.createLayer(map, layerUrl, layerOptions)
			.on('done', function(layer) {
					map.overlayMapTypes.setAt(0, layer);
					layers.push(layer);
					layer.on('featureClick', function(e, latlng, pos, data) {
			            selectedCat = data.post_cat;
			            selectedTitle = data.post_title;
			            selectedContent = (data.post_content == "") ? data.post_title : data.post_content;
			            selectedTicket = data.ticket;
			            selectedAddress = data.formatted_address;
			            selectedUrl = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name;
			            selectedStatus = (data.status == 'read') ? selectedStatus = "Abierto" : selectedStatus = "Cerrado";
			            selectedFail = data.close_fail;
			            selectedFollowup = data.follow_up;
			            selectedFollowupExt = data.follow_up_external; 
			            selectedVotes =  data.votes;
			            selectedStars =  data.stars;
			            selectedAssets = data.assets;
			            selectedComments = 0;
			            selectedUUID = data.uuid;
			            var n="SELECT created_at,last_mod FROM "+table_name+" WHERE cartodb_id = " + data.cartodb_id;
						sql.execute(n).done(function(data) {
						    selectedCreate = new Date(data.rows[0].created_at).addHours(7);
			                selectedUpdate = new Date(data.rows[0].last_mod).addHours(7);
							layer.infowindow.set('template', $('#infowindow_template').html());
				            setReportContent();
				        }).error(function(errors) {});
			       });
			        if (obj.ticket){
			          var rpos = "SELECT st_y(the_geom) as lat, st_x(the_geom) as lon FROM "+table_name+" WHERE ticket ilike '"+obj.ticket+"'";
					  sql.execute(rpos).done(function(data) {
							var latit = data.rows[0].lat; 
							var longit = data.rows[0].lon;
							var ticketLatlng = new google.maps.LatLng(latit, longit);
							map.setCenter(ticketLatlng);
					        sql.execute(_query).done(function(data) {
							    selectedCat = data.rows[0].post_cat;
							    selectedTitle = data.rows[0].post_title;
					            selectedContent = (data.rows[0].post_content == "") ? data.rows[0].post_title : data.rows[0].post_content;
					            selectedTicket = data.rows[0].ticket;
					            selectedAddress = data.rows[0].formatted_address;
					            selectedUrl = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name;
					            selectedStatus = (data.rows[0].status == 'read') ? selectedStatus = "Abierto" : selectedStatus = "Cerrado";
					            selectedFail = data.rows[0].close_fail;
					            selectedFollowup = data.rows[0].follow_up;
					            selectedFollowupExt = data.rows[0].follow_up_external; 
					            selectedVotes =  data.rows[0].votes;
					            selectedStars =  data.rows[0].stars;
					            selectedAssets = data.rows[0].assets;
					            selectedComments = 0;
					            selectedUUID = data.rows[0].uuid;
						        var n="SELECT created_at,last_mod FROM "+table_name+" WHERE cartodb_id = " + data.rows[0].cartodb_id;
								sql.execute(n).done(function(data) {
										selectedCreate = new Date(data.rows[0].created_at).addHours(7);
										selectedUpdate = new Date(data.rows[0].last_mod).addHours(7);
										layer.infowindow.set('template', $('#infowindow_template').html());    
										setReportContent();    
								}).error(function(errors) {});			  
							}).error(function(errors) {});
				       }).error(function(errors) {});
			       }
			}).on('error', function() {window.location.reload();});
	    
	      var n=("SELECT COUNT (*) FROM "+table_name+"");
	      if (obj.ticket) n = "SELECT COUNT (*) FROM "+table_name+" WHERE ticket ilike '" + obj.ticket + "'";
		  
		  sql.execute(n).done(function(data) {
		        var result;
		  		for (var i = 0; i < data.total_rows; i++) { result = data.rows[i].count;} 
		  		$( "#counterslide" ).show('fold', {}, 400);
		  		$( "#counterVal" ).val(addCommas(result));
		  }).error(function(errors) {});
		  
		  n=("SELECT "+table_name+".post_cat, COUNT (*) FROM "+table_name+" GROUP BY "+table_name+".post_cat");
		  if (obj.ticket) 
		  	n = "SELECT "+table_name+".post_cat, COUNT (*) FROM "+table_name+" WHERE ticket ilike '" + obj.ticket + "' GROUP BY "+table_name+".post_cat"
		  sql.execute(n).done(function(data) {
		  		updateCounters(data);
		  }).error(function(errors) {});

	}
	
	/* ADDRESS BAR METHODS */
	function codeAddress() {
		  var address = document.getElementById('address').value;
		  geocoder.geocode( { 'address': address}, function(results, status) {
		    if (status == google.maps.GeocoderStatus.OK) {
		    	if (activeView == 'home'){
			      map.setCenter(results[0].geometry.location);
			      switch (results[0].geometry.location_type){
				      case 'ROOFTOP': map.setZoom(17); break;
				      case 'RANGE_INTERPOLATED': map.setZoom(16); break;
				      case 'GEOMETRIC_CENTER': map.setZoom(15); break;
				      case 'APPROXIMATE': map.setZoom(13); break;
			      }
		        } else {
			      map_T.setCenter(results[0].geometry.location)
			      switch (results[0].geometry.location_type){
				      case 'ROOFTOP': map_T.setZoom(17); break;
				      case 'RANGE_INTERPOLATED': map_T.setZoom(16); break;
				      case 'GEOMETRIC_CENTER': map_T.setZoom(15); break;
				      case 'APPROXIMATE': map_T.setZoom(13); break;  
		          }
		        }
		    } else {
		      alert('Geocode was not successful for the following reason: ' + status);
		    }
		  });
		}
	
	/*   INFOWINDOW  + REPORT CONTENT HELPERS   */
    function getImg(category){
        var cat = typeof category !== 'undefined' ? category : selectedCat;
        var img = false, img2 =false;
        if (document.getElementById("theImg")) img =true;
        if (document.getElementById("theImg2")) img2 =true;
        var src = "";
		switch (cat){
		   /* //These are the non-squared icons
 case 'ACCIDENTE':src= "images/accidente.png";break;
			case 'ALCANTARILLAS': src= "images/alcantarilla.png";break;
			case 'ALUMBRADO PUBLICO': src= "images/alumbrado.png";break;
			case 'BACHE O VIA DAÑADA': src= "images/bache.png";break;
			case 'AVISOS': src= "images/com-avis.png";break;
			case 'EMERGENCIAS': src= "images/emergencia.png";break;
			case 'EVENTO PUBLICO': src="images/com-event.png";break;
			case 'FALTA ELECTRICIDAD': src="images/falta-elect.png";break;
			case 'FUGA': src="images/fuga.png";break;
			case 'INCENDIO': src="images/incendio.png";break;
			case 'OBRAS Y/O VIA CERRADA': src="images/via-cerrada.png";break;	
			case 'OBSERVADOR CIUDADANO': src="images/obs-ciudadano.png";break;	
			case 'OTROS': src="images/serv.png";break;	
			case 'PARQUES DESCUIDADOS': src="images/parques.png";break;	
			case 'PROPUESTA COMUNIDAD': src="images/prop-com.png";break;	
			case 'PROPUESTA SERV PUBLICOS': src="images/prop-serv.png"; break;	
			case 'PROPUESTA VIALIDAD': src="images/prop-vial.png"; break;	
			case 'PROPUESTA SEGURIDAD': src="images/prop-seg.png"; break;		
			case 'RECOLECCION DE BASURA': src="images/basura.png";break;	
			case 'ROBO': src="images/robo.png";break;	
			case 'SEMAFORO DESCOMPUESTO': src="images/semaforo.png";break;	
			case 'SITUACION DE RIESGO': src="images/sit-riesgo.png";break;	
			case 'VIALIDAD': src="images/viali.png";break;
*/
		    case 'ACCIDENTE':src= "images/accidente.jpg";break;
			case 'ALCANTARILLAS': src= "images/alcantarillas.jpg";break;
			case 'ALUMBRADO PUBLICO': src= "images/alumbrado.jpg";break;
			case 'BACHE O VIA DAÑADA': src= "images/bache.jpg";break;
			case 'AVISOS': src= "images/avisos.jpg";break;
			case 'EMERGENCIAS': src= "images/emergencias.jpg";break;
			case 'EVENTO PUBLICO': src="images/eventos.jpg";break;
			case 'FALTA ELECTRICIDAD': src="images/electricidad.jpg";break;
			case 'FUGA': src="images/fuga.jpg";break;
			case 'INCENDIO': src="images/incendio.jpg";break;
			case 'OBRAS Y/O VIA CERRADA': src="images/obras.jpg";break;	
			case 'OBSERVADOR CIUDADANO': src="images/observador.png";break;	
			case 'OTROS': src="images/serv.png";break;	
			case 'PARQUES DESCUIDADOS': src="images/parques.png";break;	
			case 'PROPUESTA COMUNIDAD': src="images/pcomunidad.jpg";break;	
			case 'PROPUESTA SERV PUBLICOS': src="images/pservicios.jpg"; break;	
			case 'PROPUESTA VIALIDAD': src="images/pvialidad.jpg"; break;	
			case 'PROPUESTA SEGURIDAD': src="images/pseguridad.jpg"; break;		
			case 'RECOLECCION DE BASURA': src="images/basura.jpg";break;	
			case 'ROBO': src="images/robo.jpg";break;	
			case 'SEMAFORO DESCOMPUESTO': src="images/semaforo.jpg";break;	
			case 'SITUACION DE RIESGO': src="images/sitriesgo.jpg";break;	
			case 'VIALIDAD': src="images/viali.png";break;
			default:document.getElementById("theImg").src="#";break;
		}
		if(img) document.getElementById("theImg").src=src;
		if(img2) document.getElementById("theImg2").src=src;
		if (category) return src;
	}
    function getAssets(assets){
    	var _asset = typeof assets !== 'undefined' ? assets : selectedAssets;
	    var src = '';
	    var assets = false;
	    if (document.getElementById("theAssets")) assets =true;
	    var assetsString = '';
	    if (_asset)
	    	if (_asset.search(/"/i) != -1){
	    	    assetsString = _asset.substring(_asset.search(/"/i)+1);
	    	    assetsString =  assetsString.substring(0,assetsString.search(/"/i));
	    	    
	    	    if (assetsString.search(/citivox/i) != -1) return false;
	    	    else if  (assetsString.search(/http/i) != -1) src = assetsString;
	    	    else src = 'http://assets.' + accountURL + assetsString;
		    	if (assets){
		    		document.getElementById("theAssets").width=200;
					document.getElementById("theAssets").height=200;
					document.getElementById("theAssets").src=src;
				}
	    	}
	   return src;
    }
    function setReportContent(uuid){
    	  var uuid = typeof uuid !== 'undefined' ? uuid : false;
          if (uuid) {
	          	var n="SELECT votes, stars FROM "+table_name+" WHERE uuid = '"+uuid+"'";
				sql.execute(n).done(function(data) {
				    selectedStars = data.rows[0].stars;
				    selectedVotes = data.rows[0].votes;
				    writeContent();
		        }).error(function(errors) {});
          }
          else{
          		writeContent(); 
		  }
		    
    }
    function writeContent(){
	    /*console.log(selectedAssets);
    	  console.log(selectedFollowup);
    	  console.log(selectedFollowupExt);
    	  console.log(selectedUUID);
    	  console.log(selectedVotes);
    	  console.log(selectedStars);*/
    	  var days = 0;
		  if (!selectedVotes) selectedVotes = 0;
		  if (!selectedStars) selectedStars = 0;
	      if (selectedAddress.search(/null/i) != -1) selectedAddress = "No especificada, ver mapa";
	      var execRep="<center><table><tbody>"; 
	      /* HEADER ELEMENT */
	      execRep+="<tr bgcolor=\"F2F2F2\">";
	      execRep+="<td valign=\"top\" style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
  		  execRep+="<div style=\"max-width: 100px;max-height: 62px; margin-left:0px\"><img width=\"94\" height=\"94\" src=\""+getImg(selectedCat)+"\" class=\"attachment-thumbnail\"/></div>";
  		  execRep+="<div style=\"\"><div style=\"position: absolute;left: 155px;top: 28px;\"><a class=\"xcnr\">"+selectedTicket+"</a>";
		  if (selectedStatus == "Abierto"){
        	execRep+="<a class=\"verificado2\" style=\"margin-top: 3;\">"+selectedStatus+"</a></div>";
        	execRep+="<div class=\"verticalLine\"></div>";
        	execRep+="<div style=\"position: absolute;right: 34px;top: 26px;font-size: 15px;\"><span class=\"icon-span\" style=\"float: left; margin-bottom:5px;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+selectedUUID+"')\"/> "+selectedVotes;
        	execRep+="<a><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> "+selectedComments+"</span>";
        	execRep+="<div class=\"rating\" style=\"margin-top: 10;margin-left: 4; opacity:0.3;\">";
        	for (var j=4; j>=0;j--){
               execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" disabled><label for=\"star"+j+"\">"+j+" stars</label>";
            }
            execRep+="</div></div>";
          } else{
        	execRep+="<a class=\"verificado\" style=\"margin-top: 3;\">"+selectedStatus+"</a></div>";
        	execRep+="<div class=\"verticalLine\"></div>";
        	execRep+="<div style=\"position: absolute;right: 34px;top: 26px;font-size: 15px;\"><span class=\"icon-span\" style=\"\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+selectedUUID+"')\"/> "+selectedVotes;
        	execRep+="<a><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> "+selectedComments+"</span>";
            execRep+="<div class=\"rating\" style=\"margin-top: 10;margin-left: 10;\">";
            for (var j=4; j>=0;j--){
                if (selectedStars >= j)
                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" checked=\"checked\" onclick=\"sendStars('"+j+"','"+selectedUUID+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
                else
                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" onclick=\"sendStars('"+j+"','"+selectedUUID+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
            }
            execRep+="</div></div>";
          }
          execRep+="</div>";
          /* HEADER-STATUS DETAIL ELEMENT FOR PUBLIC SERVICES*/
          if (isPublicService(selectedCat))
          	execRep+="<div style=\"height:30px; width:350px; margin-top:-3px;\"><div style=\"min-width:120px; background-image:url(images/bg-status_cic.png);background-repeat: no-repeat; height: 36px;margin-left: 124px; color:#fff\"></div>";
          else
            execRep+="<div style=\"height:30px; width:350px; margin-top:-3px; opacity:0.3\"><div style=\"min-width:120px; background-image:url(images/bg-status_cic.png);background-repeat: no-repeat; height: 36px;margin-left: 124px; color:#fff\"></div>";
          	
          	if (selectedStatus == "Abierto"){
          		days = Math.round((Date.today()-selectedCreate.getTime())/(1000*60*60*24));
          		if (days < 0 ) days = 0;
		  		execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px; top: 96px;\"> "+days+" días</h5></div>";
	          	execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_pend.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
          	}else if (selectedFail){
          	    days = Math.round((selectedUpdate.getTime()-selectedCreate.getTime())/(1000*60*60*24));
          		execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px;top: 96px;\"> "+days+" días</h5></div>";
	          	execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_fail.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
          	}else{
          		days = Math.round((selectedUpdate.getTime()-selectedCreate.getTime())/(1000*60*60*24));
          		execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px;top: 96px;\"> "+days+" días</h5></div>";
	          	execRep+="<div style=\"min-width:120px; background-image:url(images/bg-status_succ.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
          	}
          execRep+="</div>";
          execrep+="</td></tr>";
          /* DETAILS ELEMENT */
		  execRep+="<tr bgcolor=\"F2F2F2\">";
		  execRep+="<td valign=\"top\"  style=\"max-width:350px;padding: 15px;vertical-align: top;text-align: left; border-radius: 2px;\">";
		  execRep+="<h5 style=\"text-align:left;font-size:12px;max-width:350px;margin-left: 3;\" >"+selectedTitle+"</h5>";
		  execRep+="<h5 style=\"font-size:11px;max-width:350px;margin-left: 3;\" class=\"direccion\">"+selectedAddress+"</h5>";
		  execRep+="<h5 style=\"font-size:11px;max-width:350px;margin-left: 3;\" class=\"calendario\">"+selectedCreate+"</h5>";
		  execRep+="<br><h3 class=\"verificado3\">Descripción</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\" >"+selectedContent+"</h3>";
		  if (selectedFollowup!='') execRep+="<br><h3 class=\"verificado3\">Seguimiento</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\">"+selectedFollowup+"</h3>";
		  if (selectedFollowupExt!='') execRep+="<br><h3 class=\"verificado3\">Seguimiento de Autoridad</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\">"+selectedFollowupExt+"</h3>";
		  execrep+="</td></tr>";
		  /* DISQUS ELEMENT */
		  execRep+="<tr bgcolor=\"F2F2F2\">";
		  execRep+="<td valign=\"top\"  style=\"max-width:350px;padding: 15px;vertical-align: top;text-align: left; border-radius: 2px;\">";
		  execRep+="<div id=\"disqus_thread\"></div>";
		  execrep+="</td></tr>";
		  execRep+="</table></center>";
		  
          $( "#report-content" ).html(execRep);
  		  $( "#report-content" ).removeAttr('style').show('fold', {}, 400); 
  		  DISQUS.reset({
			       reload: true,
			       config: function () {  
			         this.page.identifier = selectedTicket;
			         this.page.url = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name;
			         this.page.title = "Reporte de " + selectedCat + ", Ticket: " + selectedTicket;
			         this.language = "es_MX";
			       }
			     });
    }
    function getUrlVars(){
		    var vars = [], hash;
		    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		    for(var i = 0; i < hashes.length; i++)
		    {
		        hash = hashes[i].split('=');
		        vars.push(hash[0]);
		        vars[hash[0]] = hash[1];
		    }
		    return vars;
		}
    function isPublicService(cat){
	    for (var i=0; i < publicServices.length; i++){
		    if (cat == publicServices[i]) return true;
	    }
	    return false;
    }
    function sendStars(stars,uuid){
    	stars+=parseFloat(stars)+1;
	    var _url = accountAPI+'rate';
	    var _data = '{"uuid":"'+uuid+'", "star":"'+stars+'"}';
	    $('.body').css('cursor','progress');
	    var request = $.ajax({
                url: _url,
                type: 'POST',
                contentType: 'application/json',
                data: _data,
                success: function(data, textStatus, jqXHR) {
                    if (activeView == 'home') setReportContent(uuid);
                    else setQ();
                    $('body').css('cursor','auto');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    
                }});
	    
    }
    function sendVote(uuid){
	    var _url = accountAPI+'vote';
	    var _data = '{"uuid":"'+uuid+'"}';
	    $('body').css('cursor','progress');
	    var request = $.ajax({
                url: _url,
                type: 'POST',
                contentType: 'application/json',
                data: _data,
                success: function(data, textStatus, jqXHR) {
                    if (activeView == 'home') setReportContent(uuid);
                    else setQ();
					$('body').css('cursor','auto');
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    
                }});
	    
    }
</script>
<!-- INFOWINDOW TEMPLATES -->
<script type="infowindow/html" id="infowindow_template">
    <div class="cartodb-popup" id="infowindow" >
      <a href="#close" class="cartodb-popup-close-button close" onclick="$('#report-content:visible').hide('fold', {}, 400);">x</a>
       <div class="cartodb-popup-content-wrapper" >
         <div class="cartodb-popup-header">
         	<img  id="theImg" src="images/favicon.ico" onload="getImg()" width="38px" height="38px" style="float:left;"><h3 style="float: right; width: 140px;height: 38px;text-align: left;color: #444;margin-top: 5px;">{{content.data.post_cat}}</h3>
		 </div>
         <div class="cartodb-popup-content" >
          	<img  id="theAssets" src="images/blank.png" onload="getAssets()" width="1" height="1">
         </div>
       </div>
       <div class="cartodb-popup-tip-container" ></div>
    </div>
</script>
</head>
<body>
	<!-- ZENDESK BUTTON -->
	<script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.5/zenbox.js"></script>
	<style type="text/css" media="screen, projection">
	  @import url(//assets.zendesk.com/external/zenbox/v2.5/zenbox.css);
	</style>
	<script type="text/javascript">
	  if (typeof(Zenbox) !== "undefined") {
	    Zenbox.init({
	      dropboxID:   "20097242",
	      url:         "https://centrodeintegracionciudadana.zendesk.com",
	      tabID:       "Sugerencias",
	      tabColor:    "#2E4F76",
	      tabPosition: "Right"
	    });
	  }
	</script>
	
    <a href="#" class="button" style="display:none;"></a>
	<script type="text/javascript">
	  /* ONLOAD CONFIGURATIONS */
	  $(function() {
	        BrowserDetect.init();
	  
			$(window).load(function() {
			  	/* RAPTOR */
				$('.button').raptorize({
					'enterOn' : 'konami-code'
				});

				/* PUT*  */
				if (window.addEventListener) {
				    var keys = [],
				        //code = "38,38,40,40,37,39,37,39,66,65"; //konami-code
				        code = "80,85,84,79"; 
				    window.addEventListener("keydown", function(e){
				        keys.push(e.keyCode);
				        if (keys.toString().indexOf(code) >= 0) {
				            alert("puto tú !");
				            keys = [];
				        };
				    }, true);
				};
				
				/* WORDLE */
				wordle = new WORDLEJS.Wordle(document.getElementById('wordle-container'));
			});

			/* LOADING SPINNER */
			var target = document.getElementById('map');
			var spinner = new Spinner(opts).spin(target);
			
			/* BUTTONS FOR SUBMENUS TOOLTIPS */
			
				
			/* BUTTONS FOR FILTERING PAGESLIDES */
		    var auxSlide = "";	
			$( "#slide-cate" ).click(function() {
			  fade(auxSlide); 
		      if ($("#filtercate").is(":visible")){  $( "#filtercate" ).hide('fold', {}, 400); auxSlide = "";}
		      else{ $( "#filtercate" ).show('fold', {}, 400);auxSlide = 'filtercate' ;}return false;
		    });	
		    $( "#slide-date" ).click(function() {
		      fade(auxSlide); 
		      if ($("#filterdate").is(":visible")){  $( "#filterdate" ).hide('fold', {}, 400); auxSlide = "";}
		      else{ $( "#filterdate" ).show('fold', {}, 400);auxSlide = 'filterdate' ;}return false;		    
		    });		
		    $( "#slide-muni" ).click(function() {
		      fade(auxSlide); 
		      if ($("#filtermuni").is(":visible")){  $( "#filtermuni" ).hide('fold', {}, 400); auxSlide = "";}
		      else{ $( "#filtermuni" ).show('fold', {}, 400);auxSlide = 'filtermuni' ;}return false;	
		    });		
		    $( "#slide-stat" ).click(function() {
		      fade(auxSlide); 
		      if ($("#filterstat").is(":visible")){  $( "#filterstat" ).hide('fold', {}, 400); auxSlide = "";}
		      else{ $( "#filterstat" ).show('fold', {}, 400);auxSlide = 'filterstat' ;}return false;	
		    });		
		    $( "#slide-dist" ).click(function() {
		      fade(auxSlide); 
		      if ($("#filterdist").is(":visible")){  $( "#filterdist" ).hide('fold', {}, 400); auxSlide = "";}
		      else{ $( "#filterdist" ).show('fold', {}, 400);auxSlide = 'filterdist' ;}return false;		 
		    });		
		    
		    /* CALENDAR */
		    var t = new Date();
		    var y = new Date();
		    t.setFullYear(t.getFullYear(), t.getMonth(), t.getDate());   //console.log(t);
		    y.setFullYear(y.getFullYear(), y.getMonth(), y.getDate()); 
		    y.setDate(y.getDate()-1);
			var t_year =  t.getFullYear();
			var t_month = t.getMonth()+1;
			var t_day = t.getDate();
			var y_year =  y.getFullYear();
			var y_month = y.getMonth()+1;
			var y_day = y.getDate();
			var todaydate = t_year + '-' + (t_month<10 ? '0' : '') + t_month + '-' + (t_day<10 ? '0' : '') + t_day;
		    var yesterdaydate = y_year + '-' + (y_month<10 ? '0' : '') + y_month + '-' + (y_day<10 ? '0' : '') + y_day;
		    document.getElementById('desde').value=yesterdaydate;
		    document.getElementById('hasta').value=todaydate;
		    des=yesterdaydate;
		    has=todaydate;	
		    $( "#desde" ).datepicker({
		      dateFormat: "yy-mm-dd",
		      changeMonth: true,
		      changeYear: true,
		      numberOfMonths: 1,
		      onClose: function( selectedDate ) {
		        $( "#hasta" ).datepicker( "option", "minDate", selectedDate );
		        des=selectedDate;
		        if (dates.calendario) setQ();
		      }
		    });
		    $( "#hasta" ).datepicker({
		      dateFormat: "yy-mm-dd",
		      changeMonth: true,
		      changeYear: true,
		      numberOfMonths: 1,
		      onClose: function( selectedDate ) {
		        $( "#desde" ).datepicker( "option", "maxDate", selectedDate );
		        has=selectedDate;
		        auxhas=true; //used for knowing if we come from  a 'has' action
		        if (dates.calendario) setQ();
		      }
		    });	
		    $( "#slider-ulthoras" ).slider({
		      range: "max",
		      min: 1,
		      max: 24,
		      value: 3,
		      slide: function( event, ui ) {
				  $( "#amount" ).val( ui.value );
				  valulthoras = ui.value;
				  }
			});
			$( "#amount" ).val( $( "#slider-ulthoras" ).slider( "value" ) );
		    
		    $( "#slider-horasdeldia" ).slider({
				range: true,
			    min: 0,
			    max: 23,
			    values: [ 8, 12 ],
				slide: function( event, ui ) {
					$( "#amount1" ).val( ui.values[ 0 ] + " - " + ui.values[ 1 ] );
					horasdeldia=ui.values;
					queryhorasdeldia='';
					if (horasdeldia[0]===horasdeldia[1]){
					queryhorasdeldia = "(date_part('hour', "+table_name+".created_at) = "+horasdeldia[0]+" )"
					}else{
						for(var cont = horasdeldia[0];cont<= horasdeldia[1];cont++){
							if(cont===horasdeldia[1]){queryhorasdeldia += "(date_part('hour', "+table_name+".created_at) = "+ cont+" )"
							}else{queryhorasdeldia += "(date_part('hour', "+table_name+".created_at) = "+ cont+" ) OR "}
						}
					}
				}
			});
		    $( "#amount1" ).val( $( "#slider-horasdeldia" ).slider( "values", 0 ) + " - " + $( "#slider-horasdeldia" ).slider( "values", 1 ) );
			
			/* POLYGON */
			$( "#slider-radius" ).slider({
		      range: "max",
		      min: 50,
		      step:50,
		      max: 5000,
		      value: 5000,
		      slide: function( event, ui ) {
				  $( "#radiusval" ).val( ui.value );
				  radius.rad = ui.value;
				  //map.setZoom(number);
				  
				  }
			});
			$( "#radiusval" ).val( $( "#slider-radius" ).slider( "value" ) );
			
			
			//Slider for close distance reports
			$( "#slider-closedistance" ).slider({
		      range: "max",
		      min: 1,
		      max: 100,
		      value: 10,
		      slide: function( event, ui ) {
				  $( "#amount2" ).val( ui.value );
				  total = ui.value;
				  }
			});
			$( "#amount2" ).val( $( "#slider-closedistance" ).slider( "value" ) );
			
			
			//Slider for votes
			$( "#slider-voto" ).slider({
		      range: "max",
		      min: 0,
		      max: 30,
		      value: 0,
		      slide: function( event, ui ) {
				  $( "#amountvoto" ).val( ui.value );
				  totalvotos = ui.value;
				  }
			});
			$( "#amountvoto" ).val( $( "#slider-voto" ).slider( "value" ) );
			
			
			//Slider for star rating
			$( "#slider-star" ).slider({
		      range: "max",
		      min: 0,
		      max: 5,
		      value: 0,
		      slide: function( event, ui ) {
				  $( "#amountstar" ).val( ui.value );
				  totalstar = ui.value;
				  }
			});
			$( "#amountstar" ).val( $( "#slider-star" ).slider( "value" ) );
			
					
			/* CHARTS OPTIONS */
			Highcharts.setOptions({
				lang: {
					months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 
						'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
					weekdays: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado']
				}
			});		
			
			// JQUERY UI
			var icons = {
		      header: "ui-icon-circle-arrow-e",
		      activeHeader: "ui-icon-circle-arrow-s"
		    };
            $( "#accordion" ).accordion({
                collapsible: true,
                heightStyle: "content",
                active: false,
                disabled: true,
                icons: icons
            }).sortable({
                axis: "y",
                handle: "h3",
                stop: function( event, ui ) {
                  ui.item.children( "h3" ).triggerHandler( "focusout" );
                }
            });
            
            // Switchers (of the Chart1 type) - onclick handler
            $('.cicswitcher').click(function () {  
                var newType = $(this).attr('id');
                if (activeView == 'score' )
                	ChangeChartType($('#chart0').highcharts().series, newType);
                if (activeView == 'stats')
                	ChangeChartType($('#columnContainer').highcharts().series, newType);
            });
            
           
				
	  });

	  /*					 **
	  **      HELPER 	     **
	  **      METHODS		 **
	  **					 */
	  
	  /* METHODS TO UPDATE COUNTERS*/
	  function updateCounters(data){
	  		
		  		  (categories.avisos)			? console.log() : $( "#counterVal_avisos" ).val(0);
				  (categories.eventos)			? console.log() : $( "#counterVal_eventos" ).val(0); 		 
				  (categories.observador)		? console.log() : $( "#counterVal_observador" ).val(0);  	 
				  (categories.pcomunidad)		? console.log() : $( "#counterVal_pcomunidad" ).val(0);  	 
				  (categories.pseguridad)		? console.log() : $( "#counterVal_pseguridad" ).val(0);  	 
				  (categories.pservicios)		? console.log() : $( "#counterVal_pservicios" ).val(0);  	 
				  (categories.pvialidad)		? console.log() : $( "#counterVal_pvialidad" ).val(0);  	 
				  (categories.incendio)			? console.log() : $( "#counterVal_incendio" ).val(0);  	 
				  (categories.robo) 			? console.log() : $( "#counterVal_robo" ).val(0); 		 
				  (categories.sitriesgo) 		? console.log() : $( "#counterVal_sitriesgo" ).val(0); 	 
				  (categories.alcantarillas)	? console.log() : $( "#counterVal_alcantarillas" ).val(0);  
				  (categories.alumbrado)		? console.log() : $( "#counterVal_alumbrado" ).val(0);  	 
				  (categories.electricidad)		? console.log() : $( "#counterVal_electricidad" ).val(0);   
				  (categories.fuga) 			? console.log() : $( "#counterVal_fuga" ).val(0); 		 
				  (categories.parques) 			? console.log() : $( "#counterVal_parques" ).val(0); 	 
				  (categories.basura) 			? console.log() : $( "#counterVal_basura" ).val(0); 	 
				  (categories.accidente) 		? console.log() : $( "#counterVal_accidente" ).val(0); 	 
				  (categories.bache) 	 		? console.log() : $( "#counterVal_bache" ).val(0); 
				  (categories.obras) 			? console.log() : $( "#counterVal_obras" ).val(0); 	 
				  (categories.semaforo) 	 	? console.log() : $( "#counterVal_semaforo" ).val(0); 
				  (categories.emergencias)		? console.log() : $( "#counterVal_emergencias" ).val(0); 
				  
		        for (var i = 0; i < data.total_rows; i++) { 
				     if (data.rows[i].post_cat == "AVISOS") $( "#counterVal_avisos" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "EVENTO PUBLICO") $( "#counterVal_eventos" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "OBSERVADOR CIUDADANO") $( "#counterVal_observador" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "PROPUESTA COMUNIDAD") $( "#counterVal_pcomunidad" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "PROPUESTA SEGURIDAD") $( "#counterVal_pseguridad" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "PROPUESTA SERV PUBLICOS") $( "#counterVal_pservicios" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "PROPUESTA VIALIDAD") $( "#counterVal_pvialidad" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "INCENDIO") $( "#counterVal_incendio" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "ROBO") $( "#counterVal_robo" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "SITUACION DE RIESGO") $( "#counterVal_sitriesgo" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "ACCIDENTE") $( "#counterVal_accidente" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "BACHE O VIA DAÑADA") $( "#counterVal_bache" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "OBRAS Y/O VIA CERRADA") $( "#counterVal_obras" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "SEMAFORO DESCOMPUESTO") $( "#counterVal_semaforo" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "ALCANTARILLAS") $( "#counterVal_alcantarillas" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "ALUMBRADO PUBLICO") $( "#counterVal_alumbrado" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "FALTA ELECTRICIDAD") $( "#counterVal_electricidad" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "FUGA") $( "#counterVal_fuga" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "PARQUES DESCUIDADOS") $( "#counterVal_parques" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "RECOLECCION DE BASURA") $( "#counterVal_basura" ).val(addCommas(data.rows[i].count));
				     if (data.rows[i].post_cat == "EMERGENCIAS") $( "#counterVal_emergencias" ).val(addCommas(data.rows[i].count));
			    } 
	  
	  
	  
	  }
	  function addCommas(val){
			while (/(\d+)(\d{3})/.test(val.toString())){
		      val = val.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
		    }
			return val;
  	  }
	  
	  /* METHODS FOR ACTIVE FILTERS*/
	  function updateActiveFilters(){
	  var divCat = document.getElementById("activeF_Cat");  var htmlCat = "";
	  var divDat = document.getElementById("activeF_Dat");	var htmlDat = "";
	  var divMun = document.getElementById("activeF_Mun");	var htmlMun = "";
	  var divSta = document.getElementById("activeF_Sta");	var htmlSta = "";
	  var divDis = document.getElementById("activeF_Dis");	var htmlDis = "";
	  anyFilter=false;
	   
if (categories.avisos){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Avisos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.eventos){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Eventos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.observador){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Observador\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.pcomunidad){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"P Comunidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.pseguridad){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"P Seguridad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.pservicios){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"P Servicios\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.pvialidad){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"P Vialidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.incendio){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Incendio\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.robo){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Robo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.sitriesgo){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Sit Riesgo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.alcantarillas){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Alcantarilla\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.alumbrado){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Alumbrado\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.electricidad){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Electricidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.fuga){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Fuga\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.parques){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Parques\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.basura){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Basura\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.accidente){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Accidente\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.bache){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Baches\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.obras){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Obras\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.semaforo){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Semáforos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (categories.emergencias){
htmlCat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Emergencias\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
	  
if (dates.calendario){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Calendario\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.sietedias){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"7 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.quincedias){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"15 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.treintadias){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"30 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.noventadias){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"90 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.domingo){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Domingo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.lunes){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Lunes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.martes){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Martes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.miercoles){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Miércoles\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.jueves){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Jueves\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.viernes){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Viernes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}  
if (dates.sabado){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Sábado\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.ulthoras){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Últimas hrs\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (dates.horasdeldia){
htmlDat+="<br><input type=\"text\" class=\"rangevalue\" value=\"Rango hrs\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}	  
	  	  
if (mun.mty){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Monterrey\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.sp){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"San Pedro\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.sn){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"San Nicolás\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.sc){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Sta Catarina\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.gpe){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Guadalupe\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.apo){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Apodaca\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.esc){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Escobedo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.jua){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Juárez\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (mun.gar){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"García\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (mun.stg){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Santiago\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (mun.cad){
htmlMun+="<br><input type=\"text\" class=\"rangevalue\" value=\"Cadereyta\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}	  
	   
if (repStatus.open){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"Abiertos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 
if (repStatus.closed){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"Cerrados\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (repStatus.closed_fail){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"C. Fallo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (votos){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"Votos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (star){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"Calificación\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}
if (qassets){
htmlSta+="<br><input type=\"text\" class=\"rangevalue\" value=\"Imágenes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 

if (radius.set){
htmlDis+="<br><input type=\"text\" class=\"rangevalue\" value=\"Radio\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 

if (polyfilter){
htmlDis+="<br><input type=\"text\" class=\"rangevalue\" value=\"Polígonos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;} 	

if (closedistance){
htmlDis+="<br><input type=\"text\" class=\"rangevalue\" value=\"Ubicación\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>"; anyFilter=true;}    

if (searchInput!="") anyFilter = true;
	   
	  /// UPDATE DIVS ACCORDINGLY /// 
		  if (anyFilter ){
			    divCat.innerHTML="<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-categories.png\">	Categorías</h3></center>" +htmlCat;
		    	divDat.innerHTML="<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-calendar.png\">	Fecha</h3></center>"+htmlDat;
		    	divMun.innerHTML="<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-municip.png\">	Municipio</h3></center>"+htmlMun;
		    	divSta.innerHTML="<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-lock.png\">	Detalle</h3> </center>"+htmlSta;
		    	divDis.innerHTML="<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-polygon.png\">	Distancia</h3></center>"+htmlDis;
		    	
		    	$('.activeslide').css('opacity', '0.9'); $('.activeslide').css('cursor', 'pointer');
		    	
		  } else{
			   $('.activeslide').css('opacity', '0.3'); $('.activeslide').css('cursor', 'default');
		  }
	  }
	  function resetFilters(){
		  	categories = {
			  avisos : false,
			  eventos : false,
			  observador : false,
			  pcomunidad : false,
			  pseguridad : false,
			  pservicios : false,
			  pvialidad : false,
			  incendio : false,
			  robo : false,
			  sitriesgo : false,
			  alcantarillas : false,
			  alumbrado : false,
			  electricidad : false,
			  fuga : false,
			  parques : false,
			  basura : false,
			  accidente : false,
			  bache : false,
			  obras : false,
			  semaforo : false,
			  emergencias : false
		  };
		  	dates = {
			  calendario :  false,
			  sietedias : false,
			  quincedias : false,
			  treintadias : false,
			  noventadias : false,
			  ulthoras : false,
			  horasdeldia : false,
			  domingo: false,
			  lunes: false, 
			  martes: false,
			  miercoles: false,
			  jueves: false,
			  viernes: false,
			  sabado: false
		  };
		  	mun = {
		  	  mty : false,
		  	  sp : false,
		  	  sn : false,
		  	  sc : false,
		  	  gpe : false,
		  	  apo : false,
		  	  esc : false,
		  	  jua : false,
		  	  gar : false,
		  	  cad : false,
		  	  stg : false
		  };
		  	repStatus = {
		  	  open : false,
		  	  closed : false,
		  	  closed_fail : false
		  };
		  	radius.set =false;
		  	polyfilter = false;
		  	closedistance=false;
		  	votos= false;
		  	star=false;
		  	qassets=false;
		    $('#avisos').attr('checked', false);
			$('#eventos').attr('checked', false);
			$('#observador').attr('checked', false);
			$('#pcomunidad').attr('checked', false);
			$('#pseguridad').attr('checked', false);
			$('#pservicios').attr('checked', false);
			$('#pvialidad').attr('checked', false);
			$('#incendio').attr('checked', false);
			$('#robo').attr('checked', false);
			$('#sitriesgo').attr('checked', false);
			$('#alcantarillas').attr('checked', false);
			$('#alumbrado').attr('checked', false);
			$('#electricidad').attr('checked', false);
			$('#fuga').attr('checked', false);
			$('#parques').attr('checked', false);
			$('#basura').attr('checked', false);
			$('#accidente').attr('checked', false);
			$('#bache').attr('checked', false);
			$('#obras').attr('checked', false);
			$('#semaforo').attr('checked', false);
			$('#emergencias').attr('checked', false);
		    $('#calendario').attr('checked', false);
			$('#sietedias').attr('checked', false);
			$('#quincedias').attr('checked', false);
			$('#treintadias').attr('checked', false);
			$('#noventadias').attr('checked', false);
			$('#ulthoras').attr('checked', false);
		    $('#horasdeldia').attr('checked', false);
		    $('#amount1').attr('checked', false);
		    $('#domingo').attr('checked', false);
		    $('#lunes').attr('checked', false);
		    $('#martes').attr('checked', false);
		    $('#miercoles').attr('checked', false);
		    $('#jueves').attr('checked', false);
		    $('#viernes').attr('checked', false);
		    $('#sabado').attr('checked', false);
		    $('#monterrey').attr('checked', false);
			$('#sanpedro').attr('checked', false);
			$('#sannico').attr('checked', false);
			$('#santacat').attr('checked', false);
			$('#guadalupe').attr('checked', false);
			$('#apodaca').attr('checked', false);
			$('#escobedo').attr('checked', false);
			$('#juarez').attr('checked', false);
			$('#garcia').attr('checked', false);
			$('#cadereyta').attr('checked', false);
			$('#santiago').attr('checked', false);
	        $('#abierto').attr('checked', false);
			$('#cerrado').attr('checked', false);
			$('#cerradofail').attr('checked', false);
		    $('#radius').attr('checked', false);
		    $('#polyfilter').attr('checked', false);
		    $('#closedistance').attr('checked', false);
		    $('#voto').attr('checked', false);
		    $('#star').attr('checked', false);
		    $('#asset').attr('checked', false);
			clearGeo();
			drawCircle();
			clearPolygons();
		  map.setZoom(11);
		  execRepOffset=0;
		  setQ();
	  }
	  
	  /* METHODS TO HIDE FILTER SLIDE*/	
	  function fade(auxSlide){
			if (auxSlide == 'filtercate')$( "#filtercate:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterdate')$( "#filterdate:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filtermuni')$( "#filtermuni:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterstat')$( "#filterstat:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterdist')$( "#filterdist:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'all'){
					$( "#filtercate:visible" ).hide('fold', {}, 400);
					$( "#filterdate:visible" ).hide('fold', {}, 400);
					$( "#filtermuni:visible" ).hide('fold', {}, 400);
					$( "#filterstat:visible" ).hide('fold', {}, 400);
					$( "#filterdist:visible" ).hide('fold', {}, 400);
					$( '#report-content:visible').hide('fold', {}, 400); 
					$( '#infowindow:visible').hide('fold', {}, 400);
					$( '.activeslide:visible').hide('fold', {}, 400); 
					$( '.activesslide:visible').hide('fold', {}, 400);
					$( '.counterslide:visible').hide('fold', {}, 400);
			}
			if (auxSlide == 'showSlides'){
					$( '.activeslide:hidden').show('fold', {}, 400); 
					$( '.counterslide:hidden').show('fold', {}, 400);
					$( '#report-content:visible').hide('fold', {}, 400); 
					$( '#infowindow:visible').hide('fold', {}, 400);
					$( "#filtercate:visible" ).hide('fold', {}, 400);
					$( "#filterdate:visible" ).hide('fold', {}, 400);
					$( "#filtermuni:visible" ).hide('fold', {}, 400);
					$( "#filterstat:visible" ).hide('fold', {}, 400);
					$( "#filterdist:visible" ).hide('fold', {}, 400);
			}
	  }
	  
	  /* METHODS FOR ADDITIONAL CATEGORIES FILTERING*/
	  function multipleCat(group, aux){
	  	aux = typeof aux !== 'undefined' ? aux : true;
	  	var q = true;
		  switch (group){
			  case 'comunidad':
			        if (!categories.avisos || !categories.eventos || !categories.observador) aux=true; else aux = false;
			  		categories.avisos = aux;
					categories.eventos = aux;
					categories.observador = aux;
					document.getElementById("avisos").checked =aux;
					document.getElementById("eventos").checked =aux;
					document.getElementById("observador").checked =aux;
			  break;
			  case 'propuestas':
			        if (!categories.pcomunidad || !categories.pseguridad || !categories.pservicios || !categories.pvialidad) aux=true; else aux = false;
			  		categories.pcomunidad = aux;
					categories.pseguridad = aux;
					categories.pservicios = aux;
					categories.pvialidad = aux;
					document.getElementById("pcomunidad").checked =aux;
					document.getElementById("pseguridad").checked =aux;
					document.getElementById("pservicios").checked =aux;
					document.getElementById("pvialidad").checked =aux;
			  break;
			  case 'seguridad':
			  		if (!categories.incendio || !categories.robo || !categories.sitriesgo) aux=true; else aux = false;
			  		categories.incendio = aux;
					categories.robo = aux;
					categories.sitriesgo = aux;
					document.getElementById("incendio").checked =aux;
					document.getElementById("robo").checked =aux;
					document.getElementById("sitriesgo").checked =aux;
			  break;
			  case 'servicios':
			  		if (!categories.alcantarillas || !categories.alumbrado || !categories.electricidad ||
			  		    !categories.fuga || !categories.parques || !categories.basura) aux=true; else aux = false;
			  		categories.alcantarillas = aux;
					categories.alumbrado = aux;
					categories.electricidad = aux;
					categories.fuga = aux;
					categories.parques = aux;
					categories.basura = aux;
					document.getElementById("alcantarillas").checked =aux;
					document.getElementById("alumbrado").checked =aux;
					document.getElementById("electricidad").checked =aux;
					document.getElementById("fuga").checked =aux;
					document.getElementById("parques").checked =aux;
					document.getElementById("basura").checked =aux;
			  break;
			  case 'vialidad':
			  		if (!categories.accidente || !categories.bache || !categories.obras || !categories.semaforo) aux=true; else aux = false;
			  		categories.accidente = aux;
					categories.bache = aux;
					categories.obras = aux;
					categories.semaforo = aux;
					document.getElementById("accidente").checked =aux;
					document.getElementById("bache").checked =aux;
					document.getElementById("obras").checked =aux;
					document.getElementById("semaforo").checked =aux;
			  break;
			  case 'emergencia':
			  		if (!categories.emergencias) aux=true; else aux = false;
			  		categories.emergencias = aux;
			  		document.getElementById("emergencias").checked =aux;
			  break;
			  case 'all':
			  		categories.avisos = aux;
					categories.eventos = aux;
					categories.observador = aux;
					document.getElementById("avisos").checked =aux;
					document.getElementById("eventos").checked =aux;
					document.getElementById("observador").checked =aux;
					categories.pcomunidad = aux;
					categories.pseguridad = aux;
					categories.pservicios = aux;
					categories.pvialidad = aux;
					document.getElementById("pcomunidad").checked =aux;
					document.getElementById("pseguridad").checked =aux;
					document.getElementById("pservicios").checked =aux;
					document.getElementById("pvialidad").checked =aux;
					categories.incendio = aux;
					categories.robo = aux;
					categories.sitriesgo = aux;
					document.getElementById("incendio").checked =aux;
					document.getElementById("robo").checked =aux;
					document.getElementById("sitriesgo").checked =aux;
					categories.alcantarillas = aux;
					categories.alumbrado = aux;
					categories.electricidad = aux;
					categories.fuga = aux;
					categories.parques = aux;
					categories.basura = aux;
					document.getElementById("alcantarillas").checked =aux;
					document.getElementById("alumbrado").checked =aux;
					document.getElementById("electricidad").checked =aux;
					document.getElementById("fuga").checked =aux;
					document.getElementById("parques").checked =aux;
					document.getElementById("basura").checked =aux;
					categories.accidente = aux;
					categories.bache = aux;
					categories.obras = aux;
					categories.semaforo = aux;
					document.getElementById("accidente").checked =aux;
					document.getElementById("bache").checked =aux;
					document.getElementById("obras").checked =aux;
					document.getElementById("semaforo").checked =aux;
					categories.emergencias = aux;
			  		document.getElementById("emergencias").checked =aux;
			  		q=false;
			  break;
		  }
		  if (q) setQ();
	  }
	  function filterFromStat(cat){
		  switch (cat){
		  	  case 'ACCIDENTE': multipleCat('all',false); categories.accidente =true; $('#accidente').attr('checked', true); ;break;
		  	  case 'ALCANTARILLAS': multipleCat('all',false); categories.alcantarillas =true; $('#alcantarillas').attr('checked', true); ;break;
		  	  case 'ALUMBRADO PUBLICO': multipleCat('all',false); categories.alumbrado =true; $('#alumbrado').attr('checked', true); ;break;
		  	  case 'AVISOS': multipleCat('all',false); categories.avisos =true; $('#avisos').attr('checked', true); ;break;
		  	  case 'BACHE O VIA DAÑADA': multipleCat('all',false); categories.bache =true; $('#bache').attr('checked', true); ;break;
		  	  case 'EMERGENCIAS': multipleCat('all',false); categories.emergencias =true; $('#emergencias').attr('checked', true); ;break;
		  	  case 'EVENTO PUBLICO': multipleCat('all',false); categories.eventos =true; $('#eventos').attr('checked', true); ;break;
		  	  
		  	  case 'FALTA ELECTRICIDAD': multipleCat('all',false); categories.electricidad =true; $('#electricidad').attr('checked', true); ;break;
		  	  case 'FUGA': multipleCat('all',false); categories.fuga =true; $('#fuga').attr('checked', true); ;break;
		  	  case 'INCENDIO': multipleCat('all',false); categories.incendio =true; $('#incendio').attr('checked', true); ;break;
		  	  case 'OBRAS Y/O VIA CERRADA': multipleCat('all',false); categories.obras =true; $('#obras').attr('checked', true); ;break;
		  	  case 'OBSERVADOR CIUDADANO': multipleCat('all',false); categories.observador =true; $('#observador').attr('checked', true); ;break;
		  	  case 'PARQUES DESCUIDADOS': multipleCat('all',false); categories.parques =true; $('#parques').attr('checked', true); ;break;
		  	  case 'PROPUESTA COMUNIDAD': multipleCat('all',false); categories.pcomunidad =true; $('#pcomunidad').attr('checked', true); ;break;
		  	  
		  	  case 'PROPUESTA SEGURIDAD': multipleCat('all',false); categories.pseguridad =true; $('#pseguridad').attr('checked', true); ;break;
		  	  case 'PROPUESTA SERV PUBLICOS': multipleCat('all',false); categories.pservicios =true; $('#pservicios').attr('checked', true); ;break;
		  	  case 'PROPUESTA VIALIDAD': multipleCat('all',false); categories.pvialidad =true; $('#pvialidad').attr('checked', true); ;break;
		  	  case 'RECOLECCION DE BASURA': multipleCat('all',false); categories.basura =true; $('#basura').attr('checked', true); ;break;
		  	  case 'ROBO': multipleCat('all',false); categories.robo =true; $('#robo').attr('checked', true); ;break;
		  	  case 'SEMAFORO DESCOMPUESTO': multipleCat('all',false); categories.semaforo =true; $('#semaforo').attr('checked', true); ;break;
		  	  case 'SITUACION DE RIESGO': multipleCat('all',false); categories.sitriesgo =true; $('#sitriesgo').attr('checked', true); ;break;	
			  default:break;
		  }
		  setQ();
	  }
	  
	  /* METHODS FOR QUERYING BY DISTANCE */
	  var drawCircle = function() {
		    if (overlay) overlay.setMap(null);
		    if (overlay_T) overlay_T.setMap(null);
		    if (radius.set) {
		        overlay = new google.maps.Circle({
		            map: map,
		            center: new google.maps.LatLng(radius.lat, radius.lng),
		            radius: radius.rad,
		            strokeColor: "#0000ff",
		            strokeOpacity: 0.60,
		            strokeWeight: 2,
		            fillColor: "#0000ff",
		            fillOpacity: 0.150,
		        });
		        if (map_T != null){
			        overlay_T = new google.maps.Circle({
			            map: map_T,
			            center: new google.maps.LatLng(radius.lat, radius.lng),
			            radius: radius.rad,
			            strokeColor: "#0000ff",
			            strokeOpacity: 0.60,
			            strokeWeight: 2,
			            fillColor: "#0000ff",
			            fillOpacity: 0.150,
			        });
		        }
		    }
		}
	  var updateRadDeg = function(dist) {
		    var deg = 180,
		        brng = deg * Math.PI / 180,
		        dist = dist / 6371000,
		        lat1 = radius.lat * Math.PI / 180,
		        lon1 = radius.lng * Math.PI / 180;
		
		    var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) + Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));
		
		    var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) * Math.cos(lat1), Math.cos(dist) - Math.sin(lat1) * Math.sin(lat2));
		
		    if (isNaN(lat2) || isNaN(lon2)) return null;
		
		    radDeg = radius.lat - (lat2 * 180 / Math.PI);
	  }
	  function updateBounds(){
		  var bounds = new google.maps.LatLngBounds();
		  var myLatLng = new google.maps.LatLng(radius.lat, radius.lng); 
          bounds.extend(myLatLng);myLatLng = new google.maps.LatLng(radius.lat+0.01*radius.rad/1000, radius.lng+0.01*radius.rad/1000);
          bounds.extend(myLatLng);myLatLng = new google.maps.LatLng(radius.lat-0.01*radius.rad/1000, radius.lng-0.01*radius.rad/1000);
          bounds.extend(myLatLng);map.fitBounds(bounds);
	  }
	  function clearPolygons(){
	      drawingManager.setOptions({drawingControl: false});
		  for (i=0;i<shapesArray.length;i++){
		        shapesArray[i].setMap(null);
				}
				shapesArray=[]; 
	  }
	  function takePolygons(){
	      if (radius.set) { drawCircle(); }
		  if (polyfilter){
			  if (activeView == 'torque') { 
			  	drawingManager.setMap(map_T); 
			  	if (shapesArray.length>0){
					for(i=0;i<shapesArray.length;i++){
						shapesArray[i].setMap(map_T);
					}
				}
			  } else{
				drawingManager.setMap(map);
				if (shapesArray.length>0){
					for(i=0;i<shapesArray.length;i++){
						shapesArray[i].setMap(map);
					}
				}  
			  }
			  
		  }
	  }
	  function detectUserLocation(){
		  if (navigator.geolocation) {
		    var timeoutVal = 10 * 1000 * 1000;
		    watchID = navigator.geolocation.watchPosition(
		      mapToPosition, 
		      alertError,
		      { enableHighAccuracy: true, timeout: timeoutVal, maximumAge: 0 }
		    );
		  }
		  else {
		    alert("Geolocation is not supported by this browser");
		  }
		  
		  function alertError(error) {
		    var errors = { 
		      1: 'Permission denied',
		      2: 'Position unavailable',
		      3: 'Request timeout'
		    };
		    alert("Error: " + errors[error.code]);
		  }
	  }
	  function mapToPosition(position){
	    lon = position.coords.longitude;
	    lat = position.coords.latitude;
	    console.log("lon "+lon);
	    console.log("lat "+lat);
        var myLatlng = new google.maps.LatLng(lat, lon);
        map.setCenter(myLatlng);
        map.setZoom(17);
        if (gmarker == null){
        	gmarker = new google.maps.Marker({
			animation: google.maps.Animation.DROP,
			icon: 'images/bt-mapmarker.png',
			position: myLatlng,
			map: map,
		});
		}else{
			gmarker.setPosition(myLatlng);
		}
		gmarkers.push(gmarker);
		setQ();
	  }
	  function clearGeo(){
	      navigator.geolocation.clearWatch(watchID);
					for (i=0;i<gmarkers.length;i++){
						gmarkers[i].setMap(null);
						}
					gmarkers=[];
					gmarker = null;
		  //map.setZoom(11);			
	  }
	  function clearDistance(dist){
		  switch (dist){
		      case "close": 
		      	  radius.set =false; document.getElementById('radius').checked = false;
			  	  polyfilter = false; document.getElementById('polyfilter').checked = false;
			  	  drawCircle();clearPolygons();
				  break;
		      case "rad": 
		      	  closedistance =false; document.getElementById('closedistance').checked = false;
			  	  polyfilter = false; document.getElementById('polyfilter').checked = false;
			  	  clearGeo(); clearPolygons(); 
				  break;
		      case "poly": 
		          closedistance =false; document.getElementById('closedistance').checked = false;
			  	  radius.set =false; document.getElementById('radius').checked = false;
			  	  clearGeo(); drawCircle();
				  break;
			  default: break;
		  }
	  }
	  
	  /* METHOD FOR DATE AND TIME FILTERING */
	  function clearDates(date){
		  switch (date){
		      case "calendario": 
				  dates.sietedias = false; document.getElementById('sietedias').checked = false;
				  dates.quincedias = false; document.getElementById('quincedias').checked = false;
				  dates.treintadias = false; document.getElementById('treintadias').checked = false;
				  dates.noventadias = false; document.getElementById('noventadias').checked = false;
				  dates.ulthoras = false; document.getElementById('ulthoras').checked = false;
				  break;
		      case "sietedias": 
		      	  dates.calendario =  false;document.getElementById('calendario').checked = false;
				  dates.quincedias = false;document.getElementById('quincedias').checked = false;
				  dates.treintadias = false;document.getElementById('treintadias').checked = false;
				  dates.noventadias = false;document.getElementById('noventadias').checked = false;
				  dates.ulthoras = false;document.getElementById('ulthoras').checked = false;
		      	  break;
		      case "quincedias": 
		          dates.calendario =  false;document.getElementById('calendario').checked = false;
				  dates.sietedias = false;document.getElementById('sietedias').checked = false;
				  dates.treintadias = false;document.getElementById('treintadias').checked = false;
				  dates.noventadias = false;document.getElementById('noventadias').checked = false;
				  dates.ulthoras = false;document.getElementById('ulthoras').checked = false;
		          break;
		      case "treintadias": 
		          dates.calendario =  false;document.getElementById('calendario').checked = false;
				  dates.sietedias = false;document.getElementById('sietedias').checked = false;
				  dates.quincedias = false;document.getElementById('quincedias').checked = false;
				  dates.noventadias = false;document.getElementById('noventadias').checked = false;
				  dates.ulthoras = false;document.getElementById('ulthoras').checked = false;
		          break;
		      case "noventadias": 
		      	  dates.calendario =  false;document.getElementById('calendario').checked = false;
				  dates.sietedias = false;document.getElementById('sietedias').checked = false;
				  dates.quincedias = false;document.getElementById('quincedias').checked = false;
				  dates.treintadias = false;document.getElementById('treintadias').checked = false;
				  dates.ulthoras = false;document.getElementById('ulthoras').checked = false;
		      	  break;
		      case "ulthoras": 
		      	  dates.calendario =  false;document.getElementById('calendario').checked = false;
				  dates.sietedias = false;document.getElementById('sietedias').checked = false;
				  dates.quincedias = false;document.getElementById('quincedias').checked = false;
				  dates.treintadias = false;document.getElementById('treintadias').checked = false;
				  dates.noventadias = false;document.getElementById('noventadias').checked = false;
		      	  break;
			  default: break;
		  }
	  }
	  	  
	  /* METHOD FOR WORDLE WORD CLICK ACTION*/
	  function wordClick(text){
		  	searchInput = text;
		  	changeView('home');
		  	setTimeout(function () {
		  		$('.searchMeme-input-right input').val(text); 
		  		$('.searchMeme-input-right input').css({ 'margin-left': 0, paddingLeft: 3, paddingRight: 3 });
		  		$('.searchMeme-input-right input').animate({ marginLeft: 0, paddingLeft: 3, paddingRight: 3 });
		  	}, 1000);
	  }
	  
	  /* METHODS FOR DRAWING CO-OCCURRENCE*/
	  function drawTiles() {
	
			var calcs = _getCalcs(),
				range = [];
			for (var i = 1; i <= buckets; i++) {
				range.push(i);
			}
			
			var bucket = d3.scale.quantize().domain([0, calcs.max > 0 ? calcs.max : 1]).range(range),
			side = d3.select('#tiles').attr('class');
	
	
			if (side === 'front') {
				side = 'back';
			} else {
				side = 'front';
			}
			
			for (var d = 0; d < formattedData.length; d++) {
				for (var h = 0; h < formattedData[d].length; h++) {
		
					var sel = '#d' + d + 'h' + h + ' .tile .' + side,
						val = formattedData[d][h];
					
					// erase all previous bucket designations on this cell
					for (var i = 1; i <= buckets; i++) {
						var cls = 'q' + i + '-' + buckets;
						d3.select(sel).classed(cls , false);
					}
					
					// set new bucket designation for this cell
					var cls = 'q' + (val > 0 ? bucket(val) : 0) + '-' + buckets;
					d3.select(sel).classed(cls, true);
				}
			}
			flipTiles();
			_drawHourlyChart(-1);
		}
	  function _getCalcs() {
	
			var min = 1,
				max = -1;
			
			// calculate min + max
			for (var d = 0; d < formattedData.length; d++) {
				for (var h = 0; h < formattedData[d].length; h++) {
					
					var tot = formattedData[d][h];
					
					
					if (tot > max) {
						max = tot;
					}
					
					if (tot < min) {
						min = tot;
					}
				}
			}
			
			return {'min': min, 'max': max};
		}
	  function _drawHourlyChart(day) {
	
			d3.selectAll('#hourly_values svg').remove();
			
			var w = 1000,
				h = 150;
			
			var weeklyData = new Array(24);
			for (var x=0; x<24; x++){
				weeklyData[x] = 0;
			}
			if (day != -1)
				weeklyData = formattedData[day];
			else
				for (var x=0;x<7;x++){
					for (var y=0; y<24;y++)
						weeklyData[y] += formattedData[x][y];
				}
							
			var y = d3.scale.linear()
				.domain([0, d3.max(weeklyData, function(d) { return d })])
				.range([0, h]);
		
			
			var chartOccu = d3.select('#hourly_values .svg')
				.append('svg:svg')
				.attr('class', 'chartOccu')
				.attr('width', 1000)
				.attr('height', 170);
				
			var rect = chartOccu.selectAll('rect'),
				text = chartOccu.selectAll('text');
			
			rect.data(weeklyData)
				.enter()
					.append('svg:rect')
						.attr('x', function(d, i) { return i * 42; })
						.attr('y', function(d) { return h - y(d) })
						.attr('height', function(d) { return y(d)})
						.attr('width', 37)
						.attr('class', function(d, i) { return 'hr' + i});
			
			text.data(hours)
				.enter()
					.append('svg:text')
						.attr('class', function(d, i) { return (i % 3) ? 'hidden hr' + i : 'visible hr' + i })
						.attr("x", function(d, i) { return i * 42 })
						.attr("y", 166)
						.attr("text-anchor", 'left')
						.text(String);
	  }
	  function flipTiles() {

		var oldSide = d3.select('#tiles').attr('class'),
			newSide = '';
		
		if (oldSide == 'front') {
			newSide = 'back';
		} else {
			newSide = 'front';
		}
		
		var flipper = function(h, d, side) {
			return function() {
				var sel = '#d' + d + 'h' + h + ' .tile',
					rotateY = 'rotateY(180deg)';
				
				if (side === 'back') {
					rotateY = 'rotateY(0deg)';	
				}
				
				d3.select(sel).style('-webkit-transform', rotateY);
			};
		};
		
		for (var h = 0; h < hours.length; h++) {
			for (var d = 0; d < days.length; d++) {
				var side = d3.select('#tiles').attr('class');
				setTimeout(flipper(h, d, side), (h * 20) + (d * 20) + (Math.random() * 100));
			}
		}
		d3.select('#tiles').attr('class', newSide);
	}
	  function createTiles() {
		
			var html = '<table id="tiles" class="front">';
		
			html += '<tr><th><div>&nbsp;</div></th>';
		
			for (var h = 0; h < hours.length; h++) {
				html += '<th class="h' + h + '">' + hours[h] + '</th>';
			}
			
			html += '</tr>';
		
			for (var d = 0; d < days.length; d++) {
				html += '<tr class="d' + d + '">';
				html += '<th>' + days[d].abbr + '</th>';
				for (var h = 0; h < hours.length; h++) {
					html += '<td id="d' + d + 'h' + h + '" class="d' + d + ' h' + h + '"><div class="tile"><div class="face front"></div><div class="face back"></div></div></td>';
				}
				html += '</tr>';
			}
			
			html += '</table>';
			d3.select('#vis').html(html);
		}
	  function selectHourlyChartBar(hour) {

		d3.selectAll('#hourly_values .chartOccu rect').classed('sel', false);
		d3.selectAll('#hourly_values .chartOccu rect.hr' + hour).classed('sel', true);
		d3.selectAll('#hourly_values .chartOccu text').classed('hidden', true);
		d3.selectAll('#hourly_values .chartOccu text.hr' + hour).classed('hidden', false);
	
	}
	  
	  /* METHODS FOR DRAWING SCORE CHARTS*/
	  function drawScore(score,status,origin){
	  		var promSPmun = {};
	  		var promSPcat = {};
	  		var contcat=0;
	  		var promcatarray = [];
	  		var size = 0;
	  		var temp=0;
	  		var promOb = new Object();
			promOb['type'] = 'spline';
			promOb['name'] = 'DIAS PROMEDIO'; 
			promOb['visible'] = false;
			promOb['marker'] = {lineWidth: 4,
	         				 	lineColor: Highcharts.getOptions().colors[3],
			 				 	fillColor: 'white'};
	  		for (var mun in score){
				var data = [];
				var suma = 0;
				var cont = 0;
				for (var cat in score[mun]){
					data.push(score[mun][cat]);
					suma +=score[mun][cat];
					if (score[mun][cat] != 0) cont++;
					if(contcat==0){
						promSPcat[cat] = score[mun][cat];
					}else{
						promSPcat[cat] += score[mun][cat];	
					}
				}
				contcat++;
				if (cont == 0) promSPmun[mun] = 0; else promSPmun[mun] = Math.round(suma/cont);
				var series = new Object();
				series['data']= data;
				series['name']= getFullName(mun);
			 	$('#chart0').highcharts().addSeries(series);
			}
			for (var cat in promSPcat){
				size++;
			}
			//console.log("size");
			//console.log(size);
			for (var cat in promSPcat){
				//console.log(promSPcat[cat]);
				promcatarray[temp]= Math.round(promSPcat[cat]/size);
				temp++;
			}
			promOb['data'] = promcatarray;
			$('#chart0').highcharts().addSeries(promOb);
			$('#chart0').highcharts().hideLoading();
			//console.log("PromediosPorMunicipio");
			//console.log(promSPmun);
			//console.log("TotalesPorCategoria");
			//console.log(promSPcat);
			//console.log("PromediosPorCategoria");
			//console.log(promcatarray);
			for (var mun in score) plotCounty(status,origin,mun);
			fillSummary(effectPercent,promSPmun);
			$("#accordion").accordion({disabled: false});
			$('.ui-accordion .ui-accordion-header').css("opacity", "1");			
	  }
	  function plotCounty(status, origin, mun) {
			var datalabel = true;
			var datapie = [];
			var datawfall = [];
			var tempo = 0;
			var total_mun=0;
			
			var cerrados= 0;
			var cerradosfail= 0;
		
			//SERIES FOR PIE
			for (var cat in status[mun]){
					var total =0;
					for (var stat in status[mun][cat]){
						total += status[mun][cat][stat];
						if(stat == 'cerrado'){
							cerrados += status[mun][cat][stat];
						}else if(stat == 'fallo'){
							cerradosfail += status[mun][cat][stat];
						}
					}
					total_mun += total;
					datapie[tempo]= [cat,total];
					tempo++;
				}
			effectPercent[mun]= Math.round(((cerrados)/(cerrados+cerradosfail))*100);
			if(isNaN(effectPercent[mun])) {
				effectPercent[mun] = 0;
			}
			//console.log("Los datos de series para el pie");
			//console.log(datapie);
			//console.log("Total municipio "+mun);
			//console.log(total_mun);		
		
			//SERIES FOR WATERFALL
			tempo = 0;
				for (var cat in status[mun]){
						var series = new Object();
						series['name']= cat;
						series['y']= status[mun][cat]['abierto'];
						datawfall[tempo]= series;
						tempo++;
						}
						var series = new Object();
						series['name']= 'Total Reportado';
						series['isIntermediateSum']= true;
						series['color']= Highcharts.getOptions().colors[0];
						datawfall[tempo]= series;
						tempo++;
				for (var cat in status[mun]){
						var series = new Object();
						series['name']= "CERRADOS "+cat;
						series['y']= status[mun][cat]['cerrado']*-1;
						datawfall[tempo]= series;
						tempo++;
						}
						var series = new Object();
						series['name']= 'Total Pendientes';
						series['isSum']= true;
						series['color']= Highcharts.getOptions().colors[2];
						datawfall[tempo]= series;
			//console.log("Serie para waterfall");
			//console.log(datawfall);
			
			var chartID = 'chart'+mun;
			var county = getFullName(mun);
			if (total_mun == 0){datalabel = false;}
			
			chart1 = new Highcharts.Chart({
					chart: {
						renderTo: chartID+'1',
						height: 350,
						backgroundColor: {
					       linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
					         stops: [
					            [0, 'rgb(255, 255, 255)'],
					            [1, 'rgb(240, 240, 255)']
					         ]
					    },
				        borderWidth: 2,
				        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
				        plotShadow: true,
				        plotBorderWidth: 1
					},
					title: {
						text: county + ' (Últimos 90 días)'
					},
					subtitle: {
						text: 'Flujo de Reportes por Categoría (Total de Reportes: ' + total_mun + ')'
					},
					tooltip: {
						formatter: function() {
							return '<b style="color: {series.color}">' + this.point.name + '</b>: ' + this.y + ' (' + Math.round(this.percentage) + ' %)';
						}
					},
					loading:   {
					                    style: {
					                        fontSize: '40px',
					                        opacity: .75
					                    },
					                    labelStyle: {
					                        top: '45%'
					                    }
			                },
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: false,
								color: '#000000',
								connectorColor: '#000000',
								formatter: function() {
									return '<b>' + this.point.percentage;
								}
							},
							showInLegend: datalabel
						}
					},
					series: [{
						type: 'pie',
						name: 'Reportes',
						data: datapie
					}]
				});
			
			chart2 = new Highcharts.Chart({
					chart: {
						type: 'waterfall',
						renderTo: chartID + '2',
						height: 350,
						backgroundColor: {
					       linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
					         stops: [
					            [0, 'rgb(255, 255, 255)'],
					            [1, 'rgb(240, 240, 255)']
					         ]
					    },
				        borderWidth: 2,
				        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
				        plotShadow: true,
				        plotBorderWidth: 1
						
					},
					title: {
						text: county + ' (Últimos 90 días)'
					},
					subtitle: {
						text: 'Balance de Reportes Abiertos/Cerrados (Total de Reportes: ' + total_mun + ')'
					},
					loading:   {
					                    style: {
					                        fontSize: '40px',
					                        opacity: .75
					                    },
					                    labelStyle: {
					                        top: '45%'
					                    }
			                },
					xAxis: {
						title: {
							text: 'Reportes Abiertos y Cerrados por Categoría'
						},
						labels: {
			                enabled: false
			            }
					},
					yAxis: {
						title: {
							text: 'Cantidad de Reportes'
						},
						labels: {
			                enabled: false
			            },
						minorGridLineWidth: 0,
						lineColor: 'transparent'
					},
					legend: {
						enabled: false
					},
					tooltip: {
						pointFormat: '<b>{point.y}</b> Reportes'
					},
					series: [{
						upColor: Highcharts.getOptions().colors[1],
						color: Highcharts.getOptions().colors[3],
						data: datawfall,
						dataLabels: {
							enabled: true,
							formatter: function() {
								return Highcharts.numberFormat(this.y, 0, ',');
							},
							style: {
								color: '#FFFFFF',
								fontWeight: 'bold'
							}
						},
						pointPadding: 0
					}]
				});
			
			chart3 = new Highcharts.Chart({
					chart: {
						type: 'funnel',
						renderTo: chartID + '3',
						height: 350,
						backgroundColor: {
					       linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
					         stops: [
					            [0, 'rgb(255, 255, 255)'],
					            [1, 'rgb(240, 240, 255)']
					         ]
					    },
				        borderWidth: 2,
				        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
				        plotShadow: true,
				        plotBorderWidth: 1
					},
					title: {
						text: county + ' (Últimos 90 días)'
					},
					subtitle: {
						text: 'Vía del Reporte (Total de Reportes: ' + total_mun + ')'
					},
					loading:   {
					                    style: {
					                        fontSize: '40px',
					                        opacity: .75
					                    },
					                    labelStyle: {
					                        top: '45%'
					                    }
			                },
					plotOptions: {
						series: {
							dataLabels: {
								enabled: datalabel,
								format: '<b>{point.name}</b> ({point.y:,.0f})',
								color: 'black',
								softConnector: true
							},
							width: '60%',
							height: '98%'
						}
					},
					legend: {
						enabled: false
					},
					series: [{
						name: 'Reportes',
						data: [
							['Redes Sociales', origin[mun].twitter],
							['Sitio Web', origin[mun].web],
							['Tehuan APP', origin[mun].app],
							['CIC CRM', origin[mun].crm],
							['Email', origin[mun].email],
							['SMS', origin[mun].sms]
						]
					}]
				});
			
			if (total_mun == 0){
				chart1.showLoading('No hay información del Municipio Seleccionado');
				chart2.showLoading('No hay información del Municipio Seleccionado');
				chart3.showLoading('No hay información del Municipio Seleccionado');
			}
			
			//console.log("% de efectividad");
			//console.log(effectPercent);
	  }
	  function fillSummary(effectPercent,promSPmun){
			var html="";
			//console.log('ePercent');
			//console.log(effectPercent);
			//console.log('promSPmun');
			//console.log(promSPmun);
			html+= '<table border="1" bordercolor="#163D74" style="background-color:#FFF" width="100%" cellpadding="3" cellspacing="3">';
			html+= '<tr style="background-color:#163D74; color: #FFF;" align="center" valign="middle" ><td>Municipio</td><td>Tiempo promedio de resolución en días</td><td>Porcentaje de resolución exitosa</td></tr>';
			for (var mun in effectPercent){
			   if (promSPmun[mun] != 0)
			   	html+= '<tr align="center" valign="middle" style="background-color:#FFF; color: #163D74;"><td>'+ getFullName(mun) +'</td><td>'+ promSPmun[mun] +'</td><td>'+ effectPercent[mun] +' %</td></tr>';
			   else
			   	html+= '<tr align="center" valign="middle" style="background-color:#FFF; color: #163D74;"><td>'+ getFullName(mun) +'</td><td>'+ 'N/A' +'</td><td>'+ 'N/A' +'</td></tr>';
			}
			html+='</table>';
			$('#chartRC').append(html);  
	  }
	  function ChangeChartType(series, newType) {
			newType = newType.toLowerCase();
			for (var i = 0; i < series.length; i++) {
				if (newType == 'column') series[i].update({
					type: newType
				});
				else series[i].update({
					type: newType,
					animation: true
				});
			}
		}
	  function getFullName(name){
	  		switch(name){
		  		case 'APO': return 'Apodaca';
		  		case 'CAD': return 'Cadereyta';
		  		case 'ESC': return 'Escobedo';
		  		case 'GAR': return 'García';
		  		case 'GPE': return 'Guadalupe';
		  		case 'JUA': return 'Juárez';
		  		case 'MTY': return 'Monterrey';
		  		case 'SC': return 'Santa Catarina';
		  		case 'SN': return 'San Nicolás';
		  		case 'SP': return 'San Pedro';
		  		case 'STG': return 'Santiago';
		  		default: break;
	  		}
	  }
	  
	  /*					 **
	  **      VIEWS 	     **
	  **      METHODS		 **
	  **					 */
	  
	  /* METHOD FOR BUILDING STATS VIEW */
	  function displayStats(querytehuan){
			var mun_p=[],mun_p_nonzero = [];
			var categorias=[];
			var auxCat=0;
			var bigo={};
			var biga={};
			var querypoly,queryStats;
			var nrmlpob = {
				APO:11.31,
				CAD:2.69,
				ESC:4.43,
				GAR:6.78,
				GPE:3.58,
				JUA:5.23,
				MTY:1.23,
				SC:2.57,
				SN:1.44,
				SP:0.86,
				STG:0.4
			};
			var nrmlkm = {
				APO:238,
				CAD:1141,
				ESC:151,
				GAR:1040,
		  		GPE:118, 
		  		JUA:247, 
		  		MTY:324,
		  		SC:885,
		  		SN:60,
		  		SP:72,
		  		STG:764
			};
			
			//Define Chart
			$('#columnContainer').highcharts({
				        chart: {
				            type: 'column',
							zoomType: 'xy',
							height: '450'
				        },
				        title: {
				            text: 'Cantidad de Reportes por Municipio'
				        },
				        subtitle: {
				            text: 'Utilice los filtros para una mejor apreciación. Tip: zoom con clic y arrastre.'
				        },
				        xAxis:{
					      title: {
						      text: 'Municipios'
					      }  
				        },
				        yAxis: {
				            min: 0,
				            title: {
				                text: 'Total de Reportes'
				            }
				        },
				        legend: {
					        enabled:true,
					         align: 'right',
							 verticalAlign: 'top',
							 floating:false,
							 layout: 'vertical',
							 title: {
			                    text: 'Categorías<br/><span style="font-size: 9px; color: #666; font-weight: normal">(Clic para desaparecer)</span>',
			                    style: {
			                        fontStyle: 'bold'
			                    }
			                },
			                backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74',
				            y: 40,
				            width: 200
				        },
				        tooltip: {
				            headerFormat: '<span style="font-size:12px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:10px; font-weight: lighter;" >{series.name}: <b>{point.y} reportes</b></div>',
				            footerFormat: '</div>',
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
				        },
				        plotOptions: {
				            column: {
				                pointPadding: 0.2,
				                borderWidth: 0
				            },
					        series: {
					            cursor: 'pointer',
				                point: {
				                    events: {
				                        click: function() {
				                            if ($('#columnContainer').highcharts().series.length >2 && this.series.name != 'PROMEDIO'){ 
				                            	filterFromStat(this.series.name);
				                            }
				                        }
				                    }
				                }
				            }
				        },
				        loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
		                }
					});
			$('#columnContainer').highcharts().showLoading('Recopilando la información, por favor espere...');
	        
			
		    ///SLICE QUERY IN THREE DIFFERENT PARTS FOR SIMPLICITY///
			//SELECT STATEMENT//
			var querycount = "SELECT COUNT("+table_name+".*) as y, "+area_name+".name as ejeX, "+table_name+".post_cat as seriesname FROM "+table_name+", "+area_name+" ";
			//WHERE CLAUSE EXTRACTED FROM ORIGINAL QUERY
			if (querytehuan.search(/where/i) != -1){
				var querywhere = querytehuan.substring(querytehuan.search(/where/i));
			}else{
				var querywhere = "";
			}
			//console.log('---Where clause extracted---');
			//console.log(querywhere);
			///GROUP AND ORDER CLAUSE
			var querygroup = " GROUP BY "+area_name+".name,"+table_name+".post_cat order by "+table_name+".post_cat, "+area_name+".name asc"
			
			///BUILD QUERY FOR COUNTING
			queryStats = querycount + querywhere + querygroup;
			
			//VARIABLES FOR QUERY STRING MANIPULATION
			var m = queryStats.search(' GROUP BY');
			var p = queryStats.search('ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)');
			
			//CHECK FOR POLYGON GEOM INTERSECTION
			if (p === -1){
				var p1= queryStats.search(/where/i);
				if (p1 === -1){
					queryStats = queryStats.splice(m,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)");
				}else{
					queryStats = queryStats.replace("WHERE","");
					queryStats = queryStats.splice(p1,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom) AND ");
				}
			}
			
			//VARIABLES FOR POLYGON QUERY	
			querypoly = "SELECT name FROM "+area_name+" order by name asc";
			var n = queryStats.search('"+area_name+".name =');
			m = queryStats.search(' GROUP BY'); //search again because index might change
			//CHECK TO RETURN JUST QUERIED COUNTIES ON X AXIS
			if (n != -1){
				var o = "("+queryStats.substring(n, m);
				querypoly = "SELECT name FROM "+area_name+" where "+o+" order by name asc";
			}
			//console.log("---Query del poligono para eje X---");
			//console.log(querypoly);
			//console.log("---Query para series de HC---");
			//console.log(queryStats);
			if(closedistance){
				var strr = queryStats;
				var nn=strr.replace(/"+table_name+"/gi, "data");
				queryStats = "WITH data AS ("+_geoq+") "+nn;
			}
			
			//console.log("Query for stats (querypoly):");
		    //console.log(querypoly);
		    //console.log("Query for stats (queryStats):");
 		    //console.log(queryStats);	   
			///Get array from polygon names (includes all municipalities drawn)
			sql.execute(querypoly)
			      .done(function(data) {
				    for (var i = 0; i < data.total_rows; i++) {
			          		mun_p[i] = data.rows[i].name;
			          		bigo[mun_p[i]] = {};
			        }
					//console.log("---Arreglo Municipios:---");
					//console.log(mun_p);
					
					//Manage arrays in preparation for highcharts		
					sql.execute(queryStats)
						.done(function(data) {
					        for (var i = 0; i < data.total_rows; i++) {
							   if (data.rows[i].seriesname != ''){
								   if (data.rows[i].seriesname != 'VIALIDAD'){
								      if (data.rows[i].seriesname != 'OTROS'){
									      ///get categories array
								          if(i===0){
							          		  categorias[auxCat] = data.rows[i].seriesname;
							          		  biga[categorias[auxCat]] = {};
									          auxCat++;
										  }else{
								          	  if(data.rows[i].seriesname != data.rows[i-1].seriesname && categorias[auxCat-1]!= data.rows[i].seriesname){
										  		categorias[auxCat] = data.rows[i].seriesname;
										  		biga[categorias[auxCat]] = {};
										  		auxCat++;
									          }
									      }
										//build and iniciate object of municipalities
										for(var j = 0;j < mun_p.length; j++) {
											  bigo[mun_p[j]][data.rows[i].seriesname] = 0;
										}
									 }
								   }
							   }
							}
							
							for(var j = 0;j < categorias.length; j++) {
								for (var i = 0; i < mun_p.length; i++){
									biga[categorias[j]][mun_p[i]] = 0;
								}
							}
							
							for (var i = 0; i < data.total_rows; i++) {
								if (data.rows[i].seriesname != ''){
									if (data.rows[i].seriesname != 'VIALIDAD'){
										if (data.rows[i].seriesname != 'OTROS'){   
										 	if(normalpob){
										 		bigo[data.rows[i].ejex][data.rows[i].seriesname] = Math.round(data.rows[i].y/nrmlpob[data.rows[i].ejex]);
										 		biga[data.rows[i].seriesname][data.rows[i].ejex] = Math.round(data.rows[i].y/nrmlpob[data.rows[i].ejex]);
										 	} else if (normalkm) {
												bigo[data.rows[i].ejex][data.rows[i].seriesname] = Math.round(data.rows[i].y/nrmlkm[data.rows[i].ejex]);
												biga[data.rows[i].seriesname][data.rows[i].ejex] = Math.round(data.rows[i].y/nrmlkm[data.rows[i].ejex]);
										 	} else {
											 	bigo[data.rows[i].ejex][data.rows[i].seriesname] = data.rows[i].y;
											 	biga[data.rows[i].seriesname][data.rows[i].ejex] = data.rows[i].y;
										 	}
									 	}
									 }
								}
					        }
/*
							console.log("---Objeto de objetos por municipio con totales por categoria---");
							console.log(bigo);

							console.log("---Objeto de objetos por categoria con totales por municipio---");
							console.log(biga);				
*/					
							
							//Extract Series Elements from Objects for average
							var prom = [];
							var tempk=0;
							for (var idz in bigo) {
								var obja = bigo[idz];
								var avg=0;
								var suma = 0;
									for (var property in obja) {
										if(obja.hasOwnProperty(property)){suma +=obja[property];}
									avgrnd=Math.round(avg = suma/categorias.length);
									}
								 if (suma != 0){
										mun_p_nonzero[tempk]= idz;
										prom[tempk] = [idz, avgrnd];
										tempk++;
									}	
								 
							}
							var mun_p_fullname =[];
							for (var i=0; i < mun_p_nonzero.length;i++){mun_p_fullname.push(getFullName(mun_p_nonzero[i]));}
							$('#columnContainer').highcharts().xAxis[0].setCategories(mun_p_fullname);
							//console.log('Mun p non zero');
							//console.log(mun_p_nonzero);
							//console.log("---Promedios---");
							//console.log(prom);							
					
							//Extract Series Elements from Objects for data
							for (var idx in biga) {
								var obje = biga[idx];
								var sum=0;
								var catarray = [];
								
								for(var j = 0;j< mun_p_nonzero.length;j++){
											catarray[j]=obje[mun_p_nonzero[j]];
											sum+=catarray[j];
								}
								 
								 if (sum!=0){
								 	 var series = new Object();
									 series['data']= catarray;
									 series['name']= idx;
								 	 $('#columnContainer').highcharts().addSeries(series);
								 }
							}
							var promOb = new Object();
							promOb['type'] = 'spline';
							promOb['name'] = 'PROMEDIO DE REPORTES'; 
							promOb['data'] = prom;
							promOb['visible'] = false;
							promOb['marker'] = {lineWidth: 4,
					         				 	lineColor: Highcharts.getOptions().colors[3],
							 				 	fillColor: 'white'};
							//$('#columnContainer').highcharts().addSeries(promOb);
							$('#columnContainer').highcharts().hideLoading();
				        }).error(function(errors) {
							// do nothing
						})
			  })
			      .error(function(errors) {
				    // do nothing
				  })
	  }
	  
	  /* METHOD FOR BUILDING TRENDS VIEW */
	  function displayTrends(querytehuan){
		  
		  //define chart
		  $('#timeContainer').highcharts({
			        chart: {
			                zoomType: 'x',
			                spacingRight: 20,
			                height: '450'
			            },
			        title: {
			                text: 'Cantidad de Reportes Diarios'
			            },
		            subtitle: {
			            text: 'Utilice los filtros para una mejor apreciación. Tip: zoom con clic y arrastre.'
			        },
			        xAxis: {
			                type: 'datetime',
			                maxZoom: 14 * 24 * 3600000, // fourteen days
			                title: {
			                    text: null
			                }
			        },
			        yAxis: {
			            min: 0,
			            startOnTick: false,
			            title: {
			                    text: 'Total de Reportes'
			                }
			        },
			        plotOptions: {
			                area: {
			                    fillColor: {
			                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
			                        stops: [
			                            [0, Highcharts.getOptions().colors[0]],
			                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
			                        ]
			                    },
			                    lineWidth: 1,
			                    marker: {
			                        enabled: false
			                    },
			                    shadow: false,
			                    states: {
			                        hover: {
			                            lineWidth: 1
			                        }
			                    },
			                    threshold: null
			                }
			            },
			        series: [{
			        	name: 'Total de reportes',
			        	type: 'area',
/* 			            data: fechas */
			        }],
			        loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
		            },
		            legend: {
					        enabled:true,
					         align: 'left',
							 verticalAlign: 'top',
							 floating:true,
							 layout: 'vertical',
							 title: {
			                    style: {
			                        fontStyle: 'bold'
			                    }
			                },
			                backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74',
				            y: 60,
				            x: 53
				    },
				    scrollbar: {
					        enabled: true
					},
				    
				    tooltip: {
				    		headerFormat: '<span style="font-size:10px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:12px; font-weight: lighter;" >{series.name}:<b>{point.y}</b></div>',
				            footerFormat: '</div>',
				            valueDecimails:0,
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
				        }
			
		   });
		   $('#timeContainer').highcharts().showLoading('Recopilando la información, por favor espere...');
		   
		   ///SLICE QUERY IN THREE DIFFERENT PARTS FOR SIMPLICITY///
			///SELECT STATEMENT///

			if (querytehuan.search(area_name) != -1){
				var querycount = "SELECT date_part('year', "+table_name+".created_at) as year, date_part('month', "+table_name+".created_at) as month, date_part('day', "+table_name+".created_at) as day, count( "+table_name+".*) FROM "+table_name+", "+area_name+" ";
			}else{
				var querycount = "SELECT date_part('year', "+table_name+".created_at) as year, date_part('month', "+table_name+".created_at) as month, date_part('day', "+table_name+".created_at) as day, count( "+table_name+".*) FROM "+table_name+" "
			}

			//WHERE CLAUSE EXTRACTED FROM ORIGINAL QUERY
			if (querytehuan.search(/where/i) != -1){
				var querywhere = querytehuan.substring(querytehuan.search(/where/i));
			}else{
				var querywhere = "";
			}
			//console.log('---Where clause extracted---');
			//console.log(querywhere);
			///GROUP AND ORDER CLAUSE
			var querygroup = " GROUP BY year, month, day ORDER BY year, month, day asc";
			///BUILD QUERY FOR COUNTING
			var queryTrends = querycount + querywhere + querygroup;
			
			//VARIABLES FOR QUERY STRING MANIPULATION
			var m = queryTrends.search(' GROUP BY');
			var p = queryTrends.search('ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)');
			
			//CHECK FOR POLYGON GEOM INTERSECTION
			if (querytehuan.search('"+area_name+"') != -1){
				if (p === -1){
					var p1= queryTrends.search(/where/i);
					if (p1 === -1){
						queryTrends = queryTrends.splice(m,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)");
					}else{
						queryTrends = queryTrends.replace("WHERE","");
						queryTrends = queryTrends.splice(p1,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom) AND ");
					}
				}
			}
		    console.log("Query for trends:");
		    console.log(queryTrends);
		    if(closedistance){
				var str     = queryTrends;
				var n       = str.replace(/"+table_name+"/gi, "data");
				queryTrends = "WITH data AS ("+_geoq+") "+n;
			}
		    var fechas = [];
		    
		    sql.execute(queryTrends)
				.done(function(data) {
			       ///Prepare Dates
			       var d = new Date();
			       var t = new Date();
			       var diff = 0;
			       var day = 86400000;
			       var i = 0;
			       var dateObject = { rows: [] };
				   
				   for (var k = 0; k < data.total_rows; k++) {
						var obj={
							  year: data.rows[k].year,
							  month: data.rows[k].month-1,
							  day: data.rows[k].day,
							  count: data.rows[k].count
						    };
						dateObject.rows.push(obj);
						d.setFullYear(data.rows[k].year, data.rows[k].month -1 ,data.rows[k].day);
						if (k+1 < data.total_rows) {
							t.setFullYear(data.rows[k+1].year, data.rows[k+1].month -1 ,data.rows[k+1].day);
							diff = Math.round((t-d)/day);
							if (diff > 1){
								for (var j = 0; j < diff-1; j++){
									  d = new Date(d.setDate(d.getDate()+1)); 
									  var obj2 = {
						          			 year: d.getFullYear(),
										  	 month: d.getMonth(),
										  	 day: d.getDate(),
										  	 count: 0
									  	 };
									  dateObject.rows.push(obj2);
								}
							}
						} 
					}
			    for (var i = 0; i < dateObject.rows.length ; i++) {
			    	fechas[i]= [Date.UTC(dateObject.rows[i].year, dateObject.rows[i].month ,dateObject.rows[i].day), dateObject.rows[i].count];
				}    
				$('#timeContainer').highcharts().series[0].setData(fechas);
				var regression = fitData(fechas, 'linear').data;
				var regresObj = new Object();
				regresObj['data'] = regression;
				regresObj['visible'] = false;
				regresObj['name'] = 'Tendencia';
				regresObj['marker']= {enabled:false};
				$('#timeContainer').highcharts().addSeries(regresObj);
/* 				$('#timeContainer').highcharts().series[1].setData(regression); */
				$('#timeContainer').highcharts().hideLoading();
	      })
		        .error(function(errors) {
		          // do nothing
		        })
		 
		 
	  }
	  
	  /* METHOD FOR BUILDING TORQUE VIEW */
	  function displayTorque(querytehuan) {
		   var query_T = "(" + querytehuan + ")" + " i";
		   
		   if (torque == null){
		        // initialise the google map
		        map_T = new google.maps.Map(document.getElementById('map_canvas'),
		        	{
		        	center: new google.maps.LatLng(mapCenter[0], mapCenter[1]),
					zoom: 11,
					/*maxZoom: 17,*/
					minZoom:5,
					zoomControl: true,
					zoomControlOptions: {
						style: google.maps.ZoomControlStyle.DEFAULT		
					},
					mapTypeControlOptions: { mapTypeIds: [google.maps.MapTypeId.SATELLITE, 'style_'],
											  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
					},
					mapTypeControl: false,
					scrollwheel: true,
					streetViewControl: true,
					panControl:true,
					backgroundColor: '#163D74',
					rotateControl:true,
		      });
		
		        var map_T_style = {};
		        map_T_style.google_maps_customization_style = [
		            {
		                stylers:[ { invert_lightness:false },
			                      { weight:1 },
			                      { saturation:-10 },
								  { lightness: 0 } ]
		            },
		            {
		                elementType:"labels",
		                stylers:[  ]
		            }
		            										];
		
		        var Soft = function () {
		            this.Soft = function () {
		                map_T.setMapTypeId(google.maps.MapTypeId.ROADMAP);
		                map_T.setOptions({styles:map_T_style.google_maps_customization_style});
		            }
		        }
		
		
		        map_T.setMapTypeId(google.maps.MapTypeId.ROADMAP);
		        map_T.setOptions({styles:map_T_style.google_maps_customization_style});
				
		function init_slider( that ){
            var that_opts = that.options;
            // Init jQuery UI options
            $("#torque-slider").slider({
                min: Math.round(that_opts.start),
                max: Math.floor(that_opts.end),
                value: Math.round(that_opts.start),
                step: that._step,
                slide: function(event, ui){
                    that._current = ui.value;
                    var date = new Date(that._current * 1000);
                    var date_arry = date.toString().substr(4).split(' ');
                    that._display.set_time((that._current - that.start) / that._step);                    
                }
            });
        };
        
        function on_move (that) {
            $( "#torque-slider" ).slider({ value: that._current });
        }
		        TorqueOptions = {
		            user:'cicadmin',
		            table: query_T,
		            column:'created_at',
		            steps:350,
		            resolution:4,
		            cumulative:true,
		            clock:true,
		            fps:24,
		            fitbounds:false,
		            blendmode:'xor',
		            trails:true,
		            point_type:'circle',
		            cellsize:1,
		            scrub: init_slider,
					scrub_move: on_move
		        }
		
				/* var torque = null; */
		        Torque(function (env) { Torque.app = new env.app.Instance();
										torque = new Torque.app.addLayer(map_T, TorqueOptions);
										Torque.env = env;
										var pause = $('<a></a>');
										/*
							            $(pause).attr('id','torque-pause')
							            $(pause).addClass("playing");
							            $('body').append(pause);
							            $(pause).click(function(){
										                if($(this).hasClass('paused')){
										                    torque.pause();
										                    $(this).removeClass("paused");
										                    $(this).addClass("playing");
										                } else {
										                    $(this).removeClass("playing");
										                    $(this).addClass("paused");
										                    torque.pause();
										                }
							            });
*/
										
										
			   });
		
		        /*var blend_modes = [	"lighter",
						            "source-over",
						
									"copy",
						            "destination-atop",
						            "destination-in",
						            "destination-out",
						            "destination-over",
						            "source-atop",
						            "source-in",
						            "source-out",
						
						            "xor" ];*/
		
		        var tablename = 'torque_mty';
		
		        dat.GUI.DEFAULT_WIDTH = 200;
		        dat.GUI.autoPlace = false;
		        dat.GUI.TEXT_CLOSED="Cerrar Controles"
		        dat.GUI.TEXT_OPEN="Abrir Controles"
		
		        var toggle = new dat.GUI(); 	/*  place here relocation options for menu */
				toggle.close(); 				/* Menu loads closed */
				
		        toggle.add(TorqueOptions, 'resolution', [1, 2, 3, 4, 5]).listen().name('Tamaño');
		        /* toggle.add(TorqueOptions, 'cellsize', 0, 50).listen(); */
		        toggle.add(TorqueOptions, 'cumulative').listen().name('Acumulativo');
		        toggle.add(TorqueOptions, 'trails').listen().name('Trazo');
		        toggle.add(TorqueOptions, 'steps', { Muy_Lenta: 1500, Lenta: 500, Media: 350, Rapida: 100, Muy_Rapida: 20 }).listen().name('Velocidad');
				/* toggle.add(TorqueOptions, 'fps', 0.05, 48, false).listen(); */
		        toggle.add(TorqueOptions, 'blendmode', { Sobrepuesto: 'source-over', Transparente: 'xor', Luminoso:'lighter'}).listen().name('Estilo');
		        toggle.add(TorqueOptions, 'point_type', {Círculo: 'circle', Cuadro: 'square'}).listen().name('Marcador');
		
		        var that = this;
		        var updateTorque = function () {
		            this.updateTorque = function () {
		                if (TorqueOptions.table != tablename) {
		                    tablename = TorqueOptions.table;
		                    //TorqueOptions.fitbounds = true;
		                }else{
		                    //TorqueOptions.fitbounds = false;
		                }
		                torque.setOptions(TorqueOptions);
		            }
		        }
		        toggle.add(new updateTorque(), 'updateTorque').name('Actualizar');
		
		       takePolygons();
		       
	       }else {
	       	   takePolygons();
	       	   TorqueOptions.table = query_T;	
		       torque.setOptions(TorqueOptions);
		       if (torque.running = false) { torque.play(); dat.GUI.toggleHide();}
	       }
      }

      /* METHOD FOR BUILDING CO-OCCURRENCE VIEW */
      function displayOccurrence(querytehuan){
          var _q;
      	  // REMOVE THE ADDITIONAL QUERY STRING
		  if (querytehuan.search(/from/i) != -1)
				_q = querytehuan.substring(querytehuan.search(/from/i));
		  
      	  // LOAD SPINNER 
		  var target = document.getElementById('occur');
		  var spinner = new Spinner(opts).spin(target);
		  
		  for (var i = 0; i < formattedData.length; i++){
			  for (var j = 0; j < formattedData[i].length; j++){
			    formattedData[i][j] = 0;
			  }
		  }
	      
	      d3.select('#vis').classed(colorScheme, true);
	      
	      // QUERY CARTODB
		  $.ajax({
			url: encodeURI("http://cicadmin.cartodb.com/api/v2/sql/?q=SELECT date_part('dow', "+table_name+".created_at) as day_y, date_part('hour', "+table_name+".created_at) as hour_x, count( "+table_name+".*) " + _q + " GROUP BY day_y, hour_x ORDER BY day_y, hour_x asc"),
			dataType: 'json',
			success: function(data) {
				for (var i =0; i < data.total_rows ; i++){
				    formattedData[data.rows[i].day_y][data.rows[i].hour_x] = data.rows[i].count;
				}
				spinner.stop();
				createTiles();
			}
			}).done(function(data) {
				drawTiles();
				d3.select('.subtitle').html('Incidencia semanal de reportes');		
				
			    // tiles mouseover events
				$('#tiles td').hover(function() {
					$(this).addClass('sel');
					var tmp = $(this).attr('id').split('d').join('').split('h'),
						day = parseInt(tmp[0]),
						hour = parseInt(tmp[1]);
					
					_drawHourlyChart(day);
					selectHourlyChartBar(hour);
					d3.select('.subtitle').html('Incidencia de reportes en ' + days[day].name +" a las "+ hours[hour] +"m: " + Math.round(formattedData[day][hour]));
				}, function() {
					$(this).removeClass('sel');
					_drawHourlyChart(-1);
					d3.select('.subtitle').html('Incidencia semanal de reportes');
				});
			});
      }
      	  
	  /* METHOD FOR BUILDING WORDLE VIEW */
	  function displayWordle(querytehuan){
		  var text= '';
		  var limit=100;
		  var type='a';  /* 'default': '', 'big -> small': 'a', 'small -> big': 'b','A -> Z': 'c','shuffle': 'd'*/
		  var _q;
		  wordle.reset();
		  // REMOVE THE ADDITIONAL QUERY STRING
		  if (querytehuan.search(/from/i) != -1)
				_q = querytehuan.substring(querytehuan.search(/from/i));
		  // LOAD SPINNER 
		  var target = document.getElementById('wordle-container');
		  var spinner = new Spinner(opts).spin(target);
		  // QUERY CARTODB
		  $.ajax({
			url: encodeURI("http://cicadmin.cartodb.com/api/v2/sql/?q=SELECT "+table_name+".post_content " + _q),
			dataType: 'json',
			success: function(data) {
				for (var i =0; i < data.total_rows ; i++){
					text+=data.rows[i].post_content+' ';
				}
				text = TextUtil.countWordOccurance(text);
			}
			}).done(function(data) {
			    spinner.stop();
				wordle.sortType =type;
		        wordle.setWords(text, limit);
		        wordle.doLayout();
			});
	  }
	  
	  /* METHOD FOR BUILDING TWITTER VIEW */
	  function displayTwitter(){
		   if (loadTwitter){
			      var link; 
			      var script = document.createElement('script');
				  script.type = 'text/javascript';
				  
				  for (i=0; i<twitterID.length; i++){
					  link = '<a class="twitter-timeline"href="https://twitter.com/'+twitterName[i]+'"data-widget-id="'+twitterID[i]+'">@'+twitterName[i]+'</a>';
					  script.appendChild(document.createTextNode('!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?\'http\':\'https\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");'));
					  $("#twitterContent").append(link);
					  $("#twitterContent").append(script);
					  script.removeChild(script.childNodes[0]);
				  }
				  loadTwitter=false;
			}	  
			$('#twitter').css('display', 'block');
      }
	  
	  /* METHODS FOR BUILDING SCORES VIEW */
	  function displayScore(){
	  	  var bigoSco = {};
	  	  var bigoSta = {};
	  	  var bigoOri = {};
		  var queryMun = "SELECT DISTINCT(name) from "+area_name+" order by name asc";
	  	  var queryScore = "select avg(date_part('days',("+table_name+".last_mod-"+table_name+".created_at))) as dias_promedio, "+area_name+".name as municipio, "+table_name+".post_cat as categoria from "+table_name+", "+area_name+" where st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') and ("+table_name+".status ='closed') and ((now()- interval '7 hour')-"+table_name+".created_at < interval '90 day') group by "+area_name+".name,"+table_name+".post_cat order by "+area_name+".name,"+table_name+".post_cat asc";
	  	  var queryStatus = "select count("+table_name+".*) as cuenta, "+area_name+".name as municipio, "+table_name+".post_cat as categoria, "+table_name+".status as status, "+table_name+".close_fail as close_fail from "+table_name+", "+area_name+" where st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".status ilike '%read%' or "+table_name+".status ilike '%closed%' and "+table_name+".close_fail = false or "+table_name+".status ilike '%closed%' and "+table_name+".close_fail = true) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') and ((now()- interval '7 hour')-"+table_name+".created_at < interval '90 day') group by "+area_name+".name,"+table_name+".post_cat, "+table_name+".status, "+table_name+".close_fail order by "+area_name+".name,"+table_name+".post_cat asc";
	  	  var queryOrigin ="with _table as (select origin,"+area_name+".name as municipio from "+table_name+", "+area_name+" where (now()-"+table_name+".created_at) < interval '90 day' and st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') group by origin,"+area_name+".name),twitter as (select count(*),municipio, coalesce('twitter') as origen from _table where length(origin) = 18 group by _table.municipio),web as (select count(*),municipio, coalesce('web') as origen from _table where origin ilike '%tehuan%' or origin like 'Web%' group by _table.municipio),app as (select count(*),municipio, coalesce('app') as origen from _table where origin ilike '%api.nl%' group by _table.municipio),crm as (select count(*),municipio, coalesce('crm') as origen from _table where origin ilike 'web://%' group by _table.municipio),email as (select count(*),municipio, coalesce('email') as origen from _table where origin ilike '%mail:%' group by _table.municipio),sms as (select count(*),municipio, coalesce('sms') as origen from _table where length(origin) = 10 group by _table.municipio),result as (select * from twitter union select * from web union select * from app union select * from crm union select * from email union select * from sms order by municipio asc) select * from result ";
		  
		  
		  
		  $('#chart0').highcharts({
				chart: {
				    type: 'column',
				    height: '450',
				    zoomType: 'xy'
				},
				title: {
					text: 'Efectividad Municipal en Servicios Públicos (Últimos 90 días)'
				},
				xAxis: {
					title: {
						text: 'Servicios públicos'
					},
					categories: publicServices
				},
				yAxis: {
					title: {
						text: 'Tiempo promedio para solucionar un reporte (días)'
					},
					minorGridLineWidth: 0,
					lineColor: 'transparent'
				},
				plotOptions: {
					series: {
						animation: {
							duration: 2000
						}
					}
				},
				loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
                },
                tooltip: {
				            headerFormat: '<span style="font-size:12px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:10px; font-weight: lighter;" >{series.name}: <b>{point.y} días</b></div>',
				            footerFormat: '</div>',
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
		        },
		        legend: {
					        enabled:true,
					         align: 'right',
							 verticalAlign: 'top',
							 floating:true,
							 layout: 'vertical',
					        backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74'
				        }
                
			});
		  $('#chart0').highcharts().showLoading('Recopilando la información, por favor espere...');
		  $('.ui-accordion .ui-accordion-header').css("opacity", "0.5");	
		  sql.execute(queryMun)
		      .done(function(data) {
		      		/*THIS DATA COMES IN THE WAY:
			      	data.rows[i].name = "APO"...	
			      	*/
				    for (var i = 0; i < data.total_rows; i++) {
			        	bigoSco[data.rows[i].name]={};
			        	bigoSta[data.rows[i].name]={};
			        	bigoOri[data.rows[i].name]={};
			        	for (var j = 0; j < publicServices.length; j++) {
				        	bigoSco[data.rows[i].name][publicServices[j]]=0;
				        	bigoSta[data.rows[i].name][publicServices[j]]={'abierto':0,'cerrado':0,'fallo':0};
				        }
				        for (var j = 0; j < reportOrigins.length; j++) {
				        	bigoOri[data.rows[i].name][reportOrigins[j]]=0;
				        }
			        }
				  sql.execute(queryScore)
				      .done(function(data) {
				      	/*THIS DATA COMES IN THE WAY:
				      	data.rows[i].categoria	
				      	data.rows[i].municipio	
				      	data.rows[i].dias_promedio
				      	*/
					    for (var i = 0; i < data.total_rows; i++) {
				        	bigoSco[data.rows[i].municipio][data.rows[i].categoria] = Math.round(data.rows[i].dias_promedio);
				        }
						//console.log("bigoSco");
				        //console.log(bigoSco);
				        sql.execute(queryStatus)
				        		.done(function(data) {
						      		/*THIS DATA COMES IN THE WAY:
								  	data.rows[i].categoria	
							      	data.rows[i].municipio	
							      	data.rows[i].close_fail
							      	data.rows[i].status
							      	data.rows[i].cuenta
							      	*/
							  		for (var i = 0; i < data.total_rows; i++) {
								  		if (data.rows[i].status == 'closed'){
									  		if (data.rows[i].close_fail){
										  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].fallo = data.rows[i].cuenta;
									  		}else{
										  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].cerrado = data.rows[i].cuenta;
									  		}
								  		} else{
									  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].abierto = data.rows[i].cuenta;
								  		}
								  	}
								  	//console.log("bigoSta");
								  	//console.log(bigoSta);
								  	sql.execute(queryOrigin)
						        		.done(function(data) {
								      		/*THIS DATA COMES IN THE WAY:
										  	data.rows[i].count	
									      	data.rows[i].origen	
									      	data.rows[i].municipio
										  	*/
									  		for (var i = 0; i < data.total_rows; i++) {
										  		bigoOri[data.rows[i].municipio][data.rows[i].origen]=data.rows[i].count;
										  	}
										  	/*
											  	bigoSco : {APO:{publicServices}, CAD:{publicServices}...}
										      	bigoSta : {APO:{abierto:0,cerrado:0,fallo:0}, CAD:{abierto:0,cerrado:0,fallo:0}...}
										      	bigoOri : {APO:{reportOrigins}, CAD:{reportOrigins}...}
										  	*/
										  	//console.log("bigoOri");
										  	//console.log(bigoOri);
										  	drawScore(bigoSco,bigoSta,bigoOri);
										  	
										});
		
						        
						        });
				      });
		      });
	}
	  
	  /* METHODS FOR BUILDING EXECREP VIEW */
	  function displayExecRep(querytehuan){
	  		var _addr;
	  		var _total = document.getElementById("counterVal").value;
	  		if (_total.search(/,/i) != -1){
				_total = parseFloat(_total) + _total.substring(_total.search(/,/i)+1);
			}
	  		if (!closedistance) querytehuan+=" ORDER BY " + table_name + ".created_at DESC LIMIT "+ execRepLimit +" OFFSET "+ execRepLimit*execRepOffset;
	  		
	  		sql.execute(querytehuan).done(function(data) {
		      var execRep="<table id=\"table_rep\"><thead><tr style=\"background-image: url(images/bg-tabletd.png);background-repeat: repeat-x;height: 50px;font-size: 12px;color:#FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle; text-align: center;\"><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">CATEGORIA</td><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">INFORMACIÓN</td><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">ESTADO</td></tr></thead><tbody>"; 
		      for (var i=0;i<data.rows.length;i++){
		  	    status = (data.rows[i].status == 'read') ? status = "Abierto" : status = "Cerrado";
		  	    votes = (data.rows[i].votes) ?  data.rows[i].votes : 0;
		  	    stars = (data.rows[i].stars) ?  data.rows[i].stars : 0;
		  	    if (data.rows[i].formatted_address.search(/null/i) != -1) addr = "No especificada, ver mapa.";
		  	    else addr=data.rows[i].formatted_address;
		  		execRep+="<tr bgcolor=\"F2F2F2\">";
		  		execRep+="<td valign=\"top\" style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<center><br><a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img width=\"80\" height=\"80\" src=\""+getImg(data.rows[i].post_cat)+"\" class=\"attachment-thumbnail\"/></a></center><br>";
		  		execRep+="<h6 style=\"font-size:12px\">"+data.rows[i].post_cat+"</h6>";
		  		execrep+="</td>";
		  		execRep+="<td valign=\"top\"  style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<h5 style=\"font-size:12px; text-align:left;\"><a class=\"title\" href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\">"+data.rows[i].post_title+"</h5>";
		  		if(getAssets(data.rows[i].assets) != '') execRep+="<img src=\"images/attachment.png\" width=\"15\" height=\"15\" style=\"float: right; margin-top: -27;margin-right: -5;\">";
		  		execRep+="</a>";
		  		execRep+="<h5><a class=\"title\" href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><h5 class=\"direccion\">"+addr+"</a></h5>";
		  		execRep+="<h5 class=\"calendario\">"+new Date(data.rows[i].created_at).addHours(7)+"</h5>";
		  		execrep+="</td>";
		  		execRep+="<td valign=\"top\"  style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\" class=\"xcnr\">"+data.rows[i].ticket+"</a>";
				
                if (status == "Abierto"){
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\" class=\"verificado2\">"+status+"</a>";
                	execRep+="<span class=\"icon-span\" style=\"float: left;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+data.rows[i].uuid+"')\"/> "+votes;
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> 0</span>";
                	execRep+="<div class=\"rating\" style=\"opacity:0.3;\">";
	                for (var j=4; j>=0;j--){
		                execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" disabled><label for=\"star"+j+"\">"+j+" stars</label>";
	                }
	                execRep+="</div>";
                } else{
                	execRep+="<a class=\"verificado\">"+status+"</a>";
                	execRep+="<span class=\"icon-span\" style=\"float: left;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+data.rows[i].uuid+"')\"/> "+votes;
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> 0</span>";
	                execRep+="<div class=\"rating\">";
	                for (var j=4; j>=0;j--){
		                if (stars >= j)
		                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" checked=\"checked\" onclick=\"sendStars('"+j+"','"+data.rows[i].uuid+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
		                else
		                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" onclick=\"sendStars('"+j+"','"+data.rows[i].uuid+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
	                }
	                execRep+="</div>";
                }
		  		execrep+="</td>";
		  		execrep+="</tr>";
		  	  }
		  	  execRep+="</table>";
		  	  
		  	  execRep+="<center>";
		  	  if (execRepOffset>0 && execRepOffset < _total/execRepLimit-1){ 
		  	  	execRep+="<a href=\"javascript: execRepOffset=0; setQ();\" class=\"button back dark\" style=\"position:absolute; top:30%; left:10%;\"><span></span></a><a href=\"javascript: execRepOffset--; setQ();\" class=\"button back light\" style=\"position:absolute; top:30%; left:15%\"><span></span></a><a href=\"javascript: execRepOffset++; setQ();\" class=\"button next light\" style=\"position:absolute; top:30%; right:15%;\"><span></span></a><a href=\"javascript: execRepOffset="+_total+"/execRepLimit-1; setQ();\" class=\"button next dark\" style=\"position:absolute; top:30%; right:10%;\"><span></span></a>";
		  	  } else if (execRepOffset==0 && _total > execRepLimit) execRep+="<a href=\"javascript: execRepOffset++; setQ();\" class=\"button next light\" style=\"position:absolute; top:30%; right:15%;\"><span></span></a>";
		  	  else if (execRepOffset == _total/execRepLimit-1 && execRepOffset!=0 ) execRep+="<a href=\"javascript: execRepOffset--; setQ();\" class=\"button back light\" style=\"position:absolute; top:30%; left:15%;\"><span></span></a>";
		  	  execRep+="</center>";
			  $( "#execRepContent" ).html(execRep);
	  		});
	  		
			$('#execrep').css('display', 'block');
	  }
	  
	  /* VIEW CHANGER METHOD */ 
	  function changeView(view){
        activeView = view;
	    switch (view){
		    case 'home': 
		    	fade('showSlides');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); } 
		    	takePolygons();
		    	$('#map').css('display', 'block'); 
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'block');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    case 'heat':
		    	fade('showSlides');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	takePolygons();
		    	$('#map').css('display', 'block');
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    case 'intensity': 
		    	fade('showSlides');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	takePolygons();
		    	$('#map').css('display', 'block');
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    case 'torque': 
		    	fade('showSlides');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#torque').css('display', 'block'); if (torque) if (!torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'block');
		    	setQ(); break;
		    case 'occur': 
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#occur').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;	
		    case 'trends': 
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#trends').css('display', 'block');
		    	$('#_panel').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    case 'stats': 
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#stats').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    case 'score': 
		    	fade('all');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'block');
		    	$('#torque-slider').css('display', 'none');
		    	displayScore(); break;
		    case 'wordle': 
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'block');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;	
		    case 'twitter': 
		    	fade('all');
		    	$('#map').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#_panel').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque)  if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	displayTwitter(); break;
		    case 'execrep': 
		    	fade('showSlides'); execRepOffset=0;
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#_panel').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	setQ(); break;
		    default: break;
	    }
    }
	  
	  /*					 **
	  **     MAIN QUERY 	 **
	  **  RELATED METHODS    **
	  **					 */
	  
	  /* ONLOAD JQUERY CHECKBOXES FILTER ACTIVATION */
	  $(function() {
$('#avisos').change(function(){this.checked ? categories.avisos = true : categories.avisos = false; execRepOffset=0;setQ();});
$('#eventos').change(function(){this.checked ? categories.eventos = true : categories.eventos = false; execRepOffset=0;setQ();});
$('#observador').change(function(){this.checked ? categories.observador = true : categories.observador = false; execRepOffset=0;setQ();});
$('#pcomunidad').change(function(){this.checked ? categories.pcomunidad = true : categories.pcomunidad = false; execRepOffset=0;setQ();});
$('#pseguridad').change(function(){this.checked ? categories.pseguridad = true : categories.pseguridad = false; execRepOffset=0;setQ();});
$('#pservicios').change(function(){this.checked ? categories.pservicios = true : categories.pservicios = false; execRepOffset=0;setQ();});
$('#pvialidad').change(function(){this.checked ? categories.pvialidad = true : categories.pvialidad = false; execRepOffset=0;setQ();});
$('#incendio').change(function(){this.checked ? categories.incendio = true : categories.incendio = false; execRepOffset=0;setQ();});
$('#robo').change(function(){this.checked ? categories.robo = true : categories.robo = false; execRepOffset=0;setQ();});
$('#sitriesgo').change(function(){this.checked ? categories.sitriesgo = true : categories.sitriesgo = false; execRepOffset=0;setQ();});
$('#alcantarillas').change(function(){this.checked ? categories.alcantarillas = true : categories.alcantarillas = false; execRepOffset=0;setQ();});
$('#alumbrado').change(function(){this.checked ? categories.alumbrado = true : categories.alumbrado = false; execRepOffset=0;setQ();});
$('#electricidad').change(function(){this.checked ? categories.electricidad = true : categories.electricidad = false; execRepOffset=0;setQ();});
$('#fuga').change(function(){this.checked ? categories.fuga = true : categories.fuga = false; execRepOffset=0;setQ();});
$('#parques').change(function(){this.checked ? categories.parques = true : categories.parques = false; execRepOffset=0;setQ();});
$('#basura').change(function(){this.checked ? categories.basura = true : categories.basura = false; execRepOffset=0;setQ();});
$('#accidente').change(function(){this.checked ? categories.accidente = true : categories.accidente = false; execRepOffset=0;setQ();});
$('#bache').change(function(){this.checked ? categories.bache = true : categories.bache = false; execRepOffset=0;setQ();});
$('#obras').change(function(){this.checked ? categories.obras = true : categories.obras = false; execRepOffset=0;setQ();});
$('#semaforo').change(function(){this.checked ? categories.semaforo = true : categories.semaforo = false; execRepOffset=0;setQ();});
$('#emergencias').change(function(){this.checked ? categories.emergencias = true : categories.emergencias = false; setQ();});

$('#calendario').change(function(){this.checked ? dates.calendario = true : dates.calendario=false; clearDates('calendario'); execRepOffset=0;setQ();});
$('#sietedias').change(function(){this.checked ? dates.sietedias = true : dates.sietedias=false; clearDates('sietedias'); execRepOffset=0;setQ();});
$('#quincedias').change(function(){this.checked ? dates.quincedias = true : dates.quincedias=false; clearDates('quincedias'); execRepOffset=0;setQ();});
$('#treintadias').change(function(){this.checked ? dates.treintadias = true : dates.treintadias=false; clearDates('treintadias'); execRepOffset=0;setQ();});
$('#noventadias').change(function(){this.checked ? dates.noventadias = true : dates.noventadias=false; clearDates('noventadias'); execRepOffset=0;setQ();});
$('#ulthoras').change(function(){this.checked ? dates.ulthoras = true : dates.ulthoras=false; clearDates('ulthoras'); execRepOffset=0;setQ();});
$('#slider-ulthoras').mouseup(function() {if (dates.ulthoras){clearDates('ulthoras'); execRepOffset=0;setQ();}});
$('#amount').change(function() {console.log('uli');if (dates.ulthoras){setQ();}});
$('#horasdeldia').change(function(){this.checked ? dates.horasdeldia = true : dates.horasdeldia=false; execRepOffset=0;setQ();});
$('#slider-horasdeldia').mouseup(function() {if (dates.horasdeldia){execRepOffset=0;setQ();}});
$('#amount1').change(function() {if (dates.horasdeldia){execRepOffset=0;setQ();}});
$('#domingo').change(function(){this.checked ? dates.domingo = true : dates.domingo=false;  execRepOffset=0;setQ();});
$('#lunes').change(function(){this.checked ? dates.lunes = true : dates.lunes=false;  execRepOffset=0;setQ();});
$('#martes').change(function(){this.checked ? dates.martes = true : dates.martes=false; execRepOffset=0;setQ();});
$('#miercoles').change(function(){this.checked ? dates.miercoles = true : dates.miercoles=false;  execRepOffset=0;setQ();});
$('#jueves').change(function(){this.checked ? dates.jueves = true : dates.jueves=false;  execRepOffset=0;setQ();});
$('#viernes').change(function(){this.checked ? dates.viernes = true : dates.viernes=false; execRepOffset=0;setQ();});
$('#sabado').change(function(){this.checked ? dates.sabado = true : dates.sabado=false; execRepOffset=0;setQ();});

$('#monterrey').change(function(){this.checked ? mun.mty = true : mun.mty = false; execRepOffset=0;setQ();});
$('#sanpedro').change(function(){this.checked ? mun.sp = true : mun.sp = false; execRepOffset=0;setQ();});
$('#sannico').change(function(){this.checked ? mun.sn = true : mun.sn = false; execRepOffset=0;setQ();});
$('#santacat').change(function(){this.checked ? mun.sc = true : mun.sc = false; execRepOffset=0;setQ();});
$('#guadalupe').change(function(){this.checked ? mun.gpe = true : mun.gpe = false; execRepOffset=0;setQ();});
$('#apodaca').change(function(){this.checked ? mun.apo = true : mun.apo = false; execRepOffset=0;setQ();});
$('#escobedo').change(function(){this.checked ? mun.esc = true : mun.esc = false; execRepOffset=0;setQ();});
$('#juarez').change(function(){this.checked ? mun.jua = true : mun.jua = false; execRepOffset=0;setQ();});
$('#garcia').change(function(){this.checked ? mun.gar = true : mun.gar = false; execRepOffset=0;setQ();});
$('#cadereyta').change(function(){this.checked ? mun.cad = true : mun.cad = false; execRepOffset=0;setQ();});
$('#santiago').change(function(){this.checked ? mun.stg = true : mun.stg = false; execRepOffset=0;setQ();});

$('#abierto').change(function(){this.checked ? repStatus.open = true : repStatus.open = false; execRepOffset=0;setQ();});
$('#cerrado').change(function(){this.checked ? repStatus.closed = true : repStatus.closed = false; execRepOffset=0;setQ();});
$('#cerradofail').change(function(){this.checked ? repStatus.closed_fail = true : repStatus.closed_fail = false; execRepOffset=0;setQ();});

$('#radius').change(function(){this.checked ? radius.set = true : radius.set = false; execRepOffset=0; 
			                                if (radius.set){radius.lat = map.getCenter().lat();radius.lng = map.getCenter().lng();
															 updateRadDeg(radius.rad);drawCircle();updateBounds();
															 clearDistance('rad'); setQ();}
			                                else {drawCircle(); setQ();}});
$('#slider-radius').mouseup(function() {if (radius.set){updateRadDeg(radius.rad);drawCircle();updateBounds();execRepOffset=0;setQ();}});
$('#polyfilter').change(function(){this.checked ? polyfilter = true : polyfilter = false; 
	            if (!polyfilter){
	                clearPolygons(); drawingManager.setOptions({drawingControl: false}); drawingManager.setDrawingMode(null);              
	            }else{
	                drawingManager.setOptions({drawingControl: true});
	                drawingManager.setDrawingMode('polygon');
	                clearDistance('poly');
	            } execRepOffset=0;setQ(); }); 
$('#closedistance').change(function(){this.checked ? closedistance = true : closedistance = false;execRepOffset=0;
				if (!closedistance) {
					clearGeo();
					setQ();
				}else{ 
					clearDistance('close');
					detectUserLocation();
				}
});
$('#slider-closedistance').mouseup(function() {if (closedistance) {execRepOffset=0; setQ();}});            	            

$('#voto').change(function(){this.checked ? votos = true : votos = false;execRepOffset=0;setQ();});
$('#star').change(function(){this.checked ? star = true : star = false;execRepOffset=0;setQ();});
$('#asset').change(function(){this.checked ? qassets = true : qassets = false;execRepOffset=0;setQ();});
$('#slider-voto').mouseup(function() {if (votos) {execRepOffset=0; setQ();}});
$('#slider-star').mouseup(function() {if (star) {execRepOffset=0; setQ();}});     

$('#search-green').searchMeme({ onSearch: function (searchText) {
                setTimeout(function () { $('#search-green').searchMeme({ searchComplete: true });}, 3000);
                searchInput = searchText;     
                execRepOffset=0;
                setQ();
            }, buttonPlacement: 'right', button: 'green'});

$('#cluster').change(function(){this.checked ? mapcluster = true : mapcluster = false; 
					mapcluster ? $("#clusterImg").attr("src","images/bt-group.png") : $("#clusterImg").attr("src","images/bt-ungroup.png");
					execRepOffset=0;
					setQ();});

$('#bubbles').change(function(){this.checked ? bubbles = true : bubbles = false; 
					execRepOffset=0;
					setQ();});
        
	  });
	  
	  /* QUERY CONSTRUCTOR + CARTODB CALL*/
	  function setQ(){
var auxMun = false;   //helper for querying polygons
var auxWhere = false; //helper for adding 'where' to the query
var auxInter = false; //helper for inter-filtering '(' and ')' toggling
(mun.mty || mun.sp || mun.sn || mun.sc || mun.gpe || mun.apo || mun.esc || mun.jua || mun.gar || mun.cad || mun.stg) ? auxMun = true : auxMun = false;

// Query setup
if(auxMun) { _query="SELECT "+table_name+".* FROM "+table_name+", "+area_name+" WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)"; auxWhere = true;}
else  _query="SELECT * FROM "+table_name+"";


/* CATEGORIES */
if (categories.avisos){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%AVISOS%'" ; auxWhere=true; auxInter=true;} 
if (categories.eventos){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%EVENTO%'" ; auxWhere=true; auxInter=true;} 
if (categories.observador){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%OBSERVADOR%'" ; auxWhere=true; auxInter=true;} 
if (categories.pcomunidad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%COMUNIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.pseguridad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SEGURIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.pservicios){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SERV PUBLICOS%'" ; auxWhere=true; auxInter=true;} 
if (categories.pvialidad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%PROPUESTA VIALIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.incendio){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%INCENDIO%'" ; auxWhere=true; auxInter=true;} 
if (categories.robo){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ROBO%'" ; auxWhere=true; auxInter=true;} 
if (categories.sitriesgo){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%RIESGO%'" ; auxWhere=true; auxInter=true;} 
if (categories.alcantarillas){if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ALCANTARILLA%'" ; auxWhere=true; auxInter=true;} 
if (categories.alumbrado){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ALUMBR%'" ; auxWhere=true; auxInter=true;} 
if (categories.electricidad){ if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ELECTRICIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.fuga){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%FUGA%'" ; auxWhere=true; auxInter=true;} 
if (categories.parques){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%PARQUES%'" ; auxWhere=true; auxInter=true;} 
if (categories.basura){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%BASURA%'" ; auxWhere=true; auxInter=true;} 
if (categories.accidente){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ACCIDENTE%'" ; auxWhere=true; auxInter=true;} 
if (categories.bache){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%BACHE%'" ; auxWhere=true; auxInter=true;} 
if (categories.obras){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%OBRAS%'" ; auxWhere=true; auxInter=true;} 
if (categories.semaforo){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SEMAFORO%'" ; auxWhere=true; auxInter=true;} 
if (categories.emergencias){	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%EMERGENCIA%'" ; auxWhere=true; auxInter=true;} 
if (auxInter) {_query+=")"; auxInter = false}; 

/* DATES */  
if (dates.calendario){ 		
						if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
						if(auxhas){
							var _tmp = parseInt(has.substring(5,7));_tmp-=1;
							var tmp = new Date(); tmp.setFullYear(has.substr(0,4), _tmp, has.substr(8,10)); tmp.setDate(tmp.getDate()+1);
							_tmp=tmp.getMonth()+1;
							has=tmp.getFullYear()+"-"+_tmp+"-"+tmp.getDate(); 
							auxhas=false;
						}
							_query+="("+table_name+".created_at < (DATE '" + has +"')) and ("+table_name+".created_at > (DATE '" + des + "'))" ; 
							auxWhere=true; auxInter=true; }  
if (dates.sietedias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now()- INTERVAL '7 hour')-"+table_name+".created_at) < INTERVAL '7 day'" ; auxWhere=true; auxInter=true; }
if (dates.quincedias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now()- INTERVAL '7 hour')-"+table_name+".created_at) < INTERVAL '15 day'" ; auxWhere=true; auxInter=true; }
if (dates.treintadias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now()- INTERVAL '7 hour')-"+table_name+".created_at) < INTERVAL '30 day'" ; auxWhere=true; auxInter=true;}
if (dates.noventadias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now()- INTERVAL '7 hour')-"+table_name+".created_at) < INTERVAL '90 day'" ; auxWhere=true; auxInter=true; }  
if (auxInter) {_query+=")"; auxInter = false;};

/* DAYS */
if (dates.domingo){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 0" ; auxWhere=true; auxInter=true; }  
if (dates.lunes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 1" ; auxWhere=true; auxInter=true; }  
if (dates.martes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 2" ; auxWhere=true; auxInter=true; }  
if (dates.miercoles){ 	if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 3" ; auxWhere=true; auxInter=true; }  
if (dates.jueves){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";}  
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 4" ; auxWhere=true; auxInter=true; }  
if (dates.viernes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";}  
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 5" ; auxWhere=true; auxInter=true; }  
if (dates.sabado){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 6" ; auxWhere=true; auxInter=true; } 
if (auxInter) {_query+=")";auxInter = false;};

/* HOURS */
if (dates.ulthoras){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now()- INTERVAL '7 hour')-"+table_name+".created_at) < INTERVAL '"+ valulthoras +" hour'" ; auxWhere=true; auxInter=true; }
if (auxInter) {_query+=")"; auxInter = false;};
if (dates.horasdeldia){ 	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+= queryhorasdeldia; auxWhere=true; auxInter=true; }
if (auxInter) {_query+=")"; auxInter = false;};


/* REP STATUS */
if (repStatus.open){ 		    if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%read%'" ; auxWhere=true; auxInter=true;} 
if (repStatus.closed){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%closed%' AND "+table_name+".close_fail = false" ; auxWhere=true; auxInter=true;}
if (repStatus.closed_fail){	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%closed%' AND "+table_name+".close_fail = true" ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//VOTES
if (votos){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".votes >= "+ totalvotos ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//STAR RATING
if (star){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".stars >= "+ totalstar ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//ASSETS
if (qassets){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".assets != '[]'" + " AND " + table_name+".assets not ilike '%citivox%'"; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

/* POLYGON */ 
if (radius.set){	
 if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
 _query+=" ST_Intersects("+table_name+".the_geom,ST_Buffer( ST_SetSRID('POINT(" + radius.lng + " " + radius.lat + ")'::geometry , 4326)" + "," + radDeg + "))"; 
 if (polyfilter && shapesArray.length >0){	
     _query+=" OR ";
     var _q,lnglato;
     if (shapesArray.length==1) _q='POLYGON(';
     else _q='MULTIPOLYGON(';
     
     for(var i = 0; i < shapesArray.length; i++){
         if (i!=0) _q+=',';
         if (shapesArray.length==1) _q+='('; else _q+='((';
         
         shapesArray[i].getPath().forEach(function(xy, j) {
          if (j == 0 ){lnglato=xy.lng() + ' ' + xy.lat();;}
          _q+= xy.lng() + ' ' + xy.lat() + ',';
         });
         _q+=lnglato;
         if (shapesArray.length==1) _q+=')'; else _q+='))';
         
     }
     _query+=" ST_Intersects("+table_name+".the_geom,ST_GeomFromText('"+ _q +")',4326))";
  }  
  auxWhere=true; auxInter=true;
} 
if (auxInter) {_query+=")"; auxInter = false};
/* CUSTOM POLYGON IN CASE RAD IS NOT SET*/
if (polyfilter && shapesArray.length >0 && !radius.set){	
 if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
 var _q,lnglato;
 if (shapesArray.length==1) _q='POLYGON(';
 else _q='MULTIPOLYGON(';
 
 for(var i = 0; i < shapesArray.length; i++){
     if (i!=0) _q+=',';
     if (shapesArray.length==1) _q+='('; else _q+='((';
     
     shapesArray[i].getPath().forEach(function(xy, j) {
      if (j == 0 ){lnglato=xy.lng() + ' ' + xy.lat();;}
	  _q+= xy.lng() + ' ' + xy.lat() + ',';
	 });
	 _q+=lnglato;
	 if (shapesArray.length==1) _q+=')'; else _q+='))';
	 
 }
	 _query+=" ST_Intersects("+table_name+".the_geom,ST_GeomFromText('"+ _q +")',4326))";
	 auxWhere=true; auxInter=true;
} 
if (auxInter) {_query+=")"; auxInter = false};

/* SEARCH INPUT */
if(searchInput != "") {
if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
		_query+=" "+table_name+".post_content ilike '%"+ searchInput  +"%' OR "+table_name+".ticket ilike '%"+ searchInput  +"%' OR "+table_name+".formatted_address ilike '%"+ searchInput  +"%')";
	//searchInput = "";  Moved to the end of SetQ
}


/* MUN */ 
if (mun.mty){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}}
								_query+=" "+area_name+".name = 'MTY'" ; auxWhere=true; auxInter=true;} 
if (mun.sp){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'SP'" ;auxWhere=true; auxInter=true;} 
if (mun.sn){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'SN'" ; auxWhere=true; auxInter=true;} 
if (mun.sc){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  						        _query+=""+area_name+".name = 'SC'" ; auxWhere=true; auxInter=true;} 
if (mun.gpe){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'GPE'";auxWhere=true; auxInter=true;} 
if (mun.apo){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'APO'" ; auxWhere=true; auxInter=true;} 
if (mun.esc){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'ESC'" ; auxWhere=true; auxInter=true;} 
if (mun.jua){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'JUA'" ; auxWhere=true; auxInter=true;} 
if (mun.gar){		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'GAR'" ; auxWhere=true; auxInter=true;}
if (mun.stg){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'STG'" ; auxWhere=true; auxInter=true;}
if (mun.cad){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'CAD'" ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};


// AT THIS POINT QUERY IS COMPLETE
console.log(_query);

/* MAP LAYER OR ACTIVE VIEW UPDATE */
$('#report-content:visible').hide('fold', {}, 400);  // hide report if visible
$('#infowindow:visible').hide('fold', {}, 400);      // hide infowindow if visible
_geoq = _query;
if(closedistance) _geoq += " ORDER BY "+table_name+".the_geom <-> ST_SetSRID(ST_MakePoint("+lon+","+lat+"),4326) ASC LIMIT "+total+"";
if (activeView == 'home'){
	if (votos){	
		if (mapcluster) layers[0].setOptions({query: _geoq,tile_style: _tile_style_cluster,interactivity: _interactivity});
		else layers[0].setOptions({query: _geoq,tile_style: _tile_style,interactivity: _interactivity});
		if (bubbles) layers[0].setOptions({query: _geoq,tile_style: _tile_style_bubbles,interactivity: _interactivity});
	}else if(mapcluster) {
		layers[0].setOptions({query: _geoq,tile_style: _tile_style_cluster,interactivity: _interactivity});
	}else layers[0].setOptions({query: _geoq,tile_style: _tile_style,interactivity: _interactivity});  //load new values
}else if (activeView == 'heat'){
	layers[0].setOptions({query: _geoq,tile_style: _heatmap_style,interactivity: _interactivity});  //load new values
}else if (activeView == 'intensity'){
	layers[0].setOptions({query: _geoq,tile_style: _intensity_style,interactivity: _interactivity});  //load new values
}else if(activeView == 'torque'){
	displayTorque(_geoq);
}else if(activeView == 'wordle'){
	displayWordle(_geoq);
}else if(activeView == 'stats'){
	displayStats(_query);
}else if(activeView == 'trends'){
	displayTrends(_query);
}else if(activeView == 'occur'){
	displayOccurrence(_query);
}else if(activeView == 'execrep'){
	displayExecRep(_geoq);
}		 
/* COUNTER UPDATE */
var str=_geoq;
var n;
if (auxMun) n=str.replace("SELECT "+table_name+".* FROM "+table_name+", "+area_name+"","SELECT COUNT("+table_name+".*) FROM "+table_name+", "+area_name+"");
else n=str.replace("SELECT * FROM "+table_name+"","SELECT COUNT (*) FROM "+table_name+"");

if (closedistance) n = _geoq;
sql.execute(n).done(function(data) {
    var result;
		if (closedistance) result = data.total_rows;
		else for (var i = 0; i < data.total_rows; i++) { result = data.rows[i].count;} 
		$( "#counterVal" ).val(addCommas(result));
}).error(function(errors) {});

if (auxMun) n=str.replace("SELECT "+table_name+".* FROM "+table_name+", "+area_name+"","SELECT "+table_name+".post_cat, COUNT("+table_name+".*) FROM "+table_name+", "+area_name+"");
else n=str.replace("SELECT * FROM "+table_name+"","SELECT "+table_name+".post_cat, COUNT (*) FROM "+table_name+"");
n+=" GROUP BY "+table_name+".post_cat";
if (closedistance) n = "WITH data AS ("+_geoq+") SELECT post_cat, COUNT(*) FROM data GROUP BY post_cat ORDER BY post_cat ASC";
var sql2 = new cartodb.SQL({ user: 'cicadmin' });
sql2.execute(n).done(function(data) {
		updateCounters(data);
}).error(function(errors) {});


/* ACTIVE FILTERS UPDATE */  
updateActiveFilters();

/* RESET THE SEARCH INPUT */
searchInput = "";
	   }
</script>
  	
  	<!-- CSS-DOCK MENUS -->	
	<div class="dock">
		<!--top dock -->
		<a href="http://cic.mx"><img src="images/cic.png" style="height:35px; width:auto; z-index:11; position:absolute; top:3px; left:5px;"/></a>
		<ul class="dock" id="dock">
			<div class="dock-container" data-step="1" data-intro="Este es el menú de vistas, con cada uno de los botones aquí, puedes cambiar el despliegue central de la página. Da clic en siguiente para ver la descripción de cada elemento." >
			    <li class="active"><a class="dock-item" onclick="if (activeView != 'home' || getUrlVars()) changeView('home')"  style="margin-left:0;"><img src="images/bt-home.png" data-step="2" data-intro="Este botón te llevará al despliegue inicial en su vista agrupada. Si deseas desagrupar los marcadores en el mapa puedes desactivar el selector en la parte inferior derecha." data-position="bottom"/><span>Inicio</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'heat') changeView('heat');" style="margin-left:40;"><img src="images/bt-heatmap.png" data-step="3" data-intro="Este botón te llevará al despliegue en mapa de calor de la información que tengas filtrada. Con esta herramienta podrás encontrar focos de interés alrededor de la ciudad." data-position="bottom"/><span>Mapa de Calor</span></a></li>			            <li><a class="dock-item" onclick="if (activeView != 'intensity') changeView('intensity')" style="margin-left:80;"><img src="images/bt-intensity.png" data-step="4" data-intro="Este botón te llevará al despliegue de radios de influencia, permitiéndote observar la permeabilidad de los eventos que ocurren en la ciudad." data-position="bottom"/><span>Radios de influencia</span></a></li>   
				<li><a class="dock-item" onclick="if (activeView != 'torque') changeView('torque')" style="margin-left:120;"><img src="images/bt-play.png" data-step="5" data-intro="Este botón te llevará al despliegue animado, en el cual podrás observar como ocurren en el tiempo los diversos incidentes que se reportan al CIC." data-position="bottom"/><span>Mapa Animado</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'occur') changeView('occur')"style="margin-left:160;"><img src="images/bt-occur.png" data-step="6" data-intro="Este botón te llevará al despliegue de reincidencias, buscando facilitarte el entendimiento de en qué día y a qué hora ocurren diversos eventos en la ciudad." data-position="bottom"/><span>Incidencia Día/Hora</span></a> </li>
				<li><a class="dock-item" onclick="if (activeView != 'trends') changeView('trends')"style="margin-left:200;"><img src="images/bt-trends.png" data-step="7" data-intro="Este botón te llevará al gráfico de las tendencias de reporteo ciudadano. En él podrás apreciar qué eventos van en creciente." data-position="bottom"/><span>Históricos</span></a> </li>
				<li><a class="dock-item" onclick="if (activeView != 'stats') changeView('stats')" style="margin-left:240;"><img src="images/bt-stats.png" data-step="8" data-intro="Este botón te llevará al gráfico por municipios, pudiendo observar de manera comparativa lo que se reporta al CIC en nuestra área metropolitana." data-position="bottom"/><span>Inicidencia por Municipios</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'score') changeView('score')" style="margin-left:280;"><img src="images/bt-score.png" data-step="9" data-intro="Este botón te llevará al despliegue calificativo en el desempeño municipal para resolución de problemas con servicios públicos." data-position="bottom"/><span>Scorecard Municipal</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'wordle') changeView('wordle')" style="margin-left:320;"><img src="images/bt-wordle.png" data-step="10" data-intro="Este botón te llevará al despliegue gráfico de la red de conversación más relevante que se presenta en las redes sociales de nuestra ciudad acorde al tema de tu interés." data-position="bottom"/><span>Red de Conversación</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'twitter') changeView('twitter')" style="margin-left:360;"><img src="images/bt-twitter.png" data-step="11" data-intro="Este botón te llevará al despliegue de la red de ciudadanos en Twitter, que se mantienen activos y nutren la información que traemos para ti en este espacio." data-position="bottom"/><span>Red de Ciudadanos</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'execrep') changeView('execrep')" style="margin-left:400;"><img src="images/bt-execrep.png" data-step="12" data-intro="Finalmente, este botón te llevará al despliegue en formato de lista de reportes según hayas utilizado los filros." data-position="bottom"/><span>Listado de Reportes</span></a></li> 
			</div> 
		</ul>
		
		<div id="dockRight" >
			<a href="http://tehuan.cic.mx/notificaciones-cic/" target="blank" style="text-decoration:none;"><img src="images/bt-flag.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:75px;" data-step="20" data-intro="También te brindamos la opción de suscribirte a las notificaciones con este botón." data-position="left"/><span style="top: 35px; right: 45px;">Notificaciones</span></a>
			<a href="http://tehuan.cic.mx/nuevo-reporte" target="blank"  style="text-decoration:none;"><img src="images/bt-newrep.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:33px;" data-step="21" data-intro="Y, por último con este botón podrás crear un nuevo reporte desde este mismo espacio, contribuyendo así con una mayor participación ciudadana. Otras formas de contribuir las tendrás al darle un clic a los marcadores en el mapa, pudiendo votar por los reportes creando una suma de voces, podrás comentar en ellos, compartirlos en tus redes sociales, y calificarlos según tu opinión." data-position="left"/><span style="top: 35px; right: 5px;">Crear Reporte</span></a>
			<a href="#" onclick="introJs().start()"><img src="images/bt-help.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:-2px;"/></a>
			<div  class="wrapper" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:119px;" data-step="19" data-intro="Adicionalmente, en este apartado te proveemos la oportunidad de buscar texto o tickets de reportes que te interesen." data-position="left"><input type="text" id="search-green" />
			</div>
        </div>
		
		<!--bottom dock -->
		<ul class="dock" id="dock2">
		<div class="dock-container2" data-step="13" data-intro="De manera paralela, en esta sección inferior se encuentran los diversos filtros que podrás activar para poder cruzar la información de tu interés e ir a encontrar hasta el más específico detalle." data-position="top">
		<li class="active"><a class="dock-item2" href="" id="slide-cate" style="margin-left:0;"><span> Categorías</span><img src="images/bt-categories.png" data-step="14" data-intro="Este botón te desplegará el panel de filtrado por categorías, pudiendo seleccionar tantas como te interese." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-date" style="margin-left:40;"><span> Fecha</span><img src="images/bt-calendar.png" data-step="15" data-intro="Este botón te desplegará el panel de filtrado por fechas, pudiendo seleccionar últimos días, calendarios, y hasta rango de horas de interés." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-muni" style="margin-left:80;"><span> Municipio</span><img src="images/bt-municip.png"/data-step="16" data-intro="Este botón te desplegará el panel de filtrado por municipios del área metropolitana, facilitando la comparación entre ellos." data-position="top"></a></li> 
		<li><a class="dock-item2" href="" id="slide-stat" style="margin-left:120;"><span> Detalle de Reporte</span><img src="images/bt-lock.png" data-step="17" data-intro="Este botón te desplegará el panel de filtrado por estado de reporte, además de los adicionales de los mismos, pudiendo filtrar por ejemplo todos aquellos que tengan foto." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-dist" style="margin-left:160;"><span> Distancia</span><img src="images/bt-polygon.png"/data-step="18" data-intro="Finalmente, este botón te desplegará el panel de filtrado por radios de distancia en un cierto punto, polígonos que tú denotes, y hasta por tu ubicación geográfica actual." data-position="top"></a></li> 
		</div>
		</ul>
		<div class='cluster' style="position: absolute; bottom: 8px; right: 35px; z-index:15;">	
				<input type="checkbox" id="cluster" class="switch" style="display: none;" title="Agrupar/Desagrupar" checked/>
				<label for="cluster" style="font-weight: bold; color: #FFF;"><img id="clusterImg" src="images/bt-group.png" style="height:20px; width:auto; z-index:11; "/></label>
		</div>
   </div>
   
	<!-- TOP-DOCK SUBMENUS -->
	<div>
	
	</div>
	
	
	<!-- VIEWS -->
	<div>
		<div id="map" style="width:100%; height: 95%; top: 35px;" onclick="fade('showSlides')"></div>
		<div id="_panel" style="position: absolute;top: 60px;left: 260px;margin-left: -180px;z-index: 5;padding: 5px;">
				<input id="address" type="textbox" value="" placeholder='Buscar ubicación...' onkeydown="if (event.keyCode == 13) codeAddress();" style="height:20; border-radius: 2px 0 0 2px; box-shadow: 0 4px 6px rgba(0,0,0,0.6);width: 160px;"> 
				<input type="button" value="" onclick="codeAddress()" style="background-color: #163D74;border: 0;background-image: url(images/icon-search.png);border-radius: 0 2px 2px 0;box-shadow: 0 4px 6px rgba(0,0,0,0.6);text-align: center;vertical-align: top;width: 25px;color: white;height:20;margin-left:-5px;cursor:pointer;">
		</div>
		
        <div id="torque" style="width:100%; height: 100%; display:none; background-color:#163D74; opacity:0.9; top: 35px;" >
			<div id="map_canvas" style="width:100%; height: 95%; top: 35px;" onclick="fade('showSlides')"></div>
			<div class="torque_time" style="color:#FFF; font-size:16px; position:absolute; right:167px; bottom:70px; z-index:6; font-size:16px"></div>
			<div class="torqueslide"><div id="torque-slider"></div></div>
        </div>
        
		<div id='occur' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
				<div id="containeroccu" > 
					<center>
						<div id="legend" class="rbow2">
							<ul>
								<li class="q1-11"></li>
								<li class="q2-11"></li>
								<li class="q3-11"></li>
								<li class="q4-11"></li>
								<li class="q5-11"></li>
								<li class="q6-11"></li>
								<li class="q7-11"></li>
								<li class="q8-11"></li>
								<li class="q9-11"></li>
								<li class="q10-11"></li>
								<li class="q11-11"></li>
							</ul>
							<p class="more">más reportes</p>
							<p class="less">menos reportes</p>
						</div>
						
						<div id="vis"></div>
						
						<div id="hourly_values">
								<div class="svg"></div>
								<p class="subtitle"></p>
						</div>
					</center>
				</div>
		
	    </div>

		<div id="trends" style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center><div id="timeContainer" style="width: 70%; height: 80%; padding:60px; margin:auto;"></div></center>
		</div>
		
		<div id="stats" style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center>
			 	<div class="actions" id="actions">
			        <button class="cicswitcher" id="column">COLUMNA</button> 
			        <button class="cicswitcher" id="area">AREA</button> 
			        <button class="cicswitcher" id="line">LINEA</button> 
			        <button class="cicswitcher" id="spline">SPLINE</button> 
			        <button class="cicswitcher" id="areaspline">AREA+SPLINE</button>
			     </div>
			<div id="columnContainer" style="width: 70%; height: 80%; margin:auto;"></div>
			<div  style="width: 70%; color:white; position: absolute; left: 15%; bottom: 40px;">
		     		<input type="radio" name="norm" value="pob" onclick="normalpob=true; normalkm=false;setQ();">Normalizar por cada 100k Habitantes 
		     		<br>
			 		<input type="radio" name="norm" value="km" onclick="normalkm=true; normalpob=false;setQ();">Normalizar por Km<sup>2</sup>
			 		<br>
			 		<input type="radio" name="norm" value="none" onclick="normalkm=false; normalpob=false;setQ();" checked="checked">Sin Normalizar
			</div>
			</center>
		</div>
		
		<div id='score' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')"><center>
				 <div class="actions" id="actions">
			        <button class="cicswitcher" id="column">COLUMNA</button> 
			        <button class="cicswitcher" id="area">AREA</button> 
			        <button class="cicswitcher" id="line">LINEA</button> 
			        <button class="cicswitcher" id="spline">SPLINE</button> 
			        <button class="cicswitcher" id="areaspline">AREA+SPLINE</button>
			     </div>
				 <div id="chart0" style="width: 70%; max-height: 80%; margin:auto;"></div>
				  <div id="accordion">
				          <h3>Resumen Comparativo</h3>
				          <div>
				                <div id="chartRC" class="chart"></div>
				          </div>

					  	  <h3 >Municipio de Monterrey</h3>
				          <div>
				                <div id="chartMTY1" class="chart"></div>
				
				                <div id="chartMTY2" class="chart"></div>
				
				                <div id="chartMTY3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de San Pedro Garza García</h3>
				          <div>
				                <div id="chartSP1" class="chart"></div>
				
				                <div id="chartSP2" class="chart"></div>
				
				                <div id="chartSP3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de San Nicolás de los Garza</h3>
				          <div>
				                <div id="chartSN1" class="chart"></div>
				
				                <div id="chartSN2" class="chart"></div>
				
				                <div id="chartSN3" class="chart"></div>
				            </div>
				          
				          <h3>Municipio de Guadalupe</h3>
				          <div>
				                <div id="chartGPE1" class="chart"></div>
				
				                <div id="chartGPE2" class="chart"></div>
				
				                <div id="chartGPE3" class="chart"></div>
				            </div>
				            
				          <h3>Municipio de General Escobedo</h3>
				          <div>
				                <div id="chartESC1" class="chart"></div>
				
				                <div id="chartESC2" class="chart"></div>
				
				                <div id="chartESC3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Apodaca</h3>
				          <div>
				                <div id="chartAPO1" class="chart"></div>
				
				                <div id="chartAPO2" class="chart"></div>
				
				                <div id="chartAPO3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Santa Catarina</h3>
				          <div>
				                <div id="chartSC1" class="chart"></div>
				
				                <div id="chartSC2" class="chart"></div>
				
				                <div id="chartSC3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Juárez</h3>
				          <div>
				                <div id="chartJUA1" class="chart"></div>
				
				                <div id="chartJUA2" class="chart"></div>
				
				                <div id="chartJUA3" class="chart"></div>
				            </div>
				            
				          <h3>Municipio de Cadereyta Jiménez</h3>
				          <div>
				                <div id="chartCAD1" class="chart"></div>
				
				                <div id="chartCAD2" class="chart"></div>
				
				                <div id="chartCAD3" class="chart"></div>
				          </div>
				          
				          <h3>Municipio de García</h3>
				          <div>
				                <div id="chartGAR1" class="chart"></div>
				
				                <div id="chartGAR2" class="chart"></div>
				
				                <div id="chartGAR3" class="chart"></div>
				          </div>
				          
				          <h3>Municipio de Santiago</h3>
				          <div>
				                <div id="chartSTG1" class="chart"></div>
				
				                <div id="chartSTG2" class="chart"></div>
				
				                <div id="chartSTG3" class="chart"></div>
				          </div>
				          
				    </div>
				 </center>
		</div>
	
		<div id='wordle-container' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<!-- here wordle renders a new div with -->
		</div>
		
		<div id="twitter" style="width:100%; height: 100%; display:none; background-color:#163D74; opacity:0.9; top: 35px;">
			<center>
				<div id="twitterContent" style="padding: 60px; position:absolute; max-height:80%; overflow-y:auto!important;"></div>
		    </center>
        </div>
        
        <div id='execrep' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center>
				<div id="execRepContent" style="top: 40px; bottom: 60px; position:absolute; height:100%; width:100%; overflow-y:auto!important; position:fixed"></div>
			</center>
		</div>
	</div>
		
	<!-- PAGESLIDES -->
	<div>   
	<div class="reportslide" id="report-content" style="right:265px!important;"><div id="disqus_thread"></div></div>
	
	
	<div id="counterOverlay">
		<div class="counterslide" id="counter" onclick="if ($('.countersslide').is(':visible')){$('.countersslide').hide('fold', {}, 400);}else{$('.countersslide').show('fold', {}, 400);}"  style="width:auto;">
	    <div>
			<input type="text" id="counterVal" class="rangevalue" style="width:auto; text-align:center; font-size:16px;"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="margin-right:294px;">
	    <div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/avisos.jpg" Title="AVISOS">
			<input type="text" id="counterVal_avisos" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="AVISOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/eventos.jpg" Title="EVENTO PÚBLICO">
			<input type="text" id="counterVal_eventos" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="EVENTO PÚBLICO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/observador.png" Title="OBSERVADOR CIUDADANO">
			<input type="text" id="counterVal_observador" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="OBSERVADOR CIUDADANO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pcomunidad.jpg" Title="PROPUESTA COMUNIDAD">
			<input type="text" id="counterVal_pcomunidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA COMUNIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pseguridad.jpg" Title="PROPUESTA SEGURIDAD">
			<input type="text" id="counterVal_pseguridad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA SEGURIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pservicios.jpg" Title="PROPUESTA SERVICIOS">
			<input type="text" id="counterVal_pservicios" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA SERVICIOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pvialidad.jpg" Title="PROPUESTA VIALIDAD">
			<input type="text" id="counterVal_pvialidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;"Title="PROPUESTA VIALIDAD"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="margin-right:147px;">
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/incendio.jpg" Title="INCENDIO">
			<input type="text" id="counterVal_incendio" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="INCENDIO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/robo.jpg" Title="ROBO">
			<input type="text" id="counterVal_robo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ROBO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/sitriesgo.jpg" Title="SITUACIÓN DE RIESGO">
			<input type="text" id="counterVal_sitriesgo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="SITUACIÓN DE RIESGO"disabled/>
		</div>
		
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/accidente.jpg" Title="ACCIDENTE">
			<input type="text" id="counterVal_accidente" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ACCIDENTE" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/bache.jpg" Title="BACHE">
			<input type="text" id="counterVal_bache" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="BACHE" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/obras.jpg" Title="OBRA O VÍA CERRADA">
			<input type="text" id="counterVal_obras" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="OBRA O VÍA CERRADA"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/semaforo.jpg" Title="SEMÁFORO DESCOMPUESTO">
			<input type="text" id="counterVal_semaforo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="SEMÁFORO DESCOMPUESTO"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="">
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/alcantarillas.jpg" Title="ALCANTARILLAS">
			<input type="text" id="counterVal_alcantarillas" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ALCANTARILLAS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/alumbrado.jpg" Title="ALUMBRADO PÚBLICO">
			<input type="text" id="counterVal_alumbrado" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ALUMBRADO PÚBLICO" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/electricidad.jpg" Title="FALTA ELECTRICIDAD">
			<input type="text" id="counterVal_electricidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="FALTA ELECTRICIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/fuga.jpg" Title="FUGA">
			<input type="text" id="counterVal_fuga" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="FUGA"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/parques.png" Title="PARQUES DESCUIDADOS">
			<input type="text" id="counterVal_parques" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PARQUES DESCUIDADOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/basura.jpg" Title="RECOLECCIÓN DE BASURA">
			<input type="text" id="counterVal_basura" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="RECOLECCIÓN DE BASURA" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/emergencias.jpg" Title="EMERGENCIAS">
			<input type="text" id="counterVal_emergencias" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="EMERGENCIAS"disabled/>
		</div>
	</div>
	</div>
	
	<div id="filterOverlay">
		<div class="activeslide" onclick="if ($('.activesslide').is(':visible')){$('.activesslide').hide('fold', {}, 400);}else if(anyFilter){$('.activesslide').show('fold', {}, 400);}">
	    <center>
			<img style="border-radius:4px;" width="25px" height="25px" src="images/actfilter.png" alt="Ver filtros">
		</center>
	</div>
		<div class="activeslide" style="margin-left:43px;" onclick="$('.activesslide').hide('fold', {}, 400); if(anyFilter)resetFilters();">
	     <center>
			<img style="border-radius:4px;" width="25px" height="25px" src="images/remfilter.png" alt="Remover filtros">
		</center>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="">
		<div id="activeF_Cat"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:127px;">
		<div id="activeF_Dat"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:254px;">
		<div id="activeF_Mun"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:381px;">
		<div id="activeF_Sta"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:508px;">
		<div id="activeF_Dis"></div>
	</div>
	</div>
	
	<div class="filterslide" id="filtercate">
	    <div style="margin-left:15px!important;">
	    	<h2 style="max-width:250px;"> Categoría </h2><br>
			<img style="padding-top:3px; padding-bottom:3px; cursor:pointer;" src="images/comunidad.png" alt="COMUNIDAD" onclick="multipleCat('comunidad')">
			<div>
				<input type="checkbox" id="avisos" class="switch" />
				<label for="avisos"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/avisos.jpg">
					&nbsp;&nbsp;Avisos
				</label>
			</div>
			<div>
				<input type="checkbox" id="eventos" class="switch" />
				<label for="eventos"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/eventos.jpg">
					&nbsp;&nbsp;Evento público
				</label>
			</div>
			<div>	
				<input type="checkbox" id="observador" class="switch" />
				<label for="observador"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/observador.png">
					&nbsp;&nbsp;Observador ciudadano
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/propuestas.png"/ alt="PROPUESTAS" onclick="multipleCat('propuestas')">
			<div>
				<input type="checkbox" id="pcomunidad" class="switch" />
				<label for="pcomunidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pcomunidad.jpg">
					&nbsp;&nbsp;Comunidad
				</label>
			</div>
			<div>
				<input type="checkbox" id="pseguridad" class="switch" />
				<label for="pseguridad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pseguridad.jpg">
					&nbsp;&nbsp;Seguridad
				</label>
			</div>
			<div>	
				<input type="checkbox" id="pservicios" class="switch" />
				<label for="pservicios"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pservicios.jpg">
					&nbsp;&nbsp;Servicios públicos
				</label>
			</div>
			<div>	
				<input type="checkbox" id="pvialidad" class="switch" />
				<label for="pvialidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pvialidad.jpg">
					&nbsp;&nbsp;Vialidad
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/seguridad.png"/ alt="SEGURIDAD" onclick="multipleCat('seguridad')">
			<div>
				<input type="checkbox" id="incendio" class="switch" />
				<label for="incendio"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/incendio.jpg">
					&nbsp;&nbsp;Incendio
				</label>
			</div>
			<div>
				<input type="checkbox" id="robo" class="switch" />
				<label for="robo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/robo.jpg">
					&nbsp;&nbsp;Robo
				</label>
			</div>
			<div>	
				<input type="checkbox" id="sitriesgo" class="switch" />
				<label for="sitriesgo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/sitriesgo.jpg">
					&nbsp;&nbsp;Situación de riesgo
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/servicios.png"/ alt="SERVICIOS" onclick="multipleCat('servicios')">
			<div>	
				<input type="checkbox" id="alcantarillas" class="switch" />
				<label for="alcantarillas"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/alcantarillas.jpg">
					&nbsp;&nbsp;Alcantarillas
				</label>
			</div>
			<div>	
				<input type="checkbox" id="alumbrado" class="switch" />
				<label for="alumbrado"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/alumbrado.jpg">
					&nbsp;&nbsp;Alumbrado
				</label>
			</div>
			<div>	
				<input type="checkbox" id="electricidad" class="switch" />
				<label for="electricidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/electricidad.jpg">
					&nbsp;&nbsp;Falta electricidad
				</label>
			</div>
			<div>	
				<input type="checkbox" id="fuga" class="switch" />
				<label for="fuga"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/fuga.jpg">
					&nbsp;&nbsp;Fuga
				</label>
			</div>
			<div>	
				<input type="checkbox" id="parques" class="switch" />
				<label for="parques"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/parques.png">
					&nbsp;&nbsp;Parques descuidados
				</label>
			</div>
			<div>	
				<input type="checkbox" id="basura" class="switch" />
				<label for="basura"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/basura.jpg">
					&nbsp;&nbsp;Recolección de basura
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/vialidad.png"/ alt="VIALIDAD" onclick="multipleCat('vialidad')">
			<div>	
				<input type="checkbox" id="accidente" class="switch" />
				<label for="accidente"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/accidente.jpg">
					&nbsp;&nbsp;Accidente
				</label>
			</div>
			<div>	
				<input type="checkbox" id="bache" class="switch" />
				<label for="bache"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bache.jpg">
					&nbsp;&nbsp;Bache o vía dañada
				</label>
			</div>
			<div>	
				<input type="checkbox" id="obras" class="switch" />
				<label for="obras"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/obras.jpg">
					&nbsp;&nbsp;Obras o vía cerrada
				</label>
			</div>
			<div>	
				<input type="checkbox" id="semaforo" class="switch" />
				<label for="semaforo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/semaforo.jpg">
					&nbsp;&nbsp;Semáforo descompuesto
				</label>
			</div>
			<img style="padding-top:3px; cursor:pointer" src="images/emergencias.png"/ alt="EMERGENCIAS" onclick="multipleCat('emergencia')">
			<div>	
				<input type="checkbox" id="emergencias" class="switch" />
				<label for="emergencias"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/emergencias.jpg">
					&nbsp;&nbsp;Emergencias
				</label>
			</div>	
				
		</div>
	</div>
	
	<div class="filterslide" id="filterdate">
	     <div style="margin-left:15px!important; max-width:245px">
		     <h2 style="max-width:250px;"> Fecha </h2><br>
			<img style="padding-top:8px; padding-bottom:6px;" src="images/fecha.png" alt="FECHA">
		    <div>
				<input type="checkbox" id="calendario" name="checkbox" class="switch" />
				<label for="calendario">Activar calendario</label>
				<div>
					<label for="from" style="float:left; margin-top:7px; padding:2px;" >Desde</label>
					<input type="text" id="desde" class="rangevalue" style="float:right; margin-right:35%; width:auto;"/>
				</div>
				<div>
					<label for="to" style="float:left; margin-top:7px; padding:2px;" >Hasta </label>
					<input type="text" id="hasta" class="rangevalue" style="float:right; margin-right:35%; width:auto;"/>
				</div>
		    </div>
		    <div style="margin-top:3px">
				<input type="checkbox" id="sietedias" name="checkbox" class="switch"  />
				<label for="sietedias">Últimos 7 Días</label>
			</div>
			<div>	
				<input type="checkbox" id="quincedias" name="checkbox" class="switch" />
				<label for="quincedias">Últimos 15 Días</label> 
			</div>
			<div>	
				<input type="checkbox" id="treintadias" name="checkbox" class="switch" />
				<label for="treintadias">Últimos 30 Días</label> 
			</div>
			<div>	
				<input type="checkbox" id="noventadias" name="checkbox" class="switch" />
				<label for="noventadias">Últimos 90 Días</label> 
			</div>	
			<img style="padding-top:8px; padding-bottom:3px;" src="images/diario.png" alt="DIAS">
			<div style="margin-top:3px">
				<input type="checkbox" id="domingo" name="checkbox" class="switch"  />
				<label for="domingo">Domingo</label>
			</div>
			<div>	
				<input type="checkbox" id="lunes" name="checkbox" class="switch" />
				<label for="lunes">Lunes</label> 
			</div>
			<div>	
				<input type="checkbox" id="martes" name="checkbox" class="switch" />
				<label for="martes">Martes</label> 
			</div>
			<div>	
				<input type="checkbox" id="miercoles" name="checkbox" class="switch" />
				<label for="miercoles">Miércoles</label> 
			</div>
			<div>	
				<input type="checkbox" id="jueves" name="checkbox" class="switch" />
				<label for="jueves">Jueves</label> 
			</div>
			<div>	
				<input type="checkbox" id="viernes" name="checkbox" class="switch" />
				<label for="viernes">Viernes</label> 
			</div>
			<div>	
				<input type="checkbox" id="sabado" name="checkbox" class="switch" />
				<label for="sabado">Sábado</label> 
			</div>
			<img style="padding-top:8px; padding-bottom:3px;" src="images/horario.png" alt="HORARIO">
			<div>
				<input type="checkbox" id="ulthoras" name="checkbox" class="switch"/>
				<label for="ulthoras">Activar últimas horas</label>
				<input type="text" id="amount" class="rangevalue" style="float:left; margin-right: 60%; width: 65px; text-align: center; " disabled/>
				<div id="slider-ulthoras" style="width: 126px; margin-left: 77px!important;"></div>
			</div>
			<div>
				<input type="checkbox" id="horasdeldia" name="checkbox" class="switch"/>
				<label for="horasdeldia">Activar horario de interés</label>
				<input type="text" id="amount1" class="rangevalue" style="float:left; margin-right: 60%; width: 65px; text-align: center; " disabled/>
				<div id="slider-horasdeldia" style="width: 126px; margin-left: 77px!important;"></div>
			</div>
							
			</div>	
		</div>
	
	<div class="filterslide" id="filtermuni">
	  <div style="margin-left:15px!important;">
		    <h2 style="max-width:250px;"> Municipio </h2><br>
			<img style="padding-top:3px; padding-bottom:6px;" src="images/municipio.png" alt="MUNICIPIO">
			<div>
				<input type="checkbox" id="monterrey" class="switch" />
				<label for="monterrey"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_mty.png">
					&nbsp;&nbsp;Monterrey
				</label>
			</div>
			<div>
				<input type="checkbox" id="sanpedro" class="switch" />
				<label for="sanpedro"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sp.png">
					&nbsp;&nbsp;San Pedro
				</label>
			</div>
			<div>
				<input type="checkbox" id="guadalupe" class="switch" />
				<label for="guadalupe"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_gpe.png">
					&nbsp;&nbsp;Guadalupe
				</label>
			</div>
			<div>
				<input type="checkbox" id="sannico" class="switch" />
				<label for="sannico"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sn.png">
					&nbsp;&nbsp;San Nicolás
				</label>
			</div>
			<div>
				<input type="checkbox" id="santacat" class="switch" />
				<label for="santacat"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sc.png">
					&nbsp;&nbsp;Santa Catarina
				</label>
			</div>
			<div>
				<input type="checkbox" id="apodaca" class="switch" />
				<label for="apodaca"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_apo.png">
					&nbsp;&nbsp;Apodaca
				</label>
			</div>
			<div>
				<input type="checkbox" id="garcia" class="switch" />
				<label for="garcia"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_gar.png">
					&nbsp;&nbsp;García
				</label>
			</div>
			<div>
				<input type="checkbox" id="escobedo" class="switch" />
				<label for="escobedo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_esc.png">
					&nbsp;&nbsp;Escobedo
				</label>
			</div>
			<div>
				<input type="checkbox" id="juarez" class="switch" />
				<label for="juarez"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_jua.png">
					&nbsp;&nbsp;Juárez
				</label>
			</div>
			<div>
				<input type="checkbox" id="cadereyta" class="switch" />
				<label for="cadereyta"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_cad.png">
					&nbsp;&nbsp;Cadereyta
				</label>
			</div>
			<div>
				<input type="checkbox" id="santiago" class="switch" />
				<label for="santiago"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_stg.png">
					&nbsp;&nbsp;Santiago
				</label>
			</div>
		</div>
	</div>
	
	<div class="filterslide" id="filterstat">
	     <div style="margin-left:15px!important;">
		     <h2 style="max-width:250px;"> Detalle de reporte </h2><br>
			<img style="padding-top:3px; padding-bottom:6px;" src="images/repstatus.png" alt="ESTADO">
			<div>
				<input type="checkbox" id="abierto" class="switch" />
				<label for="abierto"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-open.png">
					&nbsp;&nbsp;Abierto
				</label>
			</div>
			<div>
				<input type="checkbox" id="cerrado" class="switch" />
				<label for="cerrado"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-closed.png">
					&nbsp;&nbsp;Cerrado con éxito
				</label>
			</div>
			<div>
				<input type="checkbox" id="cerradofail" class="switch" />
				<label for="cerradofail"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-closed_fail.png">
					&nbsp;&nbsp;Cerrado con fallo
				</label>
			</div>
			
			<img style="padding-top:10px; padding-bottom:6px;" src="images/repmedia.png" alt="ESTADO">
			<div>
				<input type="checkbox" id="voto" class="switch" />
				<label for="voto"> 
					&nbsp;&nbsp;Votos
				</label>
			</div>
			
			<div style="margin-right: 56;float: right;margin-top: -21;">
				<input type="checkbox" id="bubbles">
				<label for="bubbles">Destacar
				</label>
			</div>
			<div>
				<input type="text" id="amountvoto" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-voto" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			
			<div>
				<input type="checkbox" id="star" class="switch" />
				<label for="star"> 
					&nbsp;&nbsp;Calificación
				</label>
				<input type="text" id="amountstar" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-star" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			<div>
				<input type="checkbox" id="asset" class="switch" />
				<label for="asset"> 
					&nbsp;&nbsp;Imágenes
				</label>
			</div>
			
		</div>
	</div>

	<div class="filterslide" id="filterdist">
	     <div style="margin-left:15px!important;">
		     <h2 style="max-width:250px;"> Distancia </h2><br>
			<img class="imgDist" src="images/mapposition.png" alt="POLÍGONO">
			<div>
				<input type="checkbox" id="closedistance" class="switch" />
				<label for="closedistance"> 
					&nbsp;&nbsp;Total de reportes
				</label>
				<input type="text" id="amount2" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-closedistance" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			<img class="imgDist" src="images/polygonrad.png" alt="RADIO">
			<div>
				<input type="checkbox" id="radius" class="switch" />
				<label for="radius"> 
					&nbsp;&nbsp;Total de metros
				</label>
			</div>
			
			<input type="text" id="radiusval" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 9px!important; text-align: center; " disabled/>
			<div id="slider-radius" style="width: 126px; margin-left: 77px!important;"></div>
			<img class="imgDist" src="images/polygons.png" alt="POLÍGONO">
			<div>
				<input type="checkbox" id="polyfilter" class="switch" />
				<label for="polyfilter"> 
					&nbsp;&nbsp;Crear polígonos
				</label>
			</div>
	     </div>
	</div>
	</div>

	<!-- G+ SIGN-IN DIV -->
	<div id="gplus" style="z-index: 10;position: absolute;margin-left: 20px; bottom: 4px;">
			<div id="gConnect">
			    <button class="g-signin"
			        data-scope="https://www.googleapis.com/auth/plus.login"
			        data-requestvisibleactions="http://schemas.google.com/AddActivity"
			        data-clientId="849012671873.apps.googleusercontent.com"
			        data-callback="onSignInCallback"
			        data-theme="dark"
			        data-cookiepolicy="single_host_origin">
			    </button>
			  </div>
			  <div id="authOps" style="display:none">
    <h2  style="display:none">User is now signed in to the app using Google+</h2>
    <p  style="display:none">If the user chooses to disconnect, the app must delete all stored
    information retrieved from Google for the given user.</p>
    <button id="disconnect" class="logout danger"></button>
    
    <h2  style="display:none">User's profile information</h2>
    <div id="profile" style="position:absolute;bottom:-23px;height:40px"></div>

    <h2  style="display:none">User's friends that are visible to this app</h2>
    <div id="visiblePeople"  style="display:none"></div>

    <h2  style="display:none">Authentication Logs</h2>
    <pre id="authResult"  style="display:none"></pre>
  </div>
			  <div id="loaderror">
			    This section will be hidden by JQuery. If you can see this message, you
			    may be viewing the file rather than running a web server.<br />
			    The sample must be run from http or https. See instructions at
			    <a href="https://developers.google.com/+/quickstart/javascript">
			    https://developers.google.com/+/quickstart/javascript</a>.
			  </div>
		
	</div>

<script type="text/javascript">
/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>	
</body>
<!-- G+ SIGN-IN SCRIPTS-->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script');
    po.type = 'text/javascript'; po.async = true;
    po.src = 'https://plus.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
  </script>
<script type="text/javascript">
var helper = (function() {
  var BASE_API_PATH = 'plus/v1/';

  return {
    /**
     * Hides the sign in button and starts the post-authorization operations.
     *
     * @param {Object} authResult An Object which contains the access token and
     *   other authentication information.
     */
    onSignInCallback: function(authResult) {
      gapi.client.load('plus','v1', function(){
        $('#authResult').html('Auth Result:<br/>');
        for (var field in authResult) {
          $('#authResult').append(' ' + field + ': ' +
              authResult[field] + '<br/>');
        }
        if (authResult['access_token']) {
          $('#authOps').show('slow');
          $('#gConnect').hide();
          helper.profile();
          helper.people();
        } else if (authResult['error']) {
          // There was an error, which means the user is not signed in.
          // As an example, you can handle by writing to the console:
          console.log('There was an error: ' + authResult['error']);
          $('#authResult').append('Logged out');
          $('#authOps').hide('slow');
          $('#gConnect').show();
        }
        console.log('authResult', authResult);
      });
    },

    /**
     * Calls the OAuth2 endpoint to disconnect the app for the user.
     */
    disconnect: function() {
      // Revoke the access token.
      $.ajax({
        type: 'GET',
        url: 'https://accounts.google.com/o/oauth2/revoke?token=' +
            gapi.auth.getToken().access_token,
        async: false,
        contentType: 'application/json',
        dataType: 'jsonp',
        success: function(result) {
          console.log('revoke response: ' + result);
          $('#gplus').css("bottom","-=31"); 
          $('#authOps').hide();
          $('#profile').empty();
          $('#visiblePeople').empty();
          $('#authResult').empty();
          $('#gConnect').show();
        },
        error: function(e) {
          console.log(e);
        }
      });
    },

    /**
     * Gets and renders the list of people visible to this app.
     */
    people: function() {
      var request = gapi.client.plus.people.list({
        'userId': 'me',
        'collection': 'visible'
      });
      request.execute(function(people) {
        $('#visiblePeople').empty();
        $('#visiblePeople').append('Number of people visible to this app: ' +
            people.totalItems + '<br/>');
        for (var personIndex in people.items) {
          person = people.items[personIndex];
          $('#visiblePeople').append('<img src="' + person.image.url + '">');
        }
      });
    },

    /**
     * Gets and renders the currently signed in user's profile data.
     */
    profile: function(){
      var request = gapi.client.plus.people.get( {'userId' : 'me'} );
      request.execute( function(profile) {
        $('#profile').empty();
        if (profile.error) {
          $('#profile').append(profile.error);
          return;
        }
        $('#profile').append(
            $('<p><img src=\"' + profile.image.url + '\" height="40" width="40"></p>'));
        $('#gplus').css("bottom","+=31");  
        /*$('#profile').append(
            $('<p>Hello ' + profile.displayName + '!<br />Tagline: ' +
            profile.tagline + '<br />About: ' + profile.aboutMe + '</p>'));
        if (profile.cover && profile.coverPhoto) {
          $('#profile').append(
              $('<img src=\"' + profile.cover.coverPhoto.url + '\">'));
        }*/
      });
    }
  };
})();

/**
 * jQuery initialization
 */
$(document).ready(function() {
  $('#disconnect').click(helper.disconnect);
  $('#loaderror').hide();
  if ($('[data-clientid="YOUR_CLIENT_ID"]').length > 0) {
    alert('This sample requires your OAuth credentials (client ID) ' +
        'from the Google APIs console:\n' +
        '    https://code.google.com/apis/console/#:access\n\n' +
        'Find and replace YOUR_CLIENT_ID with your client ID.'
    );
  }
});

/**
 * Calls the helper method that handles the authentication flow.
 *
 * @param {Object} authResult An Object which contains the access token and
 *   other authentication information.
 */
function onSignInCallback(authResult) {
  helper.onSignInCallback(authResult);
}
</script>
</html>
