<link rel="stylesheet" type="text/css" media="all" href="style.css" />
<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="TEHUAN para el CIC es una red de confianza 100% ciudadana que enlaza e integra al ciudadano y las autoridades por medio de espacios claros." />
<meta name="keywords" content="CIC,TEHUAN,CICMty,Tehuan,Monterrey"/>
<meta name="author" content="Jesús Cepeda (@chuycepeda), Jesús Del Bosque (@chuydb)"/>
<meta property="og:site_name" content="Tehuan 3.0"/>
<meta property="og:title" content="Conoce el Proyecto CIC - Tehuan"/>
<meta property="og:type" content="non_profit"/>
<meta property="og:description" content="Tehuan para el CIC es una red de confianza 100% ciudadana que enlaza e integra al ciudadano y las autoridades por medio de espacios claros."/>
<meta property="og:url" content="http://tehuan.cic.mx"/>
<meta property="og:image" content="http://cic.mx/src/tehuanscreenSM.png"/>
<meta property="og:image" content="http://cic.mx/src/tehuanscreen.png"/>
<meta property="og:image" content="http://cic.mx/src/cicscreen.png"/>
<meta name="twitter:title" content="Te invito a conocer el Proyecto Tehuan de @CICMty"/>
<meta name="twitter:image" content="http://cic.mx/src/tehuanscreenSM.png"/>
<meta property="twitter:description" content="Tehuan para el CIC es una red de confianza 100% ciudadana que enlaza e integra al ciudadano y las autoridades por medio de espacios claros."/>
<title>CIC.MX » Tehuan</title>
<!-- CSS References -->
<link rel="shortcut icon" href="images/favicon.ico">
<link rel="stylesheet" type="text/css" href="css/introjs.css"/>
<link rel="stylesheet" type="text/css" href="css/cartodb.css" />
<link rel="stylesheet" type="text/css" href="css/jquery-ui.css" />
<link rel="stylesheet" type="text/css" href="css/jquery.share.css"/>
<link rel="stylesheet" type="text/css" href="css/default.css" />
<!-- JS References -->
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=drawing,places,panoramio,weather,visualization"></script>
<script src="http://libs.cartocdn.com/cartodb.js/v2/cartodb.js"></script>
<script src="js/jquery.js"></script> 
<script src="js/jquery-ui.js"></script>
<script src="js/jquery.share.js"></script>
<script src="js/jquery.raptorize.1.0.js"></script>
<script src="js/jquery.searchMeme.js" ></script>
<script src="js/spin.js"></script>
<script src="js/intro.js"></script>
<script src="js/WordleUtils.js" ></script>
<script src="js/Wordle.js"></script>
<script src="js/regression.js"></script>
<script src="js/lib/dat.gui.js"></script>
<script src="js/lib/underscore-min.js"></script>
<script src="js/lib/backbone.js"></script>
<script src="js/lib/class.js"></script>
<script src="js/lib/backbone.cartodb.js"></script>
<script src="js/src/canvas_tile_layer.js"></script>
<script src="js/src/grid_layer.js"></script>
<script src="js/src/torque.js"></script>
<script src="js/d3.min.js"></script>
<script src="js/d3.layout.min.js"></script>
<script src="js/date.js"></script>
<script src="js/qrcode.js"></script>
<script src="js/highstock.src.js" ></script>
<script src="js/exporting.src.js" ></script>
<!-- OWN JS -->
<script type="text/javascript" src="js/ageb.js" ></script>
<script type="text/javascript" src="js/gdropdown.js"> </script>
<!-- <script type="text/javascript" src="js/gheatmap.js"> </script> -->
<!-- GOOGLE ANALYTICS -->
<script type="text/javascript" src="js/ganalytics.js" ></script>
<!-- BROWSER DETECTION -->
<script type="text/javascript" src="js/browserdetect.js" ></script>

<!-- CONFIGURATION VARS -->
<script type="text/javascript">
	/* ACCOUNT-DEPENDING CONFIGURATIONS */
	
	//MARKER IMAGES SOURCE URL
	var sourceurl = "http://cic-workshop.biz/tehuan-beta/ico/";
	//DISQUS BOARD NAME FOR COMMENTS
	var disqus_shortname = 'tehuan-beta';
	//CARTO
	var area_name = 'mun_poly';
	var table_name = 'nl_public';
	var table_ageb = 'nl_ageb2010';
	var sql = new cartodb.SQL({ user: 'cicadmin' });
	//ASSETS & IMAGES
	var accountURL = 'nl.cic.mx';
	//VOTES & STARS
	var accountAPI = 'http://api.cic.mx/ushahidi/nl/api/';
	//TWITTER
	var twitterID = ["347783020163518464", "347787216354942976", "348846254127726592", "348817018734137344", "348817444414033922", "347786457651503104", "348817995189075971", "348818811291570177", "348819099444453376", "348819379582017539", "348819636558635008", "348819863118159873", "348820099265884160", "348820315805216769"];
	var twitterName = ["Cicmty", "viaCICmty", "spuCICmty", "comCICmty", "emeCICmty", "segCICmty", "segCICsp", "segCICgpe", "segCICsn", "segCICapo", "segCICesc", "segCICgar", "segCICcad", "segCICsc"];
	
	/* CONSTANTS */
    
    var publicServices = ['ALCANTARILLAS','ALUMBRADO PUBLICO','BACHE O VIA DAÑADA','FALTA ELECTRICIDAD','FUGA','PARQUES DESCUIDADOS', 'RECOLECCION DE BASURA','SEMAFORO DESCOMPUESTO'];
	var reportOrigins = ['Ushahidi', 'URI', 'CRM', 'Twitter', 'MAIL', 'SMS']; 
	var munNL = ["Abasolo", "Agualeguas", "Allende", "Anáhuac", "Apodaca", "Aramberri", "Bustamante", "Cadereyta Jiménez", "Carmen", "Cerralvo", "China", "Ciénega de Flores", "Dr. Arroyo", "Dr. Coss", "Dr. González", "Galeana", "García", "Gral. Bravo", "Gral. Escobedo", "Gral. Terán", "Gral. Treviño", "Gral. Zaragoza", "Gral. Zuazua", "Guadalupe", "Hidalgo", "Higueras", "Hualahuises", "Iturbide", "Juárez", "Lampazos de Naranjo", "Linares", "Los Aldamas", "Los Herreras", "Los Ramones", "Marín", "Melchor Ocampo", "Mier y Noriega", "Mina", "Montemorelos", "Monterrey", "Parás", "Pesquería", "Rayones", "Sabinas Hidalgo", "Salinas Victoria", "San Nicolás de los Garza", "San Pedro Garza García", "Santa Catarina", "Santiago", "Vallecillo", "Villaldama"];
		
		/*
OTHER THINGS THAT MUST BE HIDDEN OR FIXED ACCORDING TO CATEGORY or MUNICIPALITY CHANGES
		
		If any category is added or removed or has changed:
			_tyle_style
			_tyle_style_cluster
			getImg();
			updateCounters()
			updateActiveFilters()
			resetFilters()
			multipleCat()
			filterFromStat()
			displayScore()
			<div id="filtercate">
			
		If any municipality is added or changed	
			getFullName()
			displayStats()
			displayScore()
			<div id"score">
			<div id="filtercate">
		
		If categories, municipalities, or new filters:	
			-ONLOAD JQUERY CHECKBOXES FILTER ACTIVATION	
			-setQ()
			-resetFilters()
*/
	
	//GET TimeZone on client system
	var dateToday = new Date();
	var dateText = dateToday.toString();
	var idxTZ = dateText.indexOf('(');
	var TZ = dateText.substring(idxTZ+1,dateText.length-1);

	/* CARTOCSS STYLE */
	//CATEGORY AND MARKER IMAGE
	
	/*CONFIG ARRAY STRUCTURE: [0]: category name as on cartoDB
					  		[1]: marker or thumbnail image (must be SAME name and type)
					  		[2]: category group for marker 
	*/
	
	var catMarkers = [
		['MTYMUYBIEN', 'com-mty.png', 'COMUNIDAD'],
		['AVISOS', 'com_avisos.png', 'COMUNIDAD'],
		['EVENTO PUBLICO', 'com_eventos.png', 'COMUNIDAD'],
		['OBSERVADOR CIUDADANO', 'com_observador.png', 'COMUNIDAD'],
		['ALCANTARILLAS', 'ser_alcantarilla.png', 'SERVICIOS PUBLICOS'],
		['ALUMBRADO PUBLICO', 'ser_alumbrado.png', 'SERVICIOS PUBLICOS'],
		['FALTA ELECTRICIDAD', 'ser_electricidad.png', 'SERVICIOS PUBLICOS'],
		['FUGA', 'ser_fuga.png', 'SERVICIOS PUBLICOS'],
		['PARQUES DESCUIDADOS', 'ser_parque.png', 'SERVICIOS PUBLICOS'],
		['RECOLECCION DE BASURA', 'ser_basura.png', 'SERVICIOS PUBLICOS'],
		['ACCIDENTE', 'via_accidente.png', 'VIALIDAD Y TRANSITO'],
		['BACHE O VIA DAÑADA', 'via_bache.png', 'VIALIDAD Y TRANSITO'],
		['OBRAS Y/O VIA CERRADA', 'via_obras.png', 'VIALIDAD Y TRANSITO'],
		['SEMAFORO DESCOMPUESTO', 'via_semaforo.png', 'VIALIDAD Y TRANSITO'],
		['VIALIDAD', 'vialidad.png', 'VIALIDAD Y TRANSITO'],
		['PROPUESTA COMUNIDAD', 'pro_comunidad.png', 'PROPUESTAS CIUDADANAS'],
		['PROPUESTA SEGURIDAD', 'pro_seguridad.png', 'PROPUESTAS CIUDADANAS'],
		['PROPUESTA SERV PUBLICOS', 'pro_servicios.png', 'PROPUESTAS CIUDADANAS'],
		['PROPUESTA VIALIDAD', 'pro_vialidad.png', 'PROPUESTAS CIUDADANAS'],
		['EMERGENCIAS', 'emergencia.png', 'EMERGENCIAS'],
		['INCENDIO', 'seg_incendio.png', 'SEGURIDAD'],
		['ROBO', 'seg_robo.png', 'SEGURIDAD'],
		['SITUACION DE RIESGO', 'seg_sitriesgo.png', 'SEGURIDAD'],
		['DETENCION DE BANDAS', 'seg_detbandas.png', 'SEGURIDAD'],
		['EXTORSION', 'seg_extorsion.png', 'SEGURIDAD'],
		['HOMICIDIO', 'seg_homicidio.png', 'SEGURIDAD'],
		['SECUESTRO', 'seg_secuestro.png', 'SEGURIDAD'],
		['SOSPECHOSO', 'seg_sospechoso.png', 'SEGURIDAD'],
		['AUTO ABANDONADO', 'seg_autoaban.png', 'SEGURIDAD'],
		['PERCEPCION DE INSEGURIDAD', 'seg_percdeinseg.png', 'SEGURIDAD'],
		['OTROS', 'otros.png', 'OTROS'],
		['ROBO AUTO', 'seg_roboauto.png', 'SEGURIDAD']
	];	
	var catColors = [
		[ "#F48F33", 'VIALIDAD Y TRANSITO'],
		[ "#FAD714", 'SERVICIOS PUBLICOS'],
		[ "#BAD544", 'COMUNIDAD'],
		[ "#E2E2E2", 'OTROS'],
		[ "#4CB057", 'PROPUESTAS CIUDADANAS'],
		[ "#669FD2", 'SEGURIDAD'],
		[ "#DB3539", 'EMERGENCIAS']
	];
	
	function createTileStyle(tStyle) {
		var mOverlap;
		var close;
		var tileStyle = "#{{table_name}}{";
		switch (tStyle) {
		case 'normal':
			mOverlap = true;
			closeStyle = "}";
			break;
		case 'cluster':
			mOverlap = false;
			closeStyle = "}";
			break;
		case 'bubble':
			mOverlap = false;
			closeStyle = "}#{{table_name}}{marker-fill:#FF5C00;marker-line-color:#FFF;marker-line-width:2;marker-line-opacity:1;marker-opacity:0.9;marker-placement:point;marker-type:ellipse;marker-allow-overlap:true;marker-clip:false;marker-multi-policy:largest;}"
			break;
		default:
			mOverlap = true;
			closeStyle = "}";
			break;
		}
		for (var i = 0; i < catMarkers.length; i++) {
			tileStyle += "[post_cat='" + catMarkers[i][0] + "']{marker-file:url('" + sourceurl + "map/" + catMarkers[i][1] + "');marker-clip:true;marker-allow-overlap:" + mOverlap + ";marker-width:30 ;}";
		}
		tileStyle += closeStyle;
		if (tStyle == "bubble") {
			for (var j = upperVotes.length - 1; j >= 0; j--) {
				tileStyle += "#{{table_name}}[votes<=" + upperVotes[j] + "]{marker-width:" + widthMarkers[j] + ";marker-line-color:yellow;marker-line-width:10;}";
			}
		}
		return tileStyle;
	}
	//BUBBLE STYLE
	var upperVotes;
	var widthMarkers = [];
	var steps = 10;
	var widthMin=5;
	var widthMax=60;
	for (var i = 0; i < steps; i++) {
		var t = i / (steps - 1);
		widthMarkers.push((widthMin + t * (widthMax - widthMin)).toFixed(1));
	}	var votesBins = 10;
	var votesCssq = "SELECT CDB_JenksBins(array_agg(votes::numeric), "+votesBins+") FROM "+table_name;
	sql.execute(votesCssq).done(function(data) {
		upperVotes = data.rows[0].cdb_jenksbins;
		_tile_style_bubbles = createTileStyle("bubble");
		$("#slider-voto").slider({max: upperVotes[upperVotes.length - 1]});
	}).error(function(errors) {});
	//OTHER STYLES
	var _tile_style = createTileStyle("normal");
	var _tile_style_cluster = createTileStyle("cluster");
	var _heatmap_style = "#{{table_name}}{marker-fill:#FFCC00;marker-width:12;marker-line-color:#FFF;marker-line-width:3;marker-line-opacity:0.9;marker-opacity:0.9;marker-comp-op:multiply;marker-type:ellipse;marker-placement:point;marker-allow-overlap:true;marker-clip:false;marker-multi-policy:largest;}";
	var _intensity_style = "#{{table_name}}{first/marker-fill:#0011cc;first/marker-opacity:0.01;first/marker-width:80;first/marker-line-width:0;first/marker-placement:point;first/marker-allow-overlap:true;first/marker-comp-op:lighten;second/marker-fill:#00cc11;second/marker-opacity:0.02;second/marker-width:50;second/marker-line-width:0;second/marker-placement:point;second/marker-allow-overlap:true;second/marker-comp-op:lighten;third/marker-fill:#00ff00;third/marker-opacity:0.04;third/marker-width:20;third/marker-line-width:0;third/marker-placement:point;third/marker-allow-overlap:true;third/marker-comp-op:lighten;}";
	
    /* VIEWS */
    var activeView ='home';
    var loadTwitter = true;
    
    var execRepOffset = 0;
	var execRepLimit = 3;
	
	/* DROPDOWN LAYER SELECTOR */	
	var hideCheck;
	var cicCheck=0;
	var checkOptions;
	var gMapsLayers = [
		["carto","CIC"],
		[new google.maps.TrafficLayer(), "Trafico"],
		[new google.maps.TransitLayer(), "Metro"],
		[new google.maps.BicyclingLayer(), "Bicicletas"],
		[new google.maps.weather.WeatherLayer({temperatureUnits: google.maps.weather.TemperatureUnit.CELSIUS}), "Temperatura"],
		[new google.maps.weather.CloudLayer(), "Nubes"],
		[new google.maps.panoramio.PanoramioLayer(),"Fotos"]	
	];	

	/* LOADING SPINNER OPTIONS */
	var opts = {
		lines: 13, // The number of lines to draw
		length: 8, // The length of each line
		width: 22, // The line thickness
		radius: 60, // The radius of the inner circle
		corners: 0.6, // Corner roundness (0..1)
		rotate: 63, // The rotation offset
		direction: 1, // 1: clockwise, -1: counterclockwise
		color: '#4CAA32', // #rgb or #rrggbb
		speed: 1.7, // Rounds per second
		trail: 25, // Afterglow percentage
		shadow: true, // Whether to render a shadow
		hwaccel: true, // Whether to use hardware acceleration
		className: 'spinner', // The CSS class to assign to the spinner
		zIndex: 2e9, // The z-index (defaults to 2000000000)
		top: 'auto', // Top position relative to parent in px
		left: 'auto' // Left position relative to parent in px
	};
				
	/* MAPS RELATED */
	var mapCenter = [25.672938,-100.309296];
	var map, map_T; 
	
	//CARTO
	var layerUrl = 'http://cicadmin.cartodb.com/api/v1/viz/'+table_name+'/viz.json'; 
	var layers = [];
	var torque = null; 
	var torqueOptions;
	var _interactivity = "cartodb_id,post_title,channel,post_cat,formatted_address,post_content,status,close_fail,ticket,last_mod,uuid,follow_up,follow_up_external,votes,stars,assets,created_at";
	var agebLayerUrl = 'http://cicadmin.cartodb.com/api/v1/viz/'+table_ageb+'/viz.json';

	//GMAPS
	var geocoder;
	var overlay,overlay_T;
	var radDeg;
	var shapesArray=[];
	var drawingManager;
    
    //GEO LOCATION
	var myLon, myLat;
    var watchID;
	var gmarker = null;
	var gmarkers=[];

	//CONTROLS AND DISPLAYs	
	var closeByReports = 10;	//for geo loc
	var mapcluster = true;	//for cluster style
	var bubbles = false;
	
	//for ageb use
	var selectedAgeb;
	var choro = false;
	var munLongName=[];
	var rmdHexArr;
	
    /* FILTER VARIABLES AND JQUERY TRIGGERS FOR QUERY DEFINITION */
    //categorias
    var categories = {
		avisos : false,
		eventos : false,
		observador : false,
		mtymuybien : false,
		pcomunidad : false,
		pseguridad : false,
		pservicios : false,
		pvialidad : false,
		incendio : false,
		robo : false,
		sitriesgo : false,
		alcantarillas : false,
		alumbrado : false,
		electricidad : false,
		fuga : false,
		parques : false,
		basura : false,
		accidente : false,
		bache : false,
		obras : false,
		semaforo : false,
		emergencias : false
	};
	//fecha
    var dates = {
		calendario :  false,
		sietedias : false,
		quincedias : false,
		treintadias : false,
		noventadias : false,
		domingo: false,
		lunes: false, 
		martes: false,
		miercoles: false,
		jueves: false,
		viernes: false,
		sabado: false,
		ulthoras : false,
		horasdeldia : false,
	};
	//municipio
	var mun = {
		mty : false,
		sp : false,
		sn : false,
		sc : false,
		gpe : false,
		apo : false,
		esc : false,
		jua : false,
		gar : false,
		cad : false,
		stg : false
	};
	//status de reporte
    var repStatus = {
		open : false,
		closed : false,
		closed_fail : false
	};
    //detalle de reporte
    var repDetail = {
	  	voto: false,
	  	star: false,
	  	asset: false  
    };
    var totalvotos = 0;
    var totalstar = 0;
    
    //distancia
    var closedistance = false;
    var radius = {	//radio de interes
		set : false,
		lat : mapCenter[0],
		lng : mapCenter[1],
		rad : 5000
	};
    var polyfilter = false;

	//para vistas consolidadas HC
	var byweeks = false;	//consolidar por semana
	var bymonths = false;	//consolidar por mes
	
	var muncons = false;	//consolidar por categorias
	var normalpob = false;	//normalizar por poblacion
    var normalkm = false;	//normalizar pot km
    
    //text search over post content, formatted address, ticket or wordcloud click
    var searchInput = "";
    
    // globals for query definition
    var _query = "SELECT * FROM "+table_name; //initial query
    var _geoq;
	
	var selectedCat, selectedTitle, selectedContent, selectedTicket, selectedAddress, selectedUrl, selectedStatus, selectedFail, selectedCreate, selectedUpdate, selectedFollowup, selectedFollowupExt, selectedVotes, selectedStars, selectedAssets, selectedComments, selectedUUID;
    
    //variables for time filters
    var desde, hasta;
    var valUltHoras = 3
    var firstTOD = 8, secondTOD = 12;
	var queryhorasdeldia = "(date_part('hour', "+table_name+".created_at at time zone '"+TZ+"') BETWEEN "+firstTOD+" and "+secondTOD+")";
	
	var anyFilter=false;
	
	///ADD SPLICE TO STRING PROTOTYPE FOR INSERTION
	String.prototype.splice = function( idx, rem, str ) {return (this.slice(0,idx) + str + this.slice(idx + Math.abs(rem)));};
	
	// WORDLE
	var wordle;
	
	// OCCURRENCE
	var formattedData = new Array(7);  // 7 days, 24 hours array
	for (var i = 0; i < formattedData.length; i++) {
		formattedData[i] = new Array(24);
	}
	var buckets = 11,
	colorScheme = 'rbow2',
	days = [
	    { name: 'Domingo', abbr: 'Do' },
		{ name: 'Lunes', abbr: 'Lu' },
		{ name: 'Martes', abbr: 'Ma' },
		{ name: 'Miércoles', abbr: 'Mi' },
		{ name: 'Jueves', abbr: 'Ju' },
		{ name: 'Viernes', abbr: 'Vi' },
		{ name: 'Sábado', abbr: 'Sá' }
	  ],
	  hours = ['12a', '1a', '2a', '3a', '4a', '5a', '6a', '7a', '8a', '9a', '10a', '11a', '12p', '1p', '2p', '3p', '4p', '5p', '6p', '7p', '8p', '9p', '10p', '11p'];
	  
	 // SCORE
	 var effectPercent = {}; 
	 
	 //DISQUS
     var disqus_identifier = '0';
     var disqus_url = window.location.href.split('?')[0];
     var disqus_developer = '1';
     var disqus_config = function () { this.language = "es_MX";};
     (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
     })();	 
</script>

<!-- MAP & CARTODB -->
<script type="text/javascript">
	/*   MAPS METHODS  */
	
	google.maps.event.addDomListener(window,'load', init);
	var panorama;	
	var sv = new google.maps.StreetViewService();
	geocoder = new google.maps.Geocoder();
	
	function reportElements (n, layer, latlng){
		sql.execute(n).done(function(data) {
		    selectedCreate = new Date(data.rows[0].created_at);
            selectedUpdate = new Date(data.rows[0].last_mod);
			layer.infowindow.set('template', $('#infowindow_template').html());
            setReportContent();
            getgSV(latlng);
        }).error(function(errors) {});
	}
	
	function setSelected(data) {
		selectedCat = data.post_cat;
		selectedTitle = data.post_title;
		selectedContent = (data.post_content == "") ? data.post_title : data.post_content;
		selectedTicket = data.ticket;
		selectedAddress = data.formatted_address;
		selectedUrl = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name;
		selectedStatus = (data.status == 'read') ? selectedStatus = "Abierto" : selectedStatus = "Cerrado";
		selectedFail = data.close_fail;
		selectedFollowup = data.follow_up;
		selectedFollowupExt = data.follow_up_external;
		selectedVotes = data.votes;
		selectedStars = data.stars;
		selectedAssets = data.assets;
		selectedComments = 0;
		selectedUUID = data.uuid;
	}	
	
	/****************************************
	************ INIT OBJECTS ***************
	****************************************/
	
	function init(){
		
		/*  MAP  */
		var mapOptions = {
			center: new google.maps.LatLng(mapCenter[0], mapCenter[1]),
			zoom: 11,
			minZoom:5,
			zoomControl: true,
			zoomControlOptions: {
				style: google.maps.ZoomControlStyle.SMALL,	
			},
			mapTypeControl: true,
			mapTypeControlOptions: { 
				mapTypeIds: [google.maps.MapTypeId.SATELLITE, 'style_1','style_2','style_3','style_4'],
				style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
			},
			scrollwheel: true,
			streetViewControl: true,
			panControl:false,
			backgroundColor: '#163D74',
			rotateControl:true,
			overviewMapControl:true
		};
		map = new google.maps.Map(document.getElementById('map'), mapOptions);
		
		/* GMAPS STYLES courtesy of http://snazzymaps.com/ */
		var styler1 = [];
		var styler2 = [{"featureType":"water","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"landscape","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":17}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":29},{"weight":0.2}]},{"featureType":"road.arterial","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":18}]},{"featureType":"road.local","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":16}]},{"featureType":"poi","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":21}]},{"elementType":"labels.text.stroke","stylers":[{"visibility":"on"},{"color":"#000000"},{"lightness":16}]},{"elementType":"labels.text.fill","stylers":[{"saturation":36},{"color":"#000000"},{"lightness":40}]},{"elementType":"labels.icon","stylers":[{"visibility":"off"}]},{"featureType":"transit","elementType":"geometry","stylers":[{"color":"#000000"},{"lightness":19}]},{"featureType":"administrative","elementType":"geometry.fill","stylers":[{"color":"#000000"},{"lightness":20}]},{"featureType":"administrative","elementType":"geometry.stroke","stylers":[{"color":"#000000"},{"lightness":17},{"weight":1.2}]}];
		var styler3 =[{"featureType":"water","elementType":"geometry","stylers":[{"color":"#a2daf2"}]},{"featureType":"landscape.man_made","elementType":"geometry","stylers":[{"color":"#f7f1df"}]},{"featureType":"landscape.natural","elementType":"geometry","stylers":[{"color":"#d0e3b4"}]},{"featureType":"landscape.natural.terrain","elementType":"geometry","stylers":[{"visibility":"off"}]},{"featureType":"poi.park","elementType":"geometry","stylers":[{"color":"#bde6ab"}]},{"featureType":"poi","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"poi.medical","elementType":"geometry","stylers":[{"color":"#fbd3da"}]},{"featureType":"poi.business","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"visibility":"off"}]},{"featureType":"road","elementType":"labels","stylers":[{"visibility":"off"}]},{"featureType":"road.highway","elementType":"geometry.fill","stylers":[{"color":"#ffe15f"}]},{"featureType":"road.highway","elementType":"geometry.stroke","stylers":[{"color":"#efd151"}]},{"featureType":"road.arterial","elementType":"geometry.fill","stylers":[{"color":"#ffffff"}]},{"featureType":"road.local","elementType":"geometry.fill","stylers":[{"color":"black"}]},{"featureType":"transit.station.airport","elementType":"geometry.fill","stylers":[{"color":"#cfb2db"}]}];
		var styler4 = [{"featureType":"water","stylers":[{"saturation":43},{"lightness":-11},{"hue":"#0088ff"}]},{"featureType":"road","elementType":"geometry.fill","stylers":[{"hue":"#ff0000"},{"saturation":-100},{"lightness":99}]},{"featureType":"road","elementType":"geometry.stroke","stylers":[{"color":"#808080"},{"lightness":54}]},{"featureType":"landscape.man_made","elementType":"geometry.fill","stylers":[{"color":"#ece2d9"}]},{"featureType":"poi.park","elementType":"geometry.fill","stylers":[{"color":"#ccdca1"}]},{"featureType":"road","elementType":"labels.text.fill","stylers":[{"color":"#767676"}]},{"featureType":"road","elementType":"labels.text.stroke","stylers":[{"color":"#ffffff"}]},{"featureType":"poi","stylers":[{"visibility":"off"}]},{"featureType":"landscape.natural","elementType":"geometry.fill","stylers":[{"visibility":"on"},{"color":"#b8cb93"}]},{"featureType":"poi.park","stylers":[{"visibility":"on"}]},{"featureType":"poi.sports_complex","stylers":[{"visibility":"on"}]},{"featureType":"poi.medical","stylers":[{"visibility":"on"}]},{"featureType":"poi.business","stylers":[{"visibility":"simplified"}]}];
		
		var styleMap1 = new google.maps.StyledMapType(styler1,{name: "GMaps"});	
		var styleMap2 = new google.maps.StyledMapType(styler2,{name: "Black"});	
		var styleMap3 = new google.maps.StyledMapType(styler3,{name: "Apple Maps"});	
		var styleMap4 = new google.maps.StyledMapType(styler4,{name: "Mapbox"});	
		
		map.mapTypes.set('style_1', styleMap1);
		map.mapTypes.set('style_2', styleMap2);
		map.mapTypes.set('style_3', styleMap3);
		map.mapTypes.set('style_4', styleMap4);

		map.setMapTypeId('style_1');
		
		google.maps.event.addListener(map, 'click', function(event) {
	        if (radius.set) {
	            radius.lat = event.latLng.lat();
	            radius.lng = event.latLng.lng();
	            updateRadDeg(radius.rad);
	            drawCircle();
	            updateBounds();
	            setQ();
	        }
		});
	    
	    //DROPDOWN LAYER SELECTOR
		/*courtesy of http://vislab-ccom.unh.edu/~briana/examples/gdropdown/ */
		
		var checkItems =[];
		for (var i=0;i < gMapsLayers.length;i++){
		   checkOptions = {
					gmap: map,
					title: gMapsLayers[i][1],
					id: gMapsLayers[i][1] +"Check",
					label: gMapsLayers[i][1],
					layer: gMapsLayers[i][0],
					q: "SELECT st_y(the_geom) as lat, st_x(the_geom) as lon FROM "+table_name
			}
			var check = new checkBox(checkOptions);
			checkItems.push(check);
		}
				
		var ddDivOptions = {
			items: checkItems,
			id: "myddOptsDiv"
		}
		var dropDownDiv = new dropDownOptionsDiv(ddDivOptions);
					
		var dropDownOptions = {
			gmap: map,
			name: 'Capas',
			id: 'ddControl',
			title: 'GMaps Layers Dropdown',
			position: google.maps.ControlPosition.TOP_RIGHT,
			dropDown: dropDownDiv
		}
		var dropDown = new dropDownControl(dropDownOptions);
	    
		google.maps.event.addListener(gMapsLayers[gMapsLayers.length-1][0], 'click', function(photo) {
			console.log(photo);
		});	    
		
	    ///DRAWING POLYGONS
	    drawingManager = new google.maps.drawing.DrawingManager({
		      drawingControl: false,
		      drawingControlOptions: {
		        position: google.maps.ControlPosition.TOP_RIGHT,
		        drawingModes: [google.maps.drawing.OverlayType.POLYGON]
		      },
		      polygonOptions: {
	        	strokeColor: "#0000ff",
	            strokeOpacity: 0.60,
	            strokeWeight: 2,
	            fillColor: "#0000ff",
	            fillOpacity: 0.150,
		        clickable: true,
		        zIndex: 1,
		        editable: true,
		        draggable: true
		      }
		});
		drawingManager.setMap(map);
	    // Add an event listener for when shape is complete
		google.maps.event.addListener(drawingManager, 'overlaycomplete', function(e) {
	      var newShape = e.overlay;
	      drawingManager.setDrawingMode(null);
	      shapesArray.push(newShape);
	      layers[0].show();
	      if (polyfilter) setQ();
	      // Event listener for rightclick
/*
	      google.maps.event.addListener(newShape, 'rightclick', function() {
			//clear shape
			//newShape.setMap(null);
			});
*/
	    newShape.setEditable(false);
	    });
		
		//AUTOCOMPLETE ADDRESS
		var address = (document.getElementById('address'));
		var autocomplete = new google.maps.places.Autocomplete(address);
		autocomplete.bindTo('bounds', map);
		google.maps.event.addListener(autocomplete, 'place_changed', function() {
		    address.className = '';
		    var place = autocomplete.getPlace();
		    if (!place.geometry) {
		      // Inform the user that the place was not found and return.
		      input.className = 'No se encontró la ubicación';
		      return;
		    }
		    // If the place has a geometry, then present it on a map.
		    if (place.geometry.viewport) {
		      map.fitBounds(place.geometry.viewport);
		    }else{
		      map.setCenter(place.geometry.location);
		      map.setZoom(17);
		    }
		});
		
		
		function filteredUrl(whatFor, _query) {
			var qSelect, qGroup, n;
			if (whatFor == 'singleUrl') {
				qSelect = "*";
			} else if (whatFor == 'totalCounter') {
				qSelect = "COUNT(*)";
			} else if (whatFor == 'groupCounter') {
				qSelect = table_name + ".post_cat, COUNT(*)";
				qGroup = " GROUP BY " + table_name + ".post_cat";
			}
			if (obj.ticket) n = "SELECT " + qSelect + " FROM " + table_name + " WHERE ticket = '" + obj.ticket + "'";
			if (obj.hasOwnProperty('filter')) {
				switch (obj.filter) {
				case 'vialidad':
					n = "SELECT " + qSelect + " FROM " + table_name + " WHERE (" + table_name + ".post_cat ilike '%ACCIDENTE%' OR " + table_name + ".post_cat ilike '%BACHE%' OR " + table_name + ".post_cat ilike '%OBRAS%' OR " + table_name + ".post_cat ilike '%SEMAFORO%')";
					break;
				case 'servicios':
					n = "SELECT " + qSelect + " FROM " + table_name + " WHERE (" + table_name + " .post_cat ilike '%ALCANTARILLA%' OR " + table_name + " .post_cat ilike '%ALUMBR%' OR " + table_name + " .post_cat ilike '%ELECTRICIDAD%' OR " + table_name + " .post_cat ilike '%FUGA%' OR " + table_name + " .post_cat ilike '%PARQUES%' OR " + table_name + " .post_cat ilike '%BASURA%')";
					break;
				case 'seguridad':
					n = "SELECT " + qSelect + " FROM " + table_name + "  WHERE (" + table_name + " .post_cat ilike '%INCENDIO%' OR " + table_name + " .post_cat ilike '%ROBO%' OR " + table_name + " .post_cat ilike '%RIESGO%')";
					break;
				case 'emergencias/':
					n = "SELECT " + qSelect + " FROM " + table_name + " WHERE (" + table_name + ".post_cat ilike '%EMERGENCIA%')";
					break;
				}
			}
			if (n && whatFor == 'groupCounter') {
				n += qGroup;
			}
			return n || _query;
		}		
		
		/* CHECK FOR ANY URL PARAMETERS*/
		var obj = getUrlVars();
		if (obj.table_name) table_name = obj.table_name;
		
		if ((obj.table_name && obj.ticket ) || obj.hasOwnProperty('filter')){
			var someUrl = true;
		}
		
		if (someUrl) _query = filteredUrl("singleUrl", _query);
		
		/* CARTO */
		var layerOptions = {
			query: _query,
			tile_style: _tile_style_cluster,
			interactivity: _interactivity
		};		
		cartodb.createLayer(map, layerUrl, layerOptions)
			.on('done', function(layer) {
				map.overlayMapTypes.setAt(0, layer);
				layers.push(layer);
				layer.on('featureClick', function(e, latlng, pos, data) {
		            if(layers[1]) layers[1].setInteraction(false);
		            setSelected(data);
		            getAgebInfo(data.cartodb_id);
		            var n="SELECT created_at,last_mod FROM "+table_name+" WHERE cartodb_id = " + data.cartodb_id;
					reportElements (n, layer, latlng);
				});
		        if (obj.ticket) {
					var rpos = "SELECT st_y(the_geom) as lat, st_x(the_geom) as lon, "+_interactivity+" FROM "+table_name+" WHERE ticket = '"+obj.ticket+"'";
					sql.execute(rpos).done(function(data) {
						var latit = data.rows[0].lat;
						var longit = data.rows[0].lon;
						var ticketLatlng = new google.maps.LatLng(latit, longit);
						map.setCenter(ticketLatlng);
						setSelected(data.rows[0]);
						var n = "SELECT created_at,last_mod FROM " + table_name + " WHERE cartodb_id = " + data.rows[0].cartodb_id;
						reportElements (n, layer, [latit, longit]);
					}).error(function(errors) {});
				}
			}).on('error', function() {window.location.reload();});
	    
		
		//CREATE AGEB LAYER
		var agebOptions = {
			query: "SELECT the_geom_webmercator FROM " + table_ageb,
			tile_style: "#{{table_name}}{polygon-opacity:0.0;}",
			interaction: false
		};
		
		cartodb.createLayer(map, agebLayerUrl, agebOptions)
			.on('done', function(layer) {
				map.overlayMapTypes.setAt(1, layer);
				layers.push(layer);
				agebClick();
			}).on('error', function() {window.location.reload();});
	      
		//TOTAL COUNTER
		var q = "SELECT COUNT(*) FROM " + table_name;
		if (someUrl) n = filteredUrl("totalCounter", q);
		else n = q;
		sql.execute(n).done(function(data) {
			$("#counterVal").val(addCommas(data.rows[0].count));
		}).error(function(errors) {});
		//PER CAT COUNTER
		q = "SELECT " + table_name + ".post_cat, COUNT (*) FROM " + table_name + " GROUP BY " + table_name + ".post_cat";
		if (someUrl) n = filteredUrl("groupCounter", q);
		else n = q;
		sql.execute(n).done(function(data) {
			updateCounters(data);
		}).error(function(errors) {});
	}
	
	///////////////////////////////////////////////
	//////////////END INIT FUNCTION////////////////
	///////////////////////////////////////////////

	/* ADDRESS BAR METHODS */
	function codeAddress() {
		  var address = document.getElementById('address').value;
		  geocoder.geocode( { 'address': address}, function(results, status) {
		    if (status == google.maps.GeocoderStatus.OK) {
		    	if (activeView == 'home'){
			      map.setCenter(results[0].geometry.location);
			      switch (results[0].geometry.location_type){
				      case 'ROOFTOP': map.setZoom(17); break;
				      case 'RANGE_INTERPOLATED': map.setZoom(16); break;
				      case 'GEOMETRIC_CENTER': map.setZoom(15); break;
				      case 'APPROXIMATE': map.setZoom(13); break;
			      }
		        } else {
			      map_T.setCenter(results[0].geometry.location)
			      switch (results[0].geometry.location_type){
				      case 'ROOFTOP': map_T.setZoom(17); break;
				      case 'RANGE_INTERPOLATED': map_T.setZoom(16); break;
				      case 'GEOMETRIC_CENTER': map_T.setZoom(15); break;
				      case 'APPROXIMATE': map_T.setZoom(13); break;  
		          }
		        }
		    } else {
		      alert('Geocode was not successful for the following reason: ' + status);
		    }
		  });
		}
	
	/* INFOWINDOW  + REPORT CONTENT HELPERS */  
    
	function getImg(category) {
		var cat = typeof category !== 'undefined' ? category : selectedCat;
		var img = false,
			img2 = false;
		if (document.getElementById("theImg")) img = true;
		if (document.getElementById("theImg2")) img2 = true;
		var src = "";
		for (var i = 0; i < catMarkers.length; i++) {
			if (cat === catMarkers[i][0]) {
				src = sourceurl + "cat/" + catMarkers[i][1];
				break;
			}
		}
		if (img) document.getElementById("theImg").src = src;
		if (img2) document.getElementById("theImg2").src = src;
		if (category) return src;
	}   
	function getAssets(assets){
    	var _asset = typeof assets !== 'undefined' ? assets : selectedAssets;
	    var src = '';
	    var assets = false;
	    if (document.getElementById("theAssets")) assets =true;
	    var assetsString = '';
	    if (_asset)
	    	if (_asset.search(/"/i) != -1){
	    	    assetsString = _asset.substring(_asset.search(/"/i)+1);
	    	    assetsString =  assetsString.substring(0,assetsString.search(/"/i));
	    	    if (assetsString.search(/citivox/i) != -1) return false;
	    	    else if  (assetsString.search(/http/i) != -1) src = assetsString;
	    	    else src = 'http://assets.' + accountURL + assetsString;
		    	if (assets){
		    		document.getElementById("assetID").href= src;
		    		document.getElementById("assetID").target = "_blank";
		    		document.getElementById("theAssets").width=200;
					document.getElementById("theAssets").height=200;
					document.getElementById("theAssets").src=src;
					
				}
	    	}
	    return src;
    }
    function setReportContent(){ // *** CHANGE TO WRITE HTML BEFORE CALL AS COMPONENT ONLY CHANGE CONTENT
    	  var days = 0;
	      if (selectedAddress.search(/null/i) != -1) selectedAddress = "No especificada, ver mapa";
	      
	      var execRep="<center><table><tbody>";
	       
	      /* HEADER ELEMENT */
	      execRep+="<tr bgcolor=\"F2F2F2\">";
	      execRep+="<td valign=\"top\" style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
  		  execRep+="<div style=\"max-width: 100px;max-height: 62px; margin-left:0px\"><img width=\"94\" height=\"94\" src=\""+getImg(selectedCat)+"\" class=\"attachment-thumbnail\"/></div>";
  		  execRep+="<div style=\"\"><div style=\"position: absolute;left: 158px;top: 28px;\"><a class=\"xcnr\">"+selectedTicket+"</a>";
		  
		  if (selectedStatus == "Abierto"){
        	execRep+="<a class=\"verificado2\" style=\"margin-top: 3;\">"+selectedStatus+"</a></div>";
        	execRep+="<div class=\"verticalLine\"></div>";
        	execRep+="<div style=\"position: absolute;right: 47px;top: 26px;font-size: 15px;\"><span class=\"icon-span\" style=\"float: left; margin-bottom:5px;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+selectedUUID+"')\"/> "+selectedVotes;
        	execRep+='<input type="button" value="" onclick="printContent(\'report-content\')" style="float: right;margin-right: 15px; background: url(images/icon-print.png) no-repeat; background-position: center;width: 22px;height: 22px; margin-bottom:9px;"/id="printBtn">';
        	execRep+="<div class=\"rating\" style=\"margin-top: 10;margin-left: 4; opacity:0.3;\">";
        	for (var j=4; j>=0;j--){
               execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" disabled><label for=\"star"+j+"\">"+j+" stars</label>";
            }
            execRep+="</div></div>";
          } else {
        	if (selectedFail) execRep+="<a class=\"verificado3\" style=\"margin-top: 3;\">"+selectedStatus+"</a></div>";
        	else execRep+="<a class=\"verificado\" style=\"margin-top: 3;\">"+selectedStatus+"</a></div>";
        	execRep+="<div class=\"verticalLine\"></div>";
        	execRep+="<div style=\"position: absolute;right: 47px;top: 26px;font-size: 15px;\"><span class=\"icon-span\" style=\"\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+selectedUUID+"')\"/> "+selectedVotes;
        	execRep+='<input type="button" value="" onclick="printContent(\'report-content\')" style="float: right;margin-right: 15px; background: url(images/icon-print.png) no-repeat; background-position: center;width: 22px;height: 22px;margin-bottom:9px;"/id="printBtn">';
            execRep+="<div class=\"rating\" style=\"margin-top: 10;margin-left: 10;\">";
            for (var j=4; j>=0;j--){
                if (selectedStars > j)
                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" checked=\"checked\" onclick=\"sendStars("+j+",'"+selectedUUID+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
                else
                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" onclick=\"sendStars("+j+",'"+selectedUUID+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
            }
            execRep+="</div></div>";
          }
          execRep+="</div>";
          
          /* HEADER-STATUS DETAIL ELEMENT FOR PUBLIC SERVICES*/
			if (isPublicService(selectedCat)) execRep += "<div style=\"height:30px; width:350px; margin-top:-3px; margin-left:-5px;\"><div style=\"min-width:120px; background-image:url(images/bg-status_cic.png);background-repeat: no-repeat; height: 36px;margin-left: 124px; color:#fff\"></div>";
			else execRep += "<div style=\"height:30px; width:350px; margin-top:-3px; margin-left:-5px;\"><div style=\"min-width:120px; background-image:url(images/bg-status_cic.png);background-repeat: no-repeat; height: 36px;margin-left: 124px; color:#fff\"></div>";
			if (selectedStatus == "Abierto") {
				days = Math.round((Date.today() - selectedCreate.getTime()) / (1000 * 60 * 60 * 24));
				if (days < 0) days = 0;
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px; top: 96px;\"> " + days + " días</h5></div>";
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_pend.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
			} else if (selectedFail) {
				days = Math.round((selectedUpdate.getTime() - selectedCreate.getTime()) / (1000 * 60 * 60 * 24));
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px;top: 96px;\"> " + days + " días</h5></div>";
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_fail.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
			} else {
				days = Math.round((selectedUpdate.getTime() - selectedCreate.getTime()) / (1000 * 60 * 60 * 24));
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_aut.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 189px; color:#fff\"><h5 style=\"font-size:12px; position: absolute;left: 265px;top: 96px;\"> " + days + " días</h5></div>";
				execRep += "<div style=\"min-width:120px; background-image:url(images/bg-status_succ.png);background-repeat: no-repeat; height: 36px; margin-top:-36px; margin-left: 271px; color:#fff\"></div>";
			}
			execRep += "</div>";
			execrep += "</td></tr>";
			          
          /* DETAILS ELEMENT */
		  execRep+="<tr bgcolor=\"F2F2F2\">";
		  execRep+="<td valign=\"top\"  style=\"max-width:350px;padding: 15px;vertical-align: top;text-align: left; border-radius: 2px;\">";
		  execRep+="<h5 style=\"text-align:left;font-size:12px;max-width:350px;margin-left: 3;\" >"+selectedTitle+"</h5>";
		  execRep+="<h5 style=\"font-size:11px;max-width:350px;margin-left: 3;\" class=\"direccion\">"+selectedAddress+"</h5>";
		  execRep+="<h5 style=\"font-size:11px;max-width:350px;margin-left: 3;\" class=\"calendario\">"+selectedCreate+"</h5>";
		  execRep+="<br><h3 class=\"reportsection\">Descripción</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\" >"+selectedContent+"</h3>";
		  if (selectedFollowup!='') execRep+="<br><h3 class=\"reportsection\">Seguimiento</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\">"+selectedFollowup+"</h3>";
		  if (selectedFollowupExt!='') execRep+="<br><h3 class=\"reportsection\">Seguimiento de Autoridad</h3><h3 style=\"text-align:left;font-size:11px;max-width:350px;margin-top:7px;\">"+selectedFollowupExt+"</h3>";
		  execrep+="</td></tr>";
		  
		  /* G STREET VIEW */
		  execRep+="<tr bgcolor=\"F2F2F2\" id='gSVsection'>";
		  execRep+="<td valign=\"top\"  style=\"max-width:350px;padding: 15px;vertical-align: top;text-align: left; border-radius: 2px;\">";
		  execRep+="<h3 class=\"reportsection\">Google Street View</h3><br>"
		  execRep+="<div id = 'gSV' style='position: relative; width: 350px;height: 300px;background-color: rgb(229, 227, 223,0)!important;overflow: hidden;-webkit-transform: translateZ(0px);margin-left: -14px;'></div>";
		  execrep+="</td></tr>";
		  
		  /* DISQUS ELEMENT */
		  execRep+="<tr bgcolor=\"F2F2F2\">";
		  execRep+="<td valign=\"top\"  style=\"max-width:350px;padding: 15px;vertical-align: top;text-align: left; border-radius: 2px;\">";
		  execRep+="<div id=\"disqus_thread\"></div>";
		  execrep+="</td></tr>";
		  execRep+="</table></center>";
          
          $( "#report-content" ).html(execRep);
  		  $( "#report-content" ).removeAttr('style').show('fold', {}, 400);
  		  
  		  DISQUS.reset({
			       reload: true,
			       config: function () {  
			         this.page.identifier = selectedTicket;
			         this.page.url = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name;
			         this.page.title = "Reporte de " + selectedCat + ", Ticket: " + selectedTicket;
			         this.language = "es_MX";
			       }
			     });
    }
    function getUrlVars(){
		    var vars = [], hash;
		    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
		    for(var i = 0; i < hashes.length; i++)
		    {
		        hash = hashes[i].split('=');
		        vars.push(hash[0]);
		        vars[hash[0]] = hash[1];
		        if (vars[hash[0]]) if (vars[hash[0]].search(/#/) != -1) vars[hash[0]]=vars[hash[0]].substr(0,vars[hash[0]].search(/#/));
		    }
		    return vars;
		}
    function isPublicService(cat){
	    for (var i=0; i < publicServices.length; i++){
		    if (cat == publicServices[i]) return true;
	    }
	    return false;
    }
	function sendStars(stars, uuid) {
		stars += 1;
		var _url = accountAPI + 'rate';
		var _data = '{"uuid":"' + uuid + '", "star":"' + stars + '"}';
		$('.body').css('cursor', 'progress');
		var request = $.ajax({
			url: _url,
			type: 'POST',
			contentType: 'application/json',
			data: _data,
			success: function(data, textStatus, jqXHR) {
				var n = "SELECT votes, stars FROM " + table_name + " WHERE uuid = '" + uuid + "'";
				sql.execute(n).done(function(data) {
					selectedStars = (data.rows[0].stars != 0) ? Math.round((data.rows[0].stars + stars) / 2) : stars;
					if (activeView == 'home') setReportContent();
					else setQ();
					$('body').css('cursor', 'auto');
				});
			},
			error: function(jqXHR, textStatus, errorThrown) {
				alert('Hubo un problema al procesar tu calificación, por favor carga de nuevo la página e intentalo otra vez.');
			}
		});
	}   
	function sendVote(uuid){
	    var _url = accountAPI+'vote';
	    var _data = '{"uuid":"'+uuid+'"}';
	    $('body').css('cursor','progress');
	    var request = $.ajax({
                url: _url,
                type: 'POST',
                contentType: 'application/json',
                data: _data,
                success: function(data, textStatus, jqXHR) {
                    var n="SELECT votes, stars FROM "+table_name+" WHERE uuid = '"+uuid+"'";
				    sql.execute(n).done(function(data) {
					    //console.log(data);
					    selectedVotes = data.rows[0].votes + 1;
					    if (activeView == 'home') setReportContent(); else setQ();
						$('body').css('cursor','auto');
				    });
                },
                error: function(jqXHR, textStatus, errorThrown) {
                    alert('Lo sentimos, hubo un problema y tu voto no ha sido procesado, por favor refresca la página e intenta de nuevo.');
                }});
	    
    }
    function printContent(divID) {
            //Get the HTML of div
            var divElements = document.getElementById(divID).innerHTML;
            //Get the HTML of whole page
            var oldPage = document.body.innerHTML;
            //Reset the page's HTML with div's HTML only
            var newBody = '<html><head><title></title></head><body><div class="reportslide" id="' +divID +'" style="display: block;">'+divElements + '</div></body>';
            document.body.innerHTML = newBody.replace("Versión de impresión","");
            document.getElementById('gSVsection').style.display = 'none';
            document.getElementById('disqus_thread').innerHTML='<center><div id="qrcode"></div></center>';
            document.getElementById('printBtn').style.display = 'none';
            
            var _url = window.location.href.split('?')[0] + '?ticket=' + selectedTicket + '&table_name=' + table_name +'&view=single';
            new QRCode(document.getElementById("qrcode"), _url,30,30);
            
            //Print Page
            window.print();

            //Restore orignal HTML
            window.open(_url,'_self');
        }
	function getgSV(latlong) {
		if (document.getElementById('gSV')) {
			panorama = new google.maps.StreetViewPanorama(document.getElementById('gSV'));
			var reportLoc = new google.maps.LatLng(latlong[0], latlong[1]);
			sv.getPanoramaByLocation(reportLoc, 50, function(data, status) {
				if (status == google.maps.StreetViewStatus.OK) {
					document.getElementById('gSVsection').style.display = 'block';
					var panoramaOptions = {
						linksControl: false,
						panControl: false,
						zoomControlOptions: {
							style: google.maps.ZoomControlStyle.SMALL
						},
						enableCloseButton: false
					};
					panorama.setOptions(panoramaOptions);
					panorama.setPano(data.location.pano);
					panorama.setPov({
						heading: 90,
						pitch: 0
					});
					var postCatIcon;
					for (var i = 0; i < catMarkers.length; i++) {
						if (selectedCat == catMarkers[i][0]) {
							postCatIcon = sourceurl + "map/" + catMarkers[i][1];
							break;
						}
					}
					var reportMarker = new google.maps.Marker({
						position: reportLoc,
						map: panorama,
						icon: postCatIcon,
						title: selectedCat,
						animation: google.maps.Animation.DROP
					});
					panorama.setVisible(true);;
				} else {
					panorama.setVisible(false);
					document.getElementById('gSVsection').style.display = 'none';
					console.log("AQUI NO HAY STREETVIEW PAPAGIORGIO");
				}
			});
		}
	}    
</script>


	<!-- INFOWINDOW TEMPLATES -->
		
		<!-- REPORT INFOWINDOW -->
	<script type="infowindow/html" id="infowindow_template">
	    <div class="cartodb-popup" id="infowindow" >
	      <a href="#close" class="cartodb-popup-close-button close" onclick="$('#report-content:visible').hide('fold', {}, 400);$('#ageb-content:visible').hide('clip', {}, 400);">x</a>
	       <div class="cartodb-popup-content-wrapper" >
	         <div class="cartodb-popup-header">
	         	<img id="theImg" src="images/favicon.ico" onload="getImg()" width="38px" height="38px" style="float:left;"><h3 style="float:right; width:140px; height:38px; text-align:left; color:#444; margin-top:5px;">{{content.data.post_cat}}</h3>
			 </div>
	         <div class="cartodb-popup-content" >
	          	<a id="assetID" href=""> <img id="theAssets" src="images/blank.png" onload="getAssets()" width="1" height="1"></>
	         </div>
	       </div>
	       <div class="cartodb-popup-tip-container" style="margin-top:-1px!important;"></div>
	    </div>
	</script>
	
		<!-- AGEB INFOWINDOW -->
	<script type="infowindow/html" id="infowindow_ageb">
	    <div class="cartodb-popup" id="infowindow_ag" >
	      <a href="#close" class="cartodb-popup-close-button close" onclick="$('#report-content:visible').hide('fold', {}, 400);$('#ageb-content:visible').hide('clip', {}, 400);">x</a>
	       <div class="cartodb-popup-content-wrapper" >
	         <div class="cartodb-popup-header">
	         	<h3 id="agebReportcount">Total de reportes: ...</h3>
			 </div>
	         <div class="cartodb-popup-content" >
	          	<img src="images/blank.png" onload="agebInfowindow()" width="1" height="1">
	         	<div id="agebReportDetail"></div>
	         </div>
	       </div>
	       <div class="cartodb-popup-tip-container" style="margin-top:-1px!important;"></div>
	    </div>
	</script>
	
	<!-- Chartbeat -->
	
	<script type="text/javascript">var _sf_startpt=(new Date()).getTime()</script> 


</head>
			<!--
			***********
			END OF HEAD
			***********
					-->
<body>
	<!-- ZENDESK BUTTON -->
	<script type="text/javascript" src="//assets.zendesk.com/external/zenbox/v2.5/zenbox.js"></script>
	
	<style type="text/css" media="screen, projection">
	  @import url(//assets.zendesk.com/external/zenbox/v2.5/zenbox.css);
	</style>
	
	<script type="text/javascript">
	  if (typeof(Zenbox) !== "undefined") {
	    Zenbox.init({
	      dropboxID:   "20097242",
	      url:         "https://centrodeintegracionciudadana.zendesk.com",
	      tabID:       "Sugerencias",
	      tabColor:    "#2E4F76",
	      tabPosition: "Right"
	    });
	  }
	</script>
    <a href="#" class="button" style="display:none;"></a>

<script type="text/javascript">
	  /* ONLOAD CONFIGURATIONS */
	  
	  //EXECUTE ON DOM READY
	  $(function() { //execute when DOM is ready
	  	BrowserDetect.init();
	  	$(window).load(function() { /* RAPTOR */
	  		
	  		$('.button').raptorize({
	  			'enterOn': 'konami-code'
	  		});
	  		
	  		$('#socialshare').share({
	  			networks: ['facebook', 'twitter', 'googleplus', 'email'],
	  			theme: 'square'
	  		});
	  		
	  		
	  		/*PUT*TO  
				if (window.addEventListener) {
				    var keys = [],
				        //code = "38,38,40,40,37,39,37,39,66,65"; //konami-code
				        code = "80,85,84,79"; 
				    window.addEventListener("keydown", function(e){
				        keys.push(e.keyCode);
				        if (keys.toString().indexOf(code) >= 0) {
				            alert("puto tú !");
				            keys = [];
				        };
				    }, true);
				};
			*/
	  		
	  	/* WORDLE */
	  		wordle = new WORDLEJS.Wordle(document.getElementById('wordle-container'));
	  	});
	  	
	  	/* LOADING SPINNER */
	  	var target = document.getElementById('map');
	  	var spinner = new Spinner(opts).spin(target); 
	  	
	  	/* LOWER FILTER MENU */
	    var auxSlide = "";	
		var sliderID;
		$('.dock-item2').click(function() {
			fade(auxSlide);
			console.log(this);
			switch ($(this).attr('id')) {
			case 'slide-cate':
				sliderID = "filtercate";
				break;
			case 'slide-date':
				sliderID = "filterdate";
				break;
			case 'slide-muni':
				sliderID = "filtermuni";
				break;
			case 'slide-stat':
				sliderID = "filterstat";
				break;
			case 'slide-dist':
				sliderID = "filterdist";
				break;
			}
			if ($("#" + sliderID).is(":visible")) {
				$("#" + sliderID).hide('fold', {}, 400);
				auxSlide = "";
			} else {
				$("#" + sliderID).show('fold', {}, 400);
				auxSlide = sliderID;
			}
			return false;
		});	  	
	  	
	  	/* CALENDAR */
	  	var t = new Date();
	  	var y = new Date();
	  	y.setDate(y.getDate() - 1);
	  	var tdy = t.toISOString();
	  	var ytrdy = y.toISOString();
	  	var todaydate = tdy.substring(0,tdy.search(/t/i));
	  	var yesterdaydate = ytrdy.substring(0,ytrdy.search(/t/i));
	  	document.getElementById('desde').value = yesterdaydate;
	  	document.getElementById('hasta').value = todaydate;
	  	
	  	desde = yesterdaydate;
	  	hasta = todaydate;
	  	
	  	//DATEPICKER DESDE
	  	$("#desde").datepicker({
	  		dateFormat: "yy-mm-dd",
	  		changeMonth: true,
	  		changeYear: true,
	  		numberOfMonths: 1,
	  		maxDate: todaydate,
	  		onSelect: function(selectedDate) {
	  			$("#hasta").datepicker("option", "minDate", selectedDate);
	  			desde = selectedDate;
	  			if (dates.calendario) setQ();
	  		}
	  	});
	  	//DATE PICKER HASTA
	  	$("#hasta").datepicker({
	  		dateFormat: "yy-mm-dd",
	  		changeMonth: true,
	  		changeYear: true,
	  		numberOfMonths: 1,
	  		minDate: desde,
	  		maxDate: todaydate,
	  		onSelect: function(selectedDate) {
	  			$("#desde").datepicker("option", "maxDate", selectedDate);
	  			hasta = selectedDate;
	  			if (dates.calendario) setQ();
	  		}
	  	});
	  	
	  	//SLIDER CONTROL ULTIMAS HORAS
	  	$("#slider-ulthoras").slider({
	  		range: "max",
	  		min: 1,
	  		max: 24,
	  		value: 3,
	  		slide: function(event, ui) {
	  			$("#amountUlthoras").val(ui.value);
	  			valUltHoras = ui.value;
	  		}
	  	});
	  	$("#amountUlthoras").val($("#slider-ulthoras").slider("value"));
	  	
	  	//SLIDER CONTROL HORARIO DE INTERES
	  	$("#slider-horasdeldia").slider({
	  		range: true,
	  		min: 0,
	  		max: 23,
	  		values: [firstTOD, secondTOD],
	  		slide: function(event, ui) {
	  			$("#amountHrsDia").val(ui.values[0] + " - " + ui.values[1]);
	  			queryhorasdeldia = "(date_part('hour', " + table_name + ".created_at at time zone '" + TZ + "')";
	  			if (ui.values[0] === ui.values[1]) {
	  				queryhorasdeldia = " = " + ui.values[0] + " )";
	  			} else {
	  				queryhorasdeldia = " BETWEEN " + ui.values[0] + " AND " + ui.values[1] + ")";
	  			}
	  		}
	  	});
	  	$("#amountHrsDia").val($("#slider-horasdeldia").slider("values", 0) + " - " + $("#slider-horasdeldia").slider("values", 1)); /* POLYGON */
	  	
	  	
	  	//SLIDER CONTROL RADIUS
	  	$("#slider-radius").slider({
	  		range: "max",
	  		min: 50,
	  		step: 50,
	  		max: 5000,
	  		value: 5000,
	  		slide: function(event, ui) {
	  			$("#radiusval").val(ui.value);
	  			radius.rad = ui.value;
	  			//map.setZoom(number);
	  		}
	  	});
	  	$("#radiusval").val($("#slider-radius").slider("value"));
	  	
	  	
	  	//SLIDER CONTROL CLOSE DISTANCE
	  	$("#slider-closedistance").slider({
	  		range: "max",
	  		min: 1,
	  		max: 100,
	  		value: 10,
	  		slide: function(event, ui) {
	  			$("#amountReports").val(ui.value);
	  			closeByReports = ui.value;
	  		}
	  	});
	  	$("#amountReports").val($("#slider-closedistance").slider("value"));
	  	
	  	//SLIDER CONTROL VOTOS
	  	$("#slider-voto").slider({
	  		range: "max",
	  		min: 0,
	  		max: 30,
	  		value: 0,
	  		slide: function(event, ui) {
	  			$("#amountvoto").val(ui.value);
	  			totalvotos = ui.value;
	  		}
	  	});
	  	$("#amountvoto").val($("#slider-voto").slider("value"));
	  	
	  	//SLIDER CONTROL STAR RATING
	  	$("#slider-star").slider({
	  		range: "max",
	  		min: 0,
	  		max: 5,
	  		value: 0,
	  		slide: function(event, ui) {
	  			$("#amountstar").val(ui.value);
	  			totalstar = ui.value;
	  		}
	  	});
	  	$("#amountstar").val($("#slider-star").slider("value")); /* CHARTS OPTIONS */
	  	
	  	//HIGHCHART LANGUAGE OPTIONS
	  	Highcharts.setOptions({
	  		lang: {
	  			months: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
	  			shortMonths: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun', 'Jul', 'Ago', 'Sep', 'Oct', 'Nov', 'Dic'],
	  			weekdays: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado']
	  		}
	  	});
	  	//CUSTOM DATE FORMAT TO SHOW WEEKS ON THE XAXIS FOR HIGHCHARTS
	  	Highcharts.dateFormats = {
	  		W: function(timestamp) {
	  			var date = new Date(timestamp),
	  				day = date.getUTCDay() == 0 ? 7 : date.getUTCDay(),
	  				dayNumber;
	  			date.setDate(date.getUTCDate() + 4 - day);
	  			dayNumber = Math.floor((date.getTime() - new Date(date.getUTCFullYear(), 0, 1, -6)) / 86400000);
	  			return 1 + Math.floor(dayNumber / 7);
	  		}
	  	}
	  	// JQUERY UI
	  	var icons = {
	  		header: "ui-icon-circle-arrow-e",
	  		activeHeader: "ui-icon-circle-arrow-s"
	  	};
	  	$("#accordion").accordion({
	  		collapsible: true,
	  		heightStyle: "content",
	  		active: false,
	  		disabled: true,
	  		icons: icons
	  	}).sortable({
	  		axis: "y",
	  		handle: "h3",
	  		stop: function(event, ui) {
	  			ui.item.children("h3").triggerHandler("focusout");
	  		}
	  	});
	  	// Switchers (of the Chart1 type) - onclick handler (column, area, line, spline, areaspline)
	  	$('.cicswitcher').click(function() {
	  		var newType = $(this).attr('id');
	  		if (activeView == 'score') ChangeChartType($('#chart0').highcharts().series, newType);
	  		if (activeView == 'stats') ChangeChartType($('#columnContainer').highcharts().series, newType);
	  	});
	  });
	  
	  /*					 **
	  **      HELPER 	     **
	  **      METHODS		 **
	  **					 */


	  /* METHODS TO SHOW AGEB SLIDER*/
	  function showAgebslide(){
		if($('#ageb-content').is(':visible')) {
		  $("#ageb-content").hide('clip', {}, 400);  
		}else{
		  $("#ageb-content").show('clip', {}, 400);  
		}
	  }
	  
	  /* METHODS TO UPDATE COUNTERS*/
	  function updateCounters(data) {
	  	for(var x in categories){
		  	if(!categories[x]) $("#counterVal_"+x).val(0);
	  	}
	  	for (var i = 0; i < data.total_rows; i++) {
	  		if (data.rows[i].post_cat == "AVISOS") $("#counterVal_avisos").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "MTYMUYBIEN") $("#counterVal_mtymuybien").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "EVENTO PUBLICO") $("#counterVal_eventos").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "OBSERVADOR CIUDADANO") $("#counterVal_observador").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "PROPUESTA COMUNIDAD") $("#counterVal_pcomunidad").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "PROPUESTA SEGURIDAD") $("#counterVal_pseguridad").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "PROPUESTA SERV PUBLICOS") $("#counterVal_pservicios").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "PROPUESTA VIALIDAD") $("#counterVal_pvialidad").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "INCENDIO") $("#counterVal_incendio").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "ROBO") $("#counterVal_robo").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "SITUACION DE RIESGO") $("#counterVal_sitriesgo").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "ACCIDENTE") $("#counterVal_accidente").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "BACHE O VIA DAÑADA") $("#counterVal_bache").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "OBRAS Y/O VIA CERRADA") $("#counterVal_obras").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "SEMAFORO DESCOMPUESTO") $("#counterVal_semaforo").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "ALCANTARILLAS") $("#counterVal_alcantarillas").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "ALUMBRADO PUBLICO") $("#counterVal_alumbrado").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "FALTA ELECTRICIDAD") $("#counterVal_electricidad").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "FUGA") $("#counterVal_fuga").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "PARQUES DESCUIDADOS") $("#counterVal_parques").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "RECOLECCION DE BASURA") $("#counterVal_basura").val(addCommas(data.rows[i].count));
	  		if (data.rows[i].post_cat == "EMERGENCIAS") $("#counterVal_emergencias").val(addCommas(data.rows[i].count));
	  	}
	  }
	  function addCommas(val) {
	  	while (/(\d+)(\d{3})/.test(val.toString())) {
	  		var val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
	  	}
	  	return val;
	  }	  
	  
	  /* METHODS FOR ACTIVE FILTERS*/
	  function updateActiveFilters() {
	  	var divCat = document.getElementById("activeF_Cat");
	  	var htmlCat = "";
	  	var divDat = document.getElementById("activeF_Dat");
	  	var htmlDat = "";
	  	var divMun = document.getElementById("activeF_Mun");
	  	var htmlMun = "";
	  	var divSta = document.getElementById("activeF_Sta");
	  	var htmlSta = "";
	  	var divDis = document.getElementById("activeF_Dis");
	  	var htmlDis = "";
	  	anyFilter = false;
	  	if (categories.avisos) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Avisos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.mtymuybien) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Mtymuybien\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.eventos) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Eventos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.observador) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Observador\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.pcomunidad) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"P Comunidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.pseguridad) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"P Seguridad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.pservicios) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"P Servicios\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.pvialidad) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"P Vialidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.incendio) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Incendio\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.robo) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Robo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.sitriesgo) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Sit Riesgo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.alcantarillas) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Alcantarilla\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.alumbrado) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Alumbrado\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.electricidad) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Electricidad\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.fuga) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Fuga\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.parques) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Parques\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.basura) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Basura\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.accidente) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Accidente\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.bache) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Baches\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.obras) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Obras\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.semaforo) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Semáforos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (categories.emergencias) {
	  		htmlCat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Emergencias\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.calendario) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Calendario\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.sietedias) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"7 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.quincedias) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"15 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.treintadias) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"30 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.noventadias) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"90 días\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.domingo) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Domingo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.lunes) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Lunes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.martes) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Martes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.miercoles) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Miércoles\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.jueves) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Jueves\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.viernes) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Viernes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.sabado) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Sábado\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.ulthoras) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Últimas hrs\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (dates.horasdeldia) {
	  		htmlDat += "<br><input type=\"text\" class=\"rangevalue\" value=\"Rango hrs\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.mty) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Monterrey\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.sp) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"San Pedro\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.sn) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"San Nicolás\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.sc) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Sta Catarina\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.gpe) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Guadalupe\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.apo) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Apodaca\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.esc) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Escobedo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.jua) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Juárez\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.gar) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"García\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.stg) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Santiago\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (mun.cad) {
	  		htmlMun += "<br><input type=\"text\" class=\"rangevalue\" value=\"Cadereyta\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repStatus.open) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"Abiertos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repStatus.closed) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"Cerrados\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repStatus.closed_fail) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"C. Fallo\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repDetail.voto) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"Votos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repDetail.star) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"Calificación\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (repDetail.asset) {
	  		htmlSta += "<br><input type=\"text\" class=\"rangevalue\" value=\"Imágenes\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (radius.set) {
	  		htmlDis += "<br><input type=\"text\" class=\"rangevalue\" value=\"Radio\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (polyfilter) {
	  		htmlDis += "<br><input type=\"text\" class=\"rangevalue\" value=\"Polígonos\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (closedistance) {
	  		htmlDis += "<br><input type=\"text\" class=\"rangevalue\" value=\"Ubicación\"style=\"width:auto; text-align:center; font-size:12px;\"disabled/>";
	  		anyFilter = true;
	  	}
	  	if (searchInput != "") anyFilter = true;
	  	/// UPDATE DIVS ACCORDINGLY /// 
	  	if (anyFilter) {
	  		divCat.innerHTML = "<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-categories.png\">	Categorías</h3></center>" + htmlCat;
	  		divDat.innerHTML = "<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-calendar.png\">	Fecha</h3></center>" + htmlDat;
	  		divMun.innerHTML = "<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-municip.png\">	Municipio</h3></center>" + htmlMun;
	  		divSta.innerHTML = "<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-lock.png\">	Detalle</h3> </center>" + htmlSta;
	  		divDis.innerHTML = "<center><h3><img style=\"vertical-align:text-top\" width=\"17\" height=\"17\" src=\"images/bt-polygon.png\">	Distancia</h3></center>" + htmlDis;
	  		$('.activeslide').css('opacity', '0.9');
	  		$('.activeslide').css('cursor', 'pointer');
	  	} else {
	  		$('.activeslide').css('opacity', '0.3');
	  		$('.activeslide').css('cursor', 'default');
	  	}
	  }	  
	  function resetFilters() {
			
			for (var a in categories) {
				categories[a] = false;
				$('#' + a).attr('checked', false);
			}
			for (var a in dates) {
				dates[a] = false;
				$('#' + a).attr('checked', false);
			}
			for (var a in mun) {
				mun[a] = false;
				$('#' + a).attr('checked', false);
			}
			for (var a in repStatus) {
				repStatus[a] = false;
				$('#' + a).attr('checked', false);
			}
			for (var a in repDetail) {
				repDetail[a] = false;
				$('#' + a).attr('checked', false);
			}
						
			choro=false;
			$('#ageb-choropleth').attr('checked', false);
		    $('#mun-legend-div').css('display', 'none');
		  	
		  	radius.set =false;
		    $('#radius').attr('checked', false);
		  	
		  	polyfilter = false;
		    $('#polyfilter').attr('checked', false);
		  	
		  	closedistance=false;
		    $('#closedistance').attr('checked', false);
		  	
			map.setZoom(11);
			execRepOffset=0;
			
			clearGeo();
			drawCircle();
			clearPolygons();
			
			setQ();
	  }
	  
	  /* METHODS TO HIDE FILTER SLIDE*/	
	  function fade(auxSlide){
			if (auxSlide == 'filtercate')$( "#filtercate:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterdate')$( "#filterdate:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filtermuni')$( "#filtermuni:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterstat')$( "#filterstat:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'filterdist')$( "#filterdist:visible" ).hide('fold', {}, 400);
			if (auxSlide == 'all'){
					$( "#filtercate:visible" ).hide('fold', {}, 400);
					$( "#filterdate:visible" ).hide('fold', {}, 400);
					$( "#filtermuni:visible" ).hide('fold', {}, 400);
					$( "#filterstat:visible" ).hide('fold', {}, 400);
					$( "#filterdist:visible" ).hide('fold', {}, 400);
					$( '#report-content:visible').hide('fold', {}, 400); 
					$( '#infowindow:visible').hide('fold', {}, 400);
					$( '#infowindow_ag:visible').hide('fold', {}, 400);
					$( '.activeslide:visible').hide('fold', {}, 400); 
					$( '.activesslide:visible').hide('fold', {}, 400);
					$( '.counterslide:visible').hide('fold', {}, 400);
					$( '#ageb-content').hide('clip', {}, 400);
			}
			if (auxSlide == 'showSlides'){
					$( '.activeslide:hidden').show('fold', {}, 400); 
					$( '.counterslide:hidden').show('fold', {}, 400);
					$( '#report-content:visible').hide('fold', {}, 400); 
					$( '#infowindow:visible').hide('fold', {}, 400);
					$( '#infowindow_ag:visible').hide('fold', {}, 400);
					$( "#filtercate:visible" ).hide('fold', {}, 400);
					$( "#filterdate:visible" ).hide('fold', {}, 400);
					$( "#filtermuni:visible" ).hide('fold', {}, 400);
					$( "#filterstat:visible" ).hide('fold', {}, 400);
					$( "#filterdist:visible" ).hide('fold', {}, 400);
					$('.activesslide').hide('fold', {}, 400);
					$('.countersslide').hide('fold', {}, 400);
					$( '#ageb-content').hide('clip', {}, 400);
			}
	  }
	  
	  /* METHODS FOR ADDITIONAL CATEGORIES FILTERING*/
	  function multipleCat(group, aux){
		  aux = typeof aux !== 'undefined' ? aux : true;
		  var q = true;
		  
		  switch (group){
			  case 'MUNICIPIO':
			        if (!mun.mty  || !mun.sp  || !mun.sn  || !mun.sc  || !mun.gpe  || !mun.apo  || !mun.esc  || !mun.jua  || !mun.gar  || !mun.cad  || !mun.stg) aux=true; else aux = false;
				  	for (var a in mun){
					  	mun[a]= aux;
					  	document.getElementById(a).checked = aux;
				  	}
		  	  break;
			  case 'COMUNIDAD':
			        if (!categories.avisos || !categories.eventos || !categories.observador || !categories.mtymuybien) aux=true; else aux = false;
			  		categories.avisos = aux;
					categories.eventos = aux;
					categories.observador = aux;
					categories.mtymuybien = aux;
					document.getElementById("avisos").checked =aux;
					document.getElementById("eventos").checked =aux;
					document.getElementById("observador").checked =aux;
					document.getElementById("mtymuybien").checked =aux;
			  break;
			  case 'PROPUESTAS CIUDADANAS':
			        if (!categories.pcomunidad || !categories.pseguridad || !categories.pservicios || !categories.pvialidad) aux=true; else aux = false;
			  		categories.pcomunidad = aux;
					categories.pseguridad = aux;
					categories.pservicios = aux;
					categories.pvialidad = aux;
					document.getElementById("pcomunidad").checked =aux;
					document.getElementById("pseguridad").checked =aux;
					document.getElementById("pservicios").checked =aux;
					document.getElementById("pvialidad").checked =aux;
			  break;
			  case 'SEGURIDAD':
			  		if (!categories.incendio || !categories.robo || !categories.sitriesgo) aux=true; else aux = false;
			  		categories.incendio = aux;
					categories.robo = aux;
					categories.sitriesgo = aux;
					document.getElementById("incendio").checked =aux;
					document.getElementById("robo").checked =aux;
					document.getElementById("sitriesgo").checked =aux;
			  break;
			  case 'SERVICIOS PUBLICOS':
			  		if (!categories.alcantarillas || !categories.alumbrado || !categories.electricidad || !categories.fuga || !categories.parques || !categories.basura) aux=true; else aux = false;
			  		categories.alcantarillas = aux;
					categories.alumbrado = aux;
					categories.electricidad = aux;
					categories.fuga = aux;
					categories.parques = aux;
					categories.basura = aux;
					document.getElementById("alcantarillas").checked =aux;
					document.getElementById("alumbrado").checked =aux;
					document.getElementById("electricidad").checked =aux;
					document.getElementById("fuga").checked =aux;
					document.getElementById("parques").checked =aux;
					document.getElementById("basura").checked =aux;
			  break;
			  case 'VIALIDAD Y TRANSITO':
			  		if (!categories.accidente || !categories.bache || !categories.obras || !categories.semaforo) aux=true; else aux = false;
			  		categories.accidente = aux;
					categories.bache = aux;
					categories.obras = aux;
					categories.semaforo = aux;
					document.getElementById("accidente").checked =aux;
					document.getElementById("bache").checked =aux;
					document.getElementById("obras").checked =aux;
					document.getElementById("semaforo").checked =aux;
			  break;
			  case 'EMERGENCIAS':
			  		if (!categories.emergencias) aux=true; else aux = false;
			  		categories.emergencias = aux;
			  		document.getElementById("emergencias").checked =aux;
			  break;
			  case 'all':
				  	for (var a in categories){
					  categories[a]= aux;
					  document.getElementById(a).checked = aux;
				  	}			  		
/*
			  		categories.avisos = aux;
					categories.eventos = aux;
					categories.observador = aux;
					categories.mtymuybien = aux;
					document.getElementById("avisos").checked =aux;
					document.getElementById("eventos").checked =aux;
					document.getElementById("observador").checked =aux;
					document.getElementById("mtymuybien").checked =aux;
					categories.pcomunidad = aux;
					categories.pseguridad = aux;
					categories.pservicios = aux;
					categories.pvialidad = aux;
					document.getElementById("pcomunidad").checked =aux;
					document.getElementById("pseguridad").checked =aux;
					document.getElementById("pservicios").checked =aux;
					document.getElementById("pvialidad").checked =aux;
					categories.incendio = aux;
					categories.robo = aux;
					categories.sitriesgo = aux;
					document.getElementById("incendio").checked =aux;
					document.getElementById("robo").checked =aux;
					document.getElementById("sitriesgo").checked =aux;
					categories.alcantarillas = aux;
					categories.alumbrado = aux;
					categories.electricidad = aux;
					categories.fuga = aux;
					categories.parques = aux;
					categories.basura = aux;
					document.getElementById("alcantarillas").checked =aux;
					document.getElementById("alumbrado").checked =aux;
					document.getElementById("electricidad").checked =aux;
					document.getElementById("fuga").checked =aux;
					document.getElementById("parques").checked =aux;
					document.getElementById("basura").checked =aux;
					categories.accidente = aux;
					categories.bache = aux;
					categories.obras = aux;
					categories.semaforo = aux;
					document.getElementById("accidente").checked =aux;
					document.getElementById("bache").checked =aux;
					document.getElementById("obras").checked =aux;
					document.getElementById("semaforo").checked =aux;
					categories.emergencias = aux;
			  		document.getElementById("emergencias").checked =aux;
*/
			  		q=false;
			  break;
		  }
		  if (q) setQ();
	  }
	  function filterFromStat(cat){
		  switch (cat){
		  	  case 'MTYMUYBIEN': multipleCat('all',false); categories.mtymuybien =true; $('#mtymuybien').attr('checked', true); ;break;
		  	  case 'ACCIDENTE': multipleCat('all',false); categories.accidente =true; $('#accidente').attr('checked', true); ;break;
		  	  case 'ALCANTARILLAS': multipleCat('all',false); categories.alcantarillas =true; $('#alcantarillas').attr('checked', true); ;break;
		  	  case 'ALUMBRADO PUBLICO': multipleCat('all',false); categories.alumbrado =true; $('#alumbrado').attr('checked', true); ;break;
		  	  case 'AVISOS': multipleCat('all',false); categories.avisos =true; $('#avisos').attr('checked', true); ;break;
		  	  case 'BACHE O VIA DAÑADA': multipleCat('all',false); categories.bache =true; $('#bache').attr('checked', true); ;break;
		  	  case 'EMERGENCIAS': multipleCat('all',false); categories.emergencias =true; $('#emergencias').attr('checked', true); ;break;
		  	  case 'EVENTO PUBLICO': multipleCat('all',false); categories.eventos =true; $('#eventos').attr('checked', true); ;break;
		  	  
		  	  case 'FALTA ELECTRICIDAD': multipleCat('all',false); categories.electricidad =true; $('#electricidad').attr('checked', true); ;break;
		  	  case 'FUGA': multipleCat('all',false); categories.fuga =true; $('#fuga').attr('checked', true); ;break;
		  	  case 'INCENDIO': multipleCat('all',false); categories.incendio =true; $('#incendio').attr('checked', true); ;break;
		  	  case 'OBRAS Y/O VIA CERRADA': multipleCat('all',false); categories.obras =true; $('#obras').attr('checked', true); ;break;
		  	  case 'OBSERVADOR CIUDADANO': multipleCat('all',false); categories.observador =true; $('#observador').attr('checked', true); ;break;
		  	  case 'PARQUES DESCUIDADOS': multipleCat('all',false); categories.parques =true; $('#parques').attr('checked', true); ;break;
		  	  case 'PROPUESTA COMUNIDAD': multipleCat('all',false); categories.pcomunidad =true; $('#pcomunidad').attr('checked', true); ;break;
		  	  
		  	  case 'PROPUESTA SEGURIDAD': multipleCat('all',false); categories.pseguridad =true; $('#pseguridad').attr('checked', true); ;break;
		  	  case 'PROPUESTA SERV PUBLICOS': multipleCat('all',false); categories.pservicios =true; $('#pservicios').attr('checked', true); ;break;
		  	  case 'PROPUESTA VIALIDAD': multipleCat('all',false); categories.pvialidad =true; $('#pvialidad').attr('checked', true); ;break;
		  	  case 'RECOLECCION DE BASURA': multipleCat('all',false); categories.basura =true; $('#basura').attr('checked', true); ;break;
		  	  case 'ROBO': multipleCat('all',false); categories.robo =true; $('#robo').attr('checked', true); ;break;
		  	  case 'SEMAFORO DESCOMPUESTO': multipleCat('all',false); categories.semaforo =true; $('#semaforo').attr('checked', true); ;break;
		  	  case 'SITUACION DE RIESGO': multipleCat('all',false); categories.sitriesgo =true; $('#sitriesgo').attr('checked', true); ;break;	
			  default:break;
		  }
		  setQ();
	  }
	  
	  /* METHODS FOR QUERYING BY DISTANCE */
	  function drawCircle() {
		    if (overlay) overlay.setMap(null);
		    if (overlay_T) overlay_T.setMap(null);
		    if (radius.set) {
		        overlay = new google.maps.Circle({
		            map: map,
		            center: new google.maps.LatLng(radius.lat, radius.lng),
		            radius: radius.rad,
		            strokeColor: "#0000ff",
		            strokeOpacity: 0.60,
		            strokeWeight: 2,
		            fillColor: "#0000ff",
		            fillOpacity: 0.150,
		        });
		        if (map_T != null){
			        overlay_T = new google.maps.Circle({
			            map: map_T,
			            center: new google.maps.LatLng(radius.lat, radius.lng),
			            radius: radius.rad,
			            strokeColor: "#0000ff",
			            strokeOpacity: 0.60,
			            strokeWeight: 2,
			            fillColor: "#0000ff",
			            fillOpacity: 0.150,
			        });
		        }
		    }
		}
	  function updateRadDeg(dist) {
		    var deg = 180,
		        brng = deg * Math.PI / 180,
		        dist = dist / 6371000,
		        lat1 = radius.lat * Math.PI / 180,
		        lon1 = radius.lng * Math.PI / 180;
		
		    var lat2 = Math.asin(Math.sin(lat1) * Math.cos(dist) + Math.cos(lat1) * Math.sin(dist) * Math.cos(brng));
		
		    var lon2 = lon1 + Math.atan2(Math.sin(brng) * Math.sin(dist) * Math.cos(lat1), Math.cos(dist) - Math.sin(lat1) * Math.sin(lat2));
		
		    if (isNaN(lat2) || isNaN(lon2)) return null;
		
		    radDeg = radius.lat - (lat2 * 180 / Math.PI);
	  }
	  function updateBounds() {
	  	var bounds = new google.maps.LatLngBounds();
	  	var myLatLng = new google.maps.LatLng(radius.lat, radius.lng);
	  	bounds.extend(myLatLng);
	  	myLatLng = new google.maps.LatLng(radius.lat + 0.01 * radius.rad / 1000, radius.lng + 0.01 * radius.rad / 1000);
	  	bounds.extend(myLatLng);
	  	myLatLng = new google.maps.LatLng(radius.lat - 0.01 * radius.rad / 1000, radius.lng - 0.01 * radius.rad / 1000);
	  	bounds.extend(myLatLng);
	  	map.fitBounds(bounds);
	  }
	  function clearPolygons(){
	      drawingManager.setOptions({drawingControl: false});
		  for (i=0;i<shapesArray.length;i++){
		        shapesArray[i].setMap(null);
				}
				shapesArray=[]; 
	  }
	  function takePolygons() {
	  	if (radius.set) {
	  		drawCircle();
	  	}
	  	if (polyfilter) {
	  		if (activeView == 'torque') {
	  			drawingManager.setMap(map_T);
	  			if (shapesArray.length > 0) {
	  				for (i = 0; i < shapesArray.length; i++) {
	  					shapesArray[i].setMap(map_T);
	  				}
	  			}
	  		} else {
	  			drawingManager.setMap(map);
	  			if (shapesArray.length > 0) {
	  				for (i = 0; i < shapesArray.length; i++) {
	  					shapesArray[i].setMap(map);
	  				}
	  			}
	  		}
	  	}
	  }
	  function detectUserLocation() {
	  	if (navigator.geolocation) {
	  		var timeoutVal = 10 * 1000 * 1000;
	  		watchID = navigator.geolocation.watchPosition(
	  		mapToPosition, alertError, {
	  			enableHighAccuracy: true,
	  			timeout: timeoutVal,
	  			maximumAge: 0
	  		});
	  	} else {
	  		alert("Geolocation is not supported by this browser");
	  	}
	  	function alertError(error) {
	  		var errors = {
	  			1: 'Permission denied',
	  			2: 'Position unavailable',
	  			3: 'Request timeout'
	  		};
	  		alert("Error: " + errors[error.code]);
	  	}
	  }	  
	  function mapToPosition(position){
	    myLon = position.coords.longitude;
	    myLat = position.coords.latitude;
	    console.log("lon "+myLon);
	    console.log("lat "+myLat);
        var myLatlng = new google.maps.LatLng(myLat, myLon);
        map.setCenter(myLatlng);
        map.setZoom(17);
        if (gmarker == null){
        	gmarker = new google.maps.Marker({
				animation: google.maps.Animation.DROP,
				/* icon: 'images/bt-mapmarker.png', */
				position: myLatlng,
				map: map,
			});
		}else{
			gmarker.setPosition(myLatlng);
		}
		//POSITIONS DETECTED WHILE GEO-LOC ENABLED
		gmarkers.push(gmarker);
		setQ();
	  }
	  function clearGeo() {
	  	navigator.geolocation.clearWatch(watchID);
	  	for (i = 0; i < gmarkers.length; i++) {
	  		gmarkers[i].setMap(null);
	  	}
	  	gmarkers = [];
	  	gmarker = null;
	  	//map.setZoom(11);			
	  }	  
	  function clearDistance(dist) {
			switch (dist) {
			case "close":
				radius.set = false;
				document.getElementById('radius').checked = false;
				polyfilter = false;
				document.getElementById('polyfilter').checked = false;
				drawCircle();
				clearPolygons();
				break;
			case "rad":
				closedistance = false;
				document.getElementById('closedistance').checked = false;
				polyfilter = false;
				document.getElementById('polyfilter').checked = false;
				clearGeo();
				clearPolygons();
				break;
			case "poly":
				closedistance = false;
				document.getElementById('closedistance').checked = false;
				radius.set = false;
				document.getElementById('radius').checked = false;
				clearGeo();
				drawCircle();
				break;
			default:
				break;
			}
		}	  
	  /* METHOD FOR DATE AND TIME FILTERING */
	  function clearDates(date) {
	  	//array contains HTML IDs which toggle between each other 
	  	var array = ["calendario", "sietedias", "quincedias", "treintadias", "noventadias", "ulthoras"];
	  	var index = array.indexOf(date);
	  	if (index > -1) {
	  		var pushBack = array[index];
	  		array.splice(index, 1);
	  		for (var i = 0, j = array.length; i < j; i++) {
	  			dates[array[i]] = false;
	  			document.getElementById(array[i]).checked = false;
	  		}
	  		array.push(pushBack);
	  	}
	  }	  	  
	  /* METHOD FOR WORDLE WORD CLICK ACTION*/
	  function wordClick(text){
		  	searchInput = text;
		  	changeView('home');
		  	setTimeout(function () {
		  		$('.searchMeme-input-right input').val(text); 
		  		$('.searchMeme-input-right input').css({ 'margin-left': 0, paddingLeft: 3, paddingRight: 3 });
		  		$('.searchMeme-input-right input').animate({ marginLeft: 0, paddingLeft: 3, paddingRight: 3 });
		  	}, 1000);
	  }
	  
	  /* METHODS FOR DRAWING CO-OCCURRENCE*/
	  function drawTiles() {
	  	var calcs = _getCalcs(),
	  		range = [];
	  	for (var i = 1; i <= buckets; i++) {
	  		range.push(i);
	  	}
	  	var bucket = d3.scale.quantize().domain([0, calcs.max > 0 ? calcs.max : 1]).range(range),
	  		side = d3.select('#tiles').attr('class');
	  	if (side === 'front') {
	  		side = 'back';
	  	} else {
	  		side = 'front';
	  	}
	  	for (var d = 0; d < formattedData.length; d++) {
	  		for (var h = 0; h < formattedData[d].length; h++) {
	  			var sel = '#d' + d + 'h' + h + ' .tile .' + side,
	  				val = formattedData[d][h];
	  			// erase all previous bucket designations on this cell
	  			for (var i = 1; i <= buckets; i++) {
	  				var cls = 'q' + i + '-' + buckets;
	  				d3.select(sel).classed(cls, false);
	  			}
	  			// set new bucket designation for this cell
	  			var cls = 'q' + (val > 0 ? bucket(val) : 0) + '-' + buckets;
	  			d3.select(sel).classed(cls, true);
	  		}
	  	}
	  	flipTiles();
	  	_drawHourlyChart(-1);
	  }	  
	  function _getCalcs() {
	  	var min = 1,
	  		max = -1;
	  	// calculate min + max
	  	for (var d = 0; d < formattedData.length; d++) {
	  		for (var h = 0; h < formattedData[d].length; h++) {
	  			var tot = formattedData[d][h];
	  			if (tot > max) {
	  				max = tot;
	  			}
	  			if (tot < min) {
	  				min = tot;
	  			}
	  		}
	  	}
	  	return {
	  		'min': min,
	  		'max': max
	  	};
	  }
	  function _drawHourlyChart(day) {
	
			d3.selectAll('#hourly_values svg').remove();
			
			var w = 1000,
				h = 150;
			
			var weeklyData = new Array(24);
			for (var x=0; x<24; x++){
				weeklyData[x] = 0;
			}
			if (day != -1)
				weeklyData = formattedData[day];
			else
				for (var x=0;x<7;x++){
					for (var y=0; y<24;y++)
						weeklyData[y] += formattedData[x][y];
				}
							
			var y = d3.scale.linear()
				.domain([0, d3.max(weeklyData, function(d) { return d })])
				.range([0, h]);
		
			
			var chartOccu = d3.select('#hourly_values .svg')
				.append('svg:svg')
				.attr('class', 'chartOccu')
				.attr('width', 1000)
				.attr('height', 170);
				
			var rect = chartOccu.selectAll('rect'),
				text = chartOccu.selectAll('text');
			
			rect.data(weeklyData)
				.enter()
					.append('svg:rect')
						.attr('x', function(d, i) { return i * 42; })
						.attr('y', function(d) { return h - y(d) })
						.attr('height', function(d) { return y(d)})
						.attr('width', 37)
						.attr('class', function(d, i) { return 'hr' + i});
			
			text.data(hours)
				.enter()
					.append('svg:text')
						.attr('class', function(d, i) { return (i % 3) ? 'hidden hr' + i : 'visible hr' + i })
						.attr("x", function(d, i) { return i * 42 })
						.attr("y", 166)
						.attr("text-anchor", 'left')
						.text(String);
	  }
	  function flipTiles() {

		var oldSide = d3.select('#tiles').attr('class'),
			newSide = '';
		
		if (oldSide == 'front') {
			newSide = 'back';
		} else {
			newSide = 'front';
		}
		
		var flipper = function(h, d, side) {
			return function() {
				var sel = '#d' + d + 'h' + h + ' .tile',
					rotateY = 'rotateY(180deg)';
				
				if (side === 'back') {
					rotateY = 'rotateY(0deg)';	
				}
				
				d3.select(sel).style('-webkit-transform', rotateY);
			};
		};
		
		for (var h = 0; h < hours.length; h++) {
			for (var d = 0; d < days.length; d++) {
				var side = d3.select('#tiles').attr('class');
				setTimeout(flipper(h, d, side), (h * 20) + (d * 20) + (Math.random() * 100));
			}
		}
		d3.select('#tiles').attr('class', newSide);
	}
	  function createTiles() {
		
			var html = '<table id="tiles" class="front">';
		
			html += '<tr><th><div>&nbsp;</div></th>';
		
			for (var h = 0; h < hours.length; h++) {
				html += '<th class="h' + h + '">' + hours[h] + '</th>';
			}
			
			html += '</tr>';
		
			for (var d = 0; d < days.length; d++) {
				html += '<tr class="d' + d + '">';
				html += '<th>' + days[d].abbr + '</th>';
				for (var h = 0; h < hours.length; h++) {
					html += '<td id="d' + d + 'h' + h + '" class="d' + d + ' h' + h + '"><div class="tile"><div class="face front"></div><div class="face back"></div></div></td>';
				}
				html += '</tr>';
			}
			
			html += '</table>';
			d3.select('#vis').html(html);
		}
	  function selectHourlyChartBar(hour) {

		d3.selectAll('#hourly_values .chartOccu rect').classed('sel', false);
		d3.selectAll('#hourly_values .chartOccu rect.hr' + hour).classed('sel', true);
		d3.selectAll('#hourly_values .chartOccu text').classed('hidden', true);
		d3.selectAll('#hourly_values .chartOccu text.hr' + hour).classed('hidden', false);
	
	}
	  
	/* METHODS FOR DRAWING SCORE CHARTS*/
	   	
	   	
	   	/*DRAW SCORE FOR CATS */
	  function drawScore(score,status,origin){
	  		var promSPmun = {};
	  		var promSPcat = {};
	  		var promSPcatdiv = {};
	  		var promcatarray = [];
	  		var contcat=0;
	  		var promOb = new Object();
				promOb['type'] = 'spline';
				promOb['name'] = 'DIAS PROMEDIO'; 
				promOb['visible'] = false;
				promOb['marker'] = {lineWidth: 4,
		         				 	lineColor: Highcharts.getOptions().colors[3],
				 				 	fillColor: 'white'};
				 				 	

			//INIT DIVISORS FOR AVG PER CAT
			for (var mun in score){
				for (var cat in score[mun]){
					promSPcatdiv[cat]=0;
				}
			}
			//CONSTRUCT ARRAYS FOR EVERY MUN WITH CAT DATA
	  		for (var mun in score){
				var data = [];
				var suma = 0;
				var cont = 0;
				for (var cat in score[mun]){
						data.push(score[mun][cat]);
						suma +=score[mun][cat];
						if(score[mun][cat] != 0) 
							{ cont++; }
						if(contcat==0){
							promSPcat[cat] = score[mun][cat];
							if(score[mun][cat] != 0){promSPcatdiv[cat]+=1;}
						}else{
							promSPcat[cat] += score[mun][cat];
							if(score[mun][cat] != 0){promSPcatdiv[cat]+=1;}	
						}
				}
				contcat++;
				if(cont == 0) promSPmun[mun] = 0; 
				else promSPmun[mun] = Math.round(suma/cont);
				var series = new Object();
				series['data']= data;
				series['name']= getFullName(mun);
			 	$('#chart0').highcharts().addSeries(series);
			}
			//GET AVG FOR EVERY CAT
			for (var cat in promSPcat){
				promcatarray.push(Math.round(promSPcat[cat]/promSPcatdiv[cat]));
			}
			promOb['data'] = promcatarray;
			$('#chart0').highcharts().addSeries(promOb);
			$('#chart0').highcharts().hideLoading();
			
			
			//DRAW INDIVIDUAL PLOTS FOR EVERY MUN
			for (var mun in score) plotCounty(status,origin,mun);
			fillSummary(effectPercent,promSPmun);
			$("#accordion").accordion({disabled: false});
			$('.ui-accordion .ui-accordion-header').css("opacity", "1");			
	  }
	  
	  //DRAW IND CHARTS FOR MUN
	  function plotCounty(status, origin, mun) {
			var datalabel = true;
			var datapie = [];
			var datawfall = [];
			var total_mun=0;
			var cerrados= 0;
			var cerradosfail= 0;
			var abiertos = 0;
			var dataDonArr = [];
			var datapieArr = [];
			var colors = Highcharts.getOptions().colors;
			
			//SERIES FOR PIE & DONUT
			for (var cat in status[mun]){
					var total =0;
					for (var stat in status[mun][cat]){
						total += status[mun][cat][stat];
						var dataDonObj = new Object;
						if(stat == 'cerrado'){
							var brightness = 0.2;
							cerrados += status[mun][cat][stat];
							dataDonObj['name']= 'Cerrados';
							dataDonObj['y']= status[mun][cat][stat];
							dataDonObj['color']= "#5FB240";
							/* dataDonObj['color']= Highcharts.Color(colors[datapieArr.length]).brighten(brightness).get(); */
							dataDonArr.push(dataDonObj);
						}else if(stat == 'fallo'){
							var brightness = 0.17;
							cerradosfail += status[mun][cat][stat];
							dataDonObj['name']= 'Cerrados con fallo';
							dataDonObj['y']= status[mun][cat][stat];
							dataDonObj['color']= "#FF0000";
							/* dataDonObj['color']= Highcharts.Color(colors[datapieArr.length]).brighten(brightness).get(); */
							dataDonArr.push(dataDonObj);
						}else if (stat == 'abierto'){
							var brightness = 0.14;
							abiertos += status[mun][cat][stat];
							dataDonObj['name']= 'Abiertos';
							dataDonObj['y']= status[mun][cat][stat];
							dataDonObj['color']= "#FE8319";
							/* dataDonObj['color']= Highcharts.Color(colors[datapieArr.length]).brighten(brightness).get(); */
							dataDonArr.push(dataDonObj);
						}
					}
					total_mun += total;
					datapie.push([cat,total]);
					var datapieObj = new Object;
					datapieObj['name']=cat;
					datapieObj['y']=total;
					datapieObj['color'] = colors[datapieArr.length];
					datapieArr.push(datapieObj);
			}
			effectPercent[mun]= Math.round(((cerrados)/(cerrados+cerradosfail))*100);
			if(isNaN(effectPercent[mun])) {
				effectPercent[mun] = 0;
			}
			
			var chartID = 'chart'+mun;
			var county = getFullName(mun);
			if (total_mun == 0) {datalabel = false;}
			chart2 = new Highcharts.Chart({
					chart: {
							renderTo: chartID+'2',
							height: 350,
							backgroundColor: {
						       linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
						       stops: [ [0, 'rgb(255, 255, 255)'], [1, 'rgb(240, 240, 255)'] ]
						    },
					        borderWidth: 2,
					        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
					        plotShadow: true,
					        plotBorderWidth: 1
					},
					title: {
						text: county + ' (Últimos 90 días)'
					},
					subtitle: {
						text: 'Vía del Reporte (Total de Reportes: ' + total_mun + ')'
					},
					tooltip: {
						formatter: function() {
							return '<b style="color: {series.color}">' + this.point.name + '</b>: ' + this.y + ' (' + Math.round(this.percentage) + ' %)';
						}
					},
					loading:   {
					                    style: {
					                        fontSize: '40px',
					                        opacity: .75
					                    },
					                    labelStyle: {
					                        top: '45%'
					                    }
			        },
					plotOptions: {
						pie: {
								allowPointSelect: true,
								cursor: 'pointer',
								dataLabels: {
									enabled: false,
									color: '#000000',
									connectorColor: '#000000',
									formatter: function() {
										return '<b>' + this.point.percentage;
									}
								},
								showInLegend: datalabel
						}
					},
					series: [{
						type: 'pie',
						name: 'Reportes',
						data: [	['Redes Sociales', origin[mun].Twitter],
								['Sitio Web', origin[mun].URI],
								['Tehuan APP', origin[mun].Ushahidi],
								['CIC CRM', origin[mun].CRM],
								['Email', origin[mun].MAIL],
								['SMS', origin[mun].SMS]
							  ]
					}]
		});
			
		 chart1 = new Highcharts.Chart({
					chart: {
							type: 'pie',
							renderTo: chartID+'1',
							height: 350,
							backgroundColor: {
						       linearGradient: { x1: 0, y1: 0, x2: 1, y2: 1 },
						         stops: [ [0, 'rgb(255, 255, 255)'], [1, 'rgb(240, 240, 255)'] ]
						    },
					        borderWidth: 2,
					        plotBackgroundColor: 'rgba(255, 255, 255, .9)',
					        plotShadow: true,
					        plotBorderWidth: 1
					},
					title: {
						text: county + ' (Últimos 90 días)'
					},
					subtitle: {
						text: 'Flujo de Reportes por Categoría (Total de Reportes: ' + total_mun + ')'
					},
					tooltip: {
						formatter: function() {
							return '<b style="color: {series.color}">' + this.point.name + '</b>: ' + this.y + ' (' + Math.round(this.percentage) + ' %)';
						}
					},
					loading:   {
					                    style: {
					                        fontSize: '40px',
					                        opacity: .75
					                    },
					                    labelStyle: {
					                        top: '45%'
					                    }
			        },
					plotOptions: {
						pie: {
							allowPointSelect: true,
							cursor: 'pointer',
							dataLabels: {
								enabled: true,
								color: '#000000',
								connectorColor: '#000000',
								formatter: function() {
									return '<b>' + this.point.percentage;
								}
							},
/* 							showInLegend: datalabel */
						}
					},
					series: [{
		                name: 'Categoria',
		                data: datapieArr,
		                size: '60%',
		                dataLabels: {
		                    formatter: function() {
		                        return this.y > 0 ? this.point.name : null;
		                    },
		                    distance: 50
		                }
		            }, {
		                name: 'Estado',
		                data: dataDonArr,
		                size: '80%',
		                innerSize: '70%',
		                dataLabels: {
		                    formatter: function() {
		                        // display only if larger than 1
		                        return null;
		                    }
		                }
		            }]
		});
			
			if (total_mun == 0){
				chart1.showLoading('No hay información del Municipio Seleccionado');
				chart2.showLoading('No hay información del Municipio Seleccionado');
			}
}
	  function fillSummary(effectPercent,promSPmun){
			var html="";
			html+= '<table border="1" bordercolor="#163D74" style="background-color:#FFF" width="100%" cellpadding="3" cellspacing="3">';
			html+= '<tr style="background-color:#163D74; color: #FFF;" align="center" valign="middle" ><td>Municipio</td><td>Tiempo promedio de resolución en días</td><td>Porcentaje de resolución exitosa</td></tr>';
			for (var mun in effectPercent){
			   if (promSPmun[mun] != 0)
			   	html+= '<tr align="center" valign="middle" style="background-color:#FFF; color: #163D74;"><td>'+ getFullName(mun) +'</td><td>'+ promSPmun[mun] +'</td><td>'+ effectPercent[mun] +' %</td></tr>';
			   else
			   	html+= '<tr align="center" valign="middle" style="background-color:#FFF; color: #163D74;"><td>'+ getFullName(mun) +'</td><td>'+ 'N/A' +'</td><td>'+ 'N/A' +'</td></tr>';
			}
			html+='</table>';
			document.getElementById('chartRC').innerHTML=html;
	  }
	  function ChangeChartType(series, newType) {
			newType = newType.toLowerCase();
			for (var i = 0; i < series.length; i++) {
				if (newType == 'column') series[i].update({
					type: newType
				});
				else series[i].update({
					type: newType,
					animation: true
				});
			}
		}
	  function getFullName(name){
	  		switch(name){
		  		case 'APO': return 'Apodaca';
		  		case 'CAD': return 'Cadereyta';
		  		case 'ESC': return 'Escobedo';
		  		case 'GAR': return 'García';
		  		case 'GPE': return 'Guadalupe';
		  		case 'JUA': return 'Juárez';
		  		case 'MTY': return 'Monterrey';
		  		case 'SC': return 'Santa Catarina';
		  		case 'SN': return 'San Nicolás';
		  		case 'SP': return 'San Pedro';
		  		case 'STG': return 'Santiago';
		  		default: break;
	  		}
	  }
	  
	  /*					 **
	  **      VIEWS 	     **
	  **      METHODS		 **
	  **					 */
	  
	  /* METHOD FOR BUILDING STATS VIEW */
	  function displayStats(querytehuan){
			var mun_p=[],mun_p_nonzero = [];
			var categorias=[];
			var auxCat=0;
			var bigo={};
			var biga={};
			var querypoly,queryStats;
			var nrmlpob = {
				APO:5.2,
				CAD:0.9,
				ESC:3.6,
				GAR:1.4,
		  		GPE:6.8, 
		  		JUA:2.6, 
		  		MTY:11.3,
		  		SC:2.7,
		  		SN:4.4,
		  		SP:1.2,
		  		STG:0.4
			};
			var nrmlkm = {
				APO:238,
				CAD:1141,
				ESC:151,
				GAR:1040,
		  		GPE:118, 
		  		JUA:247, 
		  		MTY:324,
		  		SC:885,
		  		SN:60,
		  		SP:72,
		  		STG:764
			};
			
			//Define Chart
			$('#columnContainer').highcharts({
				        chart: {
				            type: 'column',
							zoomType: 'xy',
							height: '450'
				        },
				        title: {
				            text: 'Cantidad de Reportes por Municipio'
				        },
				        subtitle: {
				            text: 'Utilice los filtros para una mejor apreciación. Tip: zoom con clic y arrastre.'
				        },
				        xAxis:{
					      title: {
						      text: 'Municipios'
					      }  
				        },
				        yAxis: {
				            min: 0,
				            title: {
				                text: 'Total de Reportes'
				            }
				        },
				        legend: {
					        enabled:true,
					         align: 'right',
							 verticalAlign: 'top',
							 floating:false,
							 layout: 'vertical',
							 title: {
			                    text: 'Categorías<br/><span style="font-size: 9px; color: #666; font-weight: normal">(Clic para desaparecer)</span>',
			                    style: {
			                        fontStyle: 'bold'
			                    }
			                },
			                backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74',
				            y: 40,
				            width: 200
				        },
				        tooltip: {
				            headerFormat: '<span style="font-size:12px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:10px; font-weight: lighter;" >{series.name}: <b>{point.y} reportes</b></div>',
				            footerFormat: '</div>',
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
				        },
				        plotOptions: {
				            column: {
				                pointPadding: 0.2,
				                borderWidth: 0
				            },
					        series: {
					            cursor: 'pointer',
				                point: {
				                    events: {
				                        click: function() {
				                            if ($('#columnContainer').highcharts().series.length >2 && this.series.name != 'PROMEDIO'){ 
				                            	filterFromStat(this.series.name);
				                            }
				                        }
				                    }
				                }
				            }
				        },
				        loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
		                }
					});
			$('#columnContainer').highcharts().showLoading('Recopilando la información, por favor espere...');
	        
			
		    ///SLICE QUERY IN THREE DIFFERENT PARTS FOR SIMPLICITY///
			//SELECT STATEMENT//
			var querycount = "SELECT COUNT("+table_name+".*) as y, "+area_name+".name as ejeX, "+table_name+".post_cat as seriesname FROM "+table_name+", "+area_name+" ";
			//WHERE CLAUSE EXTRACTED FROM ORIGINAL QUERY
			if (querytehuan.search(/where/i) != -1){
				var querywhere = querytehuan.substring(querytehuan.search(/where/i));
			}else{
				var querywhere = "";
			}
			//console.log('---Where clause extracted---');
			//console.log(querywhere);
			///GROUP AND ORDER CLAUSE
			var querygroup = " GROUP BY "+area_name+".name,"+table_name+".post_cat order by "+table_name+".post_cat, "+area_name+".name asc"
			
			///BUILD QUERY FOR COUNTING
			queryStats = querycount + querywhere + querygroup;
			
			//VARIABLES FOR QUERY STRING MANIPULATION
			var m = queryStats.search(' GROUP BY');
			var p = queryStats.search('ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)');
			
			//CHECK FOR POLYGON GEOM INTERSECTION
			if (p === -1){
				var p1= queryStats.search(/where/i);
				if (p1 === -1){
					queryStats = queryStats.splice(m,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)");
				}else{
					queryStats = queryStats.replace("WHERE","");
					queryStats = queryStats.splice(p1,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom) AND ");
				}
			}
			
			//VARIABLES FOR POLYGON QUERY	
			querypoly = "SELECT name FROM "+area_name+" order by name asc";
			var n = queryStats.search('"+area_name+".name =');
			m = queryStats.search(' GROUP BY'); //search again because index might change
			//CHECK TO RETURN JUST QUERIED COUNTIES ON X AXIS
			if (n != -1){
				var o = "("+queryStats.substring(n, m);
				querypoly = "SELECT name FROM "+area_name+" where "+o+" order by name asc";
			}
			//console.log("---Query del poligono para eje X---");
			//console.log(querypoly);
			//console.log("---Query para series de HC---");
			//console.log(queryStats);
			var re = new RegExp(table_name,"g");		
		    if(closedistance){
				var str     = queryStats;
				var n       = str.replace(re, "data");
				queryStats = "WITH data AS ("+_geoq+") "+n;
			}
			
/*
			console.log("Query for stats (querypoly):");
		    console.log(querypoly);
		    console.log("Query for stats (queryStats):");
 		    console.log(queryStats);	   
*/
			///Get array from polygon names (includes all municipalities drawn)
			sql.execute(querypoly)
			      .done(function(data) {
				    for (var i = 0; i < data.total_rows; i++) {
			          		mun_p[i] = data.rows[i].name;
			          		bigo[mun_p[i]] = {};
			        }
					//console.log("---Arreglo Municipios:---");
					//console.log(mun_p);
					
					//Manage arrays in preparation for highcharts		
					sql.execute(queryStats)
						.done(function(data) {
					        for (var i = 0; i < data.total_rows; i++) {
							   if (data.rows[i].seriesname != ''){
								   if (data.rows[i].seriesname != 'VIALIDAD'){
								      if (data.rows[i].seriesname != 'OTROS'){
									      ///get categories array
								          if(i===0){
							          		  categorias[auxCat] = data.rows[i].seriesname;
							          		  biga[categorias[auxCat]] = {};
									          auxCat++;
										  }else{
								          	  if(data.rows[i].seriesname != data.rows[i-1].seriesname && categorias[auxCat-1]!= data.rows[i].seriesname){
										  		categorias[auxCat] = data.rows[i].seriesname;
										  		biga[categorias[auxCat]] = {};
										  		auxCat++;
									          }
									      }
										//build and iniciate object of municipalities
										for(var j = 0;j < mun_p.length; j++) {
											  bigo[mun_p[j]][data.rows[i].seriesname] = 0;
										}
									 }
								   }
							   }
							}
							
							for(var j = 0;j < categorias.length; j++) {
								for (var i = 0; i < mun_p.length; i++){
									biga[categorias[j]][mun_p[i]] = 0;
								}
							}
							
							for (var i = 0; i < data.total_rows; i++) {
								if (data.rows[i].seriesname != ''){
									if (data.rows[i].seriesname != 'VIALIDAD'){
										if (data.rows[i].seriesname != 'OTROS'){   
										 	if(normalpob){
										 		bigo[data.rows[i].ejex][data.rows[i].seriesname] = Math.round(data.rows[i].y/nrmlpob[data.rows[i].ejex]);
										 		biga[data.rows[i].seriesname][data.rows[i].ejex] = Math.round(data.rows[i].y/nrmlpob[data.rows[i].ejex]);
										 	} else if (normalkm) {
												bigo[data.rows[i].ejex][data.rows[i].seriesname] = Math.round(data.rows[i].y/nrmlkm[data.rows[i].ejex]);
												biga[data.rows[i].seriesname][data.rows[i].ejex] = Math.round(data.rows[i].y/nrmlkm[data.rows[i].ejex]);
										 	} else {
											 	bigo[data.rows[i].ejex][data.rows[i].seriesname] = data.rows[i].y;
											 	biga[data.rows[i].seriesname][data.rows[i].ejex] = data.rows[i].y;
										 	}
									 	}
									 }
								}
					        }

/*
							console.log("---Objeto de objetos por municipio con totales por categoria---");
							console.log(bigo);

							console.log("---Objeto de objetos por categoria con totales por municipio---");
							console.log(biga);				
*/
					
							
							//Extract Series Elements from Objects for average
							var prom = [];
							var sumas = [];
							var tempk=0;
							for (var idz in bigo) {
								var obja = bigo[idz];
								var avg=0;
								var suma = 0;
									for (var property in obja) {
										if(obja.hasOwnProperty(property)){
											suma +=obja[property];
											}
										avgrnd=Math.round(avg = suma/categorias.length);
									}
								 if (suma != 0){
										mun_p_nonzero[tempk]= idz;
										prom[tempk] = [idz, avgrnd];
										sumas[tempk] = [suma];
										tempk++;
									}	
								 
							}
/*
							console.log("CONSOLIDADO DE CAT POR MUN");
							console.log(sumas);
*/
							
							
							var mun_p_fullname =[];
							for (var i=0; i < mun_p_nonzero.length;i++){mun_p_fullname.push(getFullName(mun_p_nonzero[i]));}
							$('#columnContainer').highcharts().xAxis[0].setCategories(mun_p_fullname);
/*
							console.log('Mun p non zero');
							console.log(mun_p_nonzero);
*/
							//console.log("---Promedios---");
							//console.log(prom);							
					
							//Extract Series Elements from Objects for data
							if(!muncons){
							for (var idx in biga) {
								var obje = biga[idx];
								var sum=0;
								var catarray = [];
								
								for(var j = 0;j< mun_p_nonzero.length;j++){
											catarray[j]=obje[mun_p_nonzero[j]];
											sum+=catarray[j];
								}
								
								 if (sum!=0){
								 	 var series = new Object();
									 series['data']= catarray;
									 series['name']= idx;
/*
									 console.log("Esta es la serie original impresa");
									 console.log(idx);
									 console.log(catarray);
*/
								 	 $('#columnContainer').highcharts().addSeries(series);
								 }
							}
							} 

							if(muncons){
								while($('#columnContainer').highcharts().series.length > 0)
									{$('#columnContainer').highcharts().series[0].remove(true);}
									$('#columnContainer').highcharts().xAxis[0].setCategories(["Reportes Totales Por Municipio"]);
								for (var i=0; i < mun_p_fullname.length; i++) {
									var series = new Object();
									series['name']= mun_p_fullname[i];
									series['data']= sumas[i];
									$('#columnContainer').highcharts().addSeries(series);
								}
								
							}
							
							var promOb = new Object();
							promOb['type'] = 'spline';
							promOb['name'] = 'PROMEDIO DE REPORTES'; 
							promOb['data'] = prom;
							promOb['visible'] = false;
							promOb['marker'] = {lineWidth: 4,
					         				 	lineColor: Highcharts.getOptions().colors[3],
							 				 	fillColor: 'white'};
							//$('#columnContainer').highcharts().addSeries(promOb);
							$('#columnContainer').highcharts().hideLoading();
				        }).error(function(errors) {
							// do nothing
						})
			  })
			      .error(function(errors) {
				    // do nothing
				  })
	  }
	  
	  /* METHOD FOR BUILDING TRENDS VIEW */
	  function displayTrends(querytehuan){		  
		  
		  //DEFINE MAIN TRENDS CHART
		  $('#timeContainer').highcharts({
			        chart: {
			                zoomType: 'x',
			                spacingRight: 20,
			                height: '450'
			        },
			        title: {
			                text: 'Cantidad de Reportes Diarios'
			        },
		            subtitle: {
			            text: 'Utilice los filtros para una mejor apreciación. Tip: zoom con clic y arrastre.'
			        },
			        xAxis: {
				  		type: 	'datetime',
			            maxZoom: 14 * 24 * 3600000, // fourteen days
			            title: { text: null }
					},
			        yAxis: {
			            min: 0,
			            startOnTick: false,
			            title: { text: 'Total de Reportes' }
			        },
			        credits: {
						enabled: false
					},
			        plotOptions: {
			                area: {
			                    fillColor: {
			                        linearGradient: { x1: 0, y1: 0, x2: 0, y2: 1},
			                        stops: [
			                            [0, Highcharts.getOptions().colors[0]],
			                            [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
			                        ]
			                    },
			                    lineWidth: 1,
			                    marker: {
			                        enabled: false
			                    },
			                    shadow: false,
			                    states: {
			                        hover: {
			                            lineWidth: 1
			                        }
			                    },
			                    threshold: null
			                }
			            },
			        series: [{
			        	name: 'Total de reportes',
			        	type: 'area',
			        }],
			        loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
		            },
		            legend: {
					        enabled:true,
					         align: 'left',
							 verticalAlign: 'top',
							 floating:true,
							 layout: 'vertical',
							 title: {
			                    style: {
			                        fontStyle: 'bold'
			                    }
			                },
			                backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74',
				            y: 60,
				            x: 53
				    },
				    scrollbar: {
					        enabled: true
					},
				    
				    tooltip: {
				    		headerFormat: '<span style="font-size:10px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:12px; font-weight: lighter;" >{series.name}:<b>{point.y}</b></div>',
				            footerFormat: '</div>',
				            valueDecimails:0,
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
				        }
			
		   });
		   $('#timeContainer').highcharts().showLoading('Recopilando la información, por favor espere...');
		   
		   
		   ///SLICE QUERY IN THREE DIFFERENT PARTS FOR SIMPLICITY///
			///SELECT STATEMENT///

			if (querytehuan.search(area_name) != -1){
				var querycount = "SELECT date_part('year', "+table_name+".created_at) as year, date_part('month', "+table_name+".created_at) as month, date_part('day', "+table_name+".created_at) as day, count( "+table_name+".*) FROM "+table_name+", "+area_name+" ";
			}else{
				var querycount = "SELECT date_part('year', "+table_name+".created_at) as year, date_part('month', "+table_name+".created_at) as month, date_part('day', "+table_name+".created_at) as day, count( "+table_name+".*) FROM "+table_name+" "
			}

			//WHERE CLAUSE EXTRACTED FROM ORIGINAL QUERY
			if (querytehuan.search(/where/i) != -1){
				var querywhere = querytehuan.substring(querytehuan.search(/where/i));
			}else{
				var querywhere = "";
			}
			//console.log('---Where clause extracted---');
			//console.log(querywhere);
			///GROUP AND ORDER CLAUSE
			var querygroup = " GROUP BY year, month, day ORDER BY year, month, day asc";
			///BUILD QUERY FOR COUNTING
			var queryTrends = querycount + querywhere + querygroup;
			
			//VARIABLES FOR QUERY STRING MANIPULATION
			var m = queryTrends.search(' GROUP BY');
			var p = queryTrends.search('ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)');
			
			//CHECK FOR POLYGON GEOM INTERSECTION
			if (querytehuan.search('"+area_name+"') != -1){
				if (p === -1){
					var p1= queryTrends.search(/where/i);
					if (p1 === -1){
						queryTrends = queryTrends.splice(m,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)");
					}else{
						queryTrends = queryTrends.replace("WHERE","");
						queryTrends = queryTrends.splice(p1,0,"WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom) AND ");
					}
				}
			}
/*
		    console.log("Query for trends:");
		    console.log(queryTrends);
*/
		    var re = new RegExp(table_name,"g");
		    if(closedistance){
				var str     = queryTrends;
				var n       = str.replace(re, "data");
				queryTrends = "WITH data AS ("+_geoq+") "+n;
			}
/*
			console.log("Query for geotrends:");
		    console.log(queryTrends);
*/

		    var fechas = [];
		    
		    sql.execute(queryTrends)
				.done(function(data) {
			       ///Prepare Dates
			       var d = new Date();
			       var t = new Date();
			       var diff = 0;
			       var day = 86400000;
			       var i = 0;
			       var dateObject = { rows: [] };
				   
				   for (var k = 0; k < data.total_rows; k++) {
						var obj={
							  year: data.rows[k].year,
							  month: data.rows[k].month-1,
							  day: data.rows[k].day,
							  count: data.rows[k].count
						    };
						dateObject.rows.push(obj);
						d.setFullYear(data.rows[k].year, data.rows[k].month -1 ,data.rows[k].day);
						if (k+1 < data.total_rows) {
							t.setFullYear(data.rows[k+1].year, data.rows[k+1].month -1 ,data.rows[k+1].day);
							diff = Math.round((t-d)/day);
							if (diff > 1){
								for (var j = 0; j < diff-1; j++){
									  d = new Date(d.setDate(d.getDate()+1)); 
									  var obj2 = {
						          			 year: d.getFullYear(),
										  	 month: d.getMonth(),
										  	 day: d.getDate(),
										  	 count: 0
									  	 };
									  dateObject.rows.push(obj2);
								}
							}
						} 
					}
			    for (var i = 0; i < dateObject.rows.length ; i++) {
			    	fechas[i]= [Date.UTC(dateObject.rows[i].year, dateObject.rows[i].month ,dateObject.rows[i].day), dateObject.rows[i].count];
				}
/*
				console.log("Estos son los datos para el arreglo de fechas");
				console.log(fechas);
*/
	
	if(byweeks || bymonths){
	    $('#timeContainer').highcharts().destroy();
		if (byweeks){
			 //FOR XAXIS TICK SPACING
			 var axisX = { 
			 			type: 'datetime',
					    maxZoom: 14 * 24 * 3600000, // fourteen days
					    title: { text: null },
						tickInterval: 7 * 24 * 3600000, // one week
						labels: {format: '{value: %b%e-%y}',
								 align: 'right',
								 rotation: -45
								}
			 };
			//FOR DATAGROUPING ON SERIES
			var consolidado = {
	                    dateTimeLabelFormats: {week: ['Semana del %A %e %b %Y', '%A, %b %e', '-%A, %b %e, %Y']},
	                    groupPixelWidth: 40,
	                    approximation: "sum",
	                    enabled: true,
	                    units: [[
	                        'week',
	                        [1]
	                        ]]
	        };
		
		}else if(bymonths){
			//FOR XAXIS TICK SPACING
			var axisX = {};
			//FOR DATAGROUPING ON SERIES
			var consolidado =	{
			            groupPixelWidth: 40,
			            approximation: "sum",
			            enabled: true,
			            units: [[
			                'month',
			                [1]
			                ]]
	        };
		}
		
		// Create the chart
		$('#timeContainer').highcharts('StockChart', {
		    chart: {
				zoomType: 'x',
				height: '450'
		    },

		    rangeSelector: {
		        buttons: [{
		            type: 'day',
		            count: 3,
		            text: '3d'
		        }, {
		            type: 'week',
		            count: 1,
		            text: '1s'
		        }, {
		            type: 'month',
		            count: 1,
		            text: '1m'
		        }, {
		            type: 'month',
		            count: 6,
		            text: '6m'
		        }, {
		            type: 'year',
		            count: 1,
		            text: '1a'
		        }, {
		            type: 'all',
		            text: 'Todo'
		        }],
		        selected: 3
		    },
			xAxis: axisX,
			yAxis: {
				title: {
					text: 'Total de Reportes'
				}
			},

		    title: {
				text: 'Total de reportes en el CIC'
			},

			subtitle: {
				text: '' // dummy text to reserve space for dynamic subtitle
			},

			series: [{
/* 		        type: 'column', */
		        name: 'Reportes',
		        data: fechas,
		        pointStart: fechas[0],
		        pointInterval: 3600 * 1000,
		        tooltip:{
				    		headerFormat: '<span style="font-size:10px; font-weight:bold;">{point.key}</span><div> <br>',
				            pointFormat: '<div style="color:{series.color};font-size:12px; font-weight: lighter;" >{series.name}:<b>{point.y}</b></div>',
				            footerFormat: '</div>',
				            valueDecimails:0,
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
				        },
                dataGrouping: consolidado
		    }]

		});
		   }else{
				$('#timeContainer').highcharts().series[0].setData(fechas);
				var regression = fitData(fechas, 'linear').data;
				var regresObj = new Object();
				regresObj['data'] = regression;
				regresObj['visible'] = false;
				regresObj['name'] = 'Tendencia';
				regresObj['marker']= {enabled:false};
				$('#timeContainer').highcharts().addSeries(regresObj);
/* 				$('#timeContainer').highcharts().series[1].setData(regression); */
				$('#timeContainer').highcharts().hideLoading();}
	      })
		        .error(function(errors) {
		          // do nothing
		        })
		 
		 
	  }
	  
	  /* METHOD FOR BUILDING TORQUE VIEW */
	  function displayTorque(querytehuan) {
	  
	  
	  
		   var query_T = "(" + querytehuan + ")" + " i";
		   
		   if (torque == null){
		        // initialise the google map
		        map_T = new google.maps.Map(document.getElementById('map_canvas'),
		        	{
		        	center: new google.maps.LatLng(mapCenter[0], mapCenter[1]),
					zoom: 11,
					/*maxZoom: 17,*/
					minZoom:5,
					zoomControl: true,
					zoomControlOptions: {
						style: google.maps.ZoomControlStyle.DEFAULT		
					},
					mapTypeControlOptions: { mapTypeIds: [google.maps.MapTypeId.SATELLITE, 'style_'],
											  style: google.maps.MapTypeControlStyle.DROPDOWN_MENU
					},
					mapTypeControl: false,
					scrollwheel: true,
					streetViewControl: true,
					panControl:true,
					backgroundColor: '#163D74',
					rotateControl:true,
		      });
		
		        var map_T_style = {};
		        map_T_style.google_maps_customization_style = [
		            {
		                stylers:[ { invert_lightness:false },
			                      { weight:1 },
			                      { saturation:-10 },
								  { lightness: 0 } ]
		            },
		            {
		                elementType:"labels",
		                stylers:[  ]
		            }
		            										];
		
		        var Soft = function () {
		            this.Soft = function () {
		                map_T.setMapTypeId(google.maps.MapTypeId.ROADMAP);
		                map_T.setOptions({styles:map_T_style.google_maps_customization_style});
		            }
		        }
		
		
		        map_T.setMapTypeId(google.maps.MapTypeId.ROADMAP);
		        map_T.setOptions({styles:map_T_style.google_maps_customization_style});
				
		function init_slider( that ){
            var that_opts = that.options;
            // Init jQuery UI options
            $("#torque-slider").slider({
                min: Math.round(that_opts.start),
                max: Math.floor(that_opts.end),
                value: Math.round(that_opts.start),
                step: that._step,
                slide: function(event, ui){
                    that._current = ui.value;
                    var date = new Date(that._current * 1000);
                    var date_arry = date.toString().substr(4).split(' ');
                    that._display.set_time((that._current - that.start) / that._step);                    
                }
            });
        };
        
        function on_move (that) {
            $( "#torque-slider" ).slider({ value: that._current });
        }
		        torqueOptions = {
		            user:'cicadmin',
		            table: query_T,
		            column:'created_at',
		            steps:350,
		            resolution:4,
		            cumulative:true,
		            clock:true,
		            fps:24,
		            fitbounds:false,
		            blendmode:'xor',
		            trails:true,
		            point_type:'circle',
		            cellsize:1,
		            scrub: init_slider,
					scrub_move: on_move
		        }
		
				/* var torque = null; */
		        Torque(function (env) { Torque.app = new env.app.Instance();
										torque = new Torque.app.addLayer(map_T, torqueOptions);
										Torque.env = env;
										var pause = $('<a></a>');
										/*
							            $(pause).attr('id','torque-pause')
							            $(pause).addClass("playing");
							            $('body').append(pause);
							            $(pause).click(function(){
										                if($(this).hasClass('paused')){
										                    torque.pause();
										                    $(this).removeClass("paused");
										                    $(this).addClass("playing");
										                } else {
										                    $(this).removeClass("playing");
										                    $(this).addClass("paused");
										                    torque.pause();
										                }
							            });
*/
										
										
			   });
		
		        /*var blend_modes = [	"lighter",
						            "source-over",
						
									"copy",
						            "destination-atop",
						            "destination-in",
						            "destination-out",
						            "destination-over",
						            "source-atop",
						            "source-in",
						            "source-out",
						
						            "xor" ];*/
		
		        var tablename = 'torque_mty';
		
		        dat.GUI.DEFAULT_WIDTH = 200;
		        dat.GUI.autoPlace = false;
		        dat.GUI.TEXT_CLOSED="Cerrar Controles"
		        dat.GUI.TEXT_OPEN="Abrir Controles"
		
		        var toggle = new dat.GUI(); 	/*  place here relocation options for menu */
		        

		  		        
		        
		        var customContainer = document.getElementById('torqueDATGUI');
				
				customContainer.appendChild(toggle.domElement);
		        document.getElementById('torqueDATGUI').style.display='block';
		        
		        
				toggle.close(); 				/* Menu loads closed */
				
		        toggle.add(torqueOptions, 'resolution', [1, 2, 3, 4, 5]).listen().name('Tamaño');
		        /* toggle.add(torqueOptions, 'cellsize', 0, 50).listen(); */
		        toggle.add(torqueOptions, 'cumulative').listen().name('Acumulativo');
		        toggle.add(torqueOptions, 'trails').listen().name('Trazo');
		        toggle.add(torqueOptions, 'steps', { Muy_Lenta: 1500, Lenta: 500, Media: 350, Rapida: 100, Muy_Rapida: 20 }).listen().name('Velocidad');
				/* toggle.add(torqueOptions, 'fps', 0.05, 48, false).listen(); */
		        toggle.add(torqueOptions, 'blendmode', { Sobrepuesto: 'source-over', Transparente: 'xor', Luminoso:'lighter'}).listen().name('Estilo');
		        toggle.add(torqueOptions, 'point_type', {Círculo: 'circle', Cuadro: 'square'}).listen().name('Marcador');
		
		        var that = this;
		        var updateTorque = function () {
		            this.updateTorque = function () {
		                if (torqueOptions.table != tablename) {
		                    tablename = torqueOptions.table;
		                    //torqueOptions.fitbounds = true;
		                }else{
		                    //torqueOptions.fitbounds = false;
		                }
		                torque.setOptions(torqueOptions);
		            }
		        }
		        toggle.add(new updateTorque(), 'updateTorque').name('Actualizar');
		
		       takePolygons();
		       
	       }else {
	       	   takePolygons();
	       	   torqueOptions.table = query_T;	
		       torque.setOptions(torqueOptions);
		       if (torque.running = false) { torque.play(); dat.GUI.toggleHide();}
	       }
      }

      /* METHOD FOR BUILDING CO-OCCURRENCE VIEW */
      function displayOccurrence(querytehuan){
          var _q;
      	  // REMOVE THE ADDITIONAL QUERY STRING
		  if (querytehuan.search(/from/i) != -1)
				_q = querytehuan.substring(querytehuan.search(/from/i));
		  
      	  // LOAD SPINNER 
		  var target = document.getElementById('occur');
		  var spinner = new Spinner(opts).spin(target);
		  
		  for (var i = 0; i < formattedData.length; i++){
			  for (var j = 0; j < formattedData[i].length; j++){
			    formattedData[i][j] = 0;
			  }
		  }
	      
	      d3.select('#vis').classed(colorScheme, true);
	      
	      // QUERY CARTODB
		  $.ajax({
			url: encodeURI("http://cicadmin.cartodb.com/api/v2/sql/?q=SELECT date_part('dow', "+table_name+".created_at) as day_y, date_part('hour', "+table_name+".created_at at time zone '"+TZ+"') as hour_x, count( "+table_name+".*) " + _q + " GROUP BY day_y, hour_x ORDER BY day_y, hour_x asc"),
			dataType: 'json',
			success: function(data) {
				for (var i =0; i < data.total_rows ; i++){
				    formattedData[data.rows[i].day_y][data.rows[i].hour_x] = data.rows[i].count;
				}
				spinner.stop();
				createTiles();
			}
			}).done(function(data) {
				drawTiles();
				d3.select('.subtitle').html('Incidencia semanal de reportes');		
				
			    // tiles mouseover events
				$('#tiles td').hover(function() {
					$(this).addClass('sel');
					var tmp = $(this).attr('id').split('d').join('').split('h'),
						day = parseInt(tmp[0]),
						hour = parseInt(tmp[1]);
					
					_drawHourlyChart(day);
					selectHourlyChartBar(hour);
					d3.select('.subtitle').html('Incidencia de reportes en ' + days[day].name +" a las "+ hours[hour] +"m: " + Math.round(formattedData[day][hour]));
				}, function() {
					$(this).removeClass('sel');
					_drawHourlyChart(-1);
					d3.select('.subtitle').html('Incidencia semanal de reportes');
				});
			});
      }
      	  
	  /* METHOD FOR BUILDING WORDLE VIEW */
	  function displayWordle(querytehuan){
		  var text= '';
		  var limit=100;
		  var type='a';  /* 'default': '', 'big -> small': 'a', 'small -> big': 'b','A -> Z': 'c','shuffle': 'd'*/
		  var _q;
		  wordle.reset();
		  // REMOVE THE ADDITIONAL QUERY STRING
		  if (querytehuan.search(/from/i) != -1)
				_q = querytehuan.substring(querytehuan.search(/from/i));
		  // LOAD SPINNER 
		  var target = document.getElementById('wordle-container');
		  var spinner = new Spinner(opts).spin(target);
		  // QUERY CARTODB
		  $.ajax({
			url: encodeURI("http://cicadmin.cartodb.com/api/v2/sql/?q=SELECT "+table_name+".post_content " + _q),
			dataType: 'json',
			success: function(data) {
				for (var i =0; i < data.total_rows ; i++){
					text+=data.rows[i].post_content+' ';
				}
				text = TextUtil.countWordOccurance(text);
			}
			}).done(function(data) {
			    spinner.stop();
				wordle.sortType =type;
		        wordle.setWords(text, limit);
		        wordle.doLayout();
			});
	  }
	  
	  /* METHOD FOR BUILDING TWITTER VIEW */
	  function displayTwitter(){
		   if (loadTwitter){
			      var link; 
			      var script = document.createElement('script');
				  script.type = 'text/javascript';
				  
				  for (i=0; i<twitterID.length; i++){
					  link = '<a class="twitter-timeline"href="https://twitter.com/'+twitterName[i]+'"data-widget-id="'+twitterID[i]+'">@'+twitterName[i]+'</a>';
					  script.appendChild(document.createTextNode('!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?\'http\':\'https\';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");'));
					  $("#twitterContent").append(link);
					  $("#twitterContent").append(script);
					  script.removeChild(script.childNodes[0]);
				  }
				  loadTwitter=false;
			}	  
			$('#twitter').css('display', 'block');
      }
	  
	  /* METHODS FOR BUILDING SCORES VIEW */
	  function displayScore(){
	  	  var bigoSco = {};
	  	  var bigoSta = {};
	  	  var bigoOri = {};
		  var queryMun = "SELECT DISTINCT(name) from "+area_name+" order by name asc";
	  	  var queryScore = "select avg(date_part('days',("+table_name+".last_mod-"+table_name+".created_at))) as dias_promedio, "+area_name+".name as municipio, "+table_name+".post_cat as categoria from "+table_name+", "+area_name+" where st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') and ("+table_name+".status ='closed') and ((now() at time zone '"+TZ+"')-"+table_name+".created_at < interval '90 day') group by "+area_name+".name,"+table_name+".post_cat order by "+area_name+".name,"+table_name+".post_cat asc";
	  	  var queryStatus = "select count("+table_name+".*) as cuenta, "+area_name+".name as municipio, "+table_name+".post_cat as categoria, "+table_name+".status as status, "+table_name+".close_fail as close_fail from "+table_name+", "+area_name+" where st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".status ilike '%read%' or "+table_name+".status ilike '%closed%' and "+table_name+".close_fail = false or "+table_name+".status ilike '%closed%' and "+table_name+".close_fail = true) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') and ((now() at time zone '"+TZ+"')-"+table_name+".created_at < interval '90 day') group by "+area_name+".name,"+table_name+".post_cat, "+table_name+".status, "+table_name+".close_fail order by "+area_name+".name,"+table_name+".post_cat asc";
	  	  var queryOrigin ="select count(*), channel as origen, "+area_name+".name as municipio from "+table_name+", "+area_name+" where (now() at time zone '"+TZ+"'-"+table_name+".created_at at time zone '"+TZ+"') < interval '90 day' and st_intersects("+table_name+".the_geom, "+area_name+".the_geom) and ("+table_name+".post_cat ilike '%alcantarilla%' or "+table_name+".post_cat ilike '%alumbr%' or "+table_name+".post_cat ilike '%electricidad%' or "+table_name+".post_cat ilike '%fuga%' or "+table_name+".post_cat ilike '%parques%' or "+table_name+".post_cat ilike '%basura%' or "+table_name+".post_cat ilike '%bache%' or "+table_name+".post_cat ilike '%semaforo%') group by channel,"+area_name+".name order by municipio";
		  
		  
		  
		  $('#chart0').highcharts({
				chart: {
				    type: 'column',
				    height: '450',
				    zoomType: 'xy'
				},
				title: {
					text: 'Efectividad Municipal en Servicios Públicos (Últimos 90 días)'
				},
				xAxis: {
					title: {
						text: 'Servicios públicos'
					},
					categories: publicServices
				},
				yAxis: {
					title: {
						text: 'Tiempo promedio para solucionar un reporte (días)'
					},
					minorGridLineWidth: 0,
					lineColor: 'transparent'
				},
				plotOptions: {
					series: {
						animation: {
							duration: 2000
						}
					}
				},
				loading:   {
		                    style: {
		                        fontSize: '40px',
		                        opacity: .75
		                    },
		                    labelStyle: {
		                        top: '45%'
		                    }
                },
                tooltip: {
				            headerFormat: '<span style="font-size:12px; font-weight:bold;">{point.key}</span><div>',
				            pointFormat: '<div style="color:{series.color};font-size:10px; font-weight: lighter;" >{series.name}: <b>{point.y} días</b></div>',
				            footerFormat: '</div>',
				            shared: true,
				            useHTML: true,
				            followPointer: true,
				            backgroundColor: {
				                linearGradient: [0, 0, 0, 60],
				                stops: [
				                    [0, '#FFFFFF'],
				                    [1, '#E0E0E0']
				                ]
				            },
				            borderWidth: 2,
				            borderColor: '#163D74'
		        },
		        legend: {
					        enabled:true,
					         align: 'right',
							 verticalAlign: 'top',
							 y:25,
							 floating:true,
							 layout: 'vertical',
					        backgroundColor: '#FFF',
				            borderWidth: 2,
				            borderColor: '#163D74'
				        }
                
			});
		  $('#chart0').highcharts().showLoading('Recopilando la información, por favor espere...');
		  $('.ui-accordion .ui-accordion-header').css("opacity", "0.5");	
		  sql.execute(queryMun)
		      .done(function(data) {
		      		/*THIS DATA COMES IN THE WAY:
			      	data.rows[i].name = "APO"...	
			      	*/
				    for (var i = 0; i < data.total_rows; i++) {
			        	bigoSco[data.rows[i].name]={};
			        	bigoSta[data.rows[i].name]={};
			        	bigoOri[data.rows[i].name]={};
			        	for (var j = 0; j < publicServices.length; j++) {
				        	bigoSco[data.rows[i].name][publicServices[j]]=0;
				        	bigoSta[data.rows[i].name][publicServices[j]]={'abierto':0,'cerrado':0,'fallo':0};
				        }
				        for (var j = 0; j < reportOrigins.length; j++) {
				        	bigoOri[data.rows[i].name][reportOrigins[j]]=0;
				        }
			        }
				  sql.execute(queryScore)
				      .done(function(data) {
				      	/*THIS DATA COMES IN THE WAY:
				      	data.rows[i].categoria	
				      	data.rows[i].municipio	
				      	data.rows[i].dias_promedio
				      	*/
					    for (var i = 0; i < data.total_rows; i++) {
				        	bigoSco[data.rows[i].municipio][data.rows[i].categoria] = Math.round(data.rows[i].dias_promedio);
				        }
						//console.log("bigoSco");
				        //console.log(bigoSco);
				        sql.execute(queryStatus)
				        		.done(function(data) {
						      		/*THIS DATA COMES IN THE WAY:
								  	data.rows[i].categoria	
							      	data.rows[i].municipio	
							      	data.rows[i].close_fail
							      	data.rows[i].status
							      	data.rows[i].cuenta
							      	*/
							  		for (var i = 0; i < data.total_rows; i++) {
								  		if (data.rows[i].status == 'closed'){
									  		if (data.rows[i].close_fail){
										  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].fallo = data.rows[i].cuenta;
									  		}else{
										  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].cerrado = data.rows[i].cuenta;
									  		}
								  		} else{
									  		bigoSta[data.rows[i].municipio][data.rows[i].categoria].abierto = data.rows[i].cuenta;
								  		}
								  	}
								  	//console.log("bigoSta");
								  	//console.log(bigoSta);
								  	sql.execute(queryOrigin)
						        		.done(function(data) {
								      		/*THIS DATA COMES IN THE WAY:
										  	data.rows[i].count	
									      	data.rows[i].origen	
									      	data.rows[i].municipio
										  	*/
									  		for (var i = 0; i < data.total_rows; i++) {
										  		bigoOri[data.rows[i].municipio][data.rows[i].origen]=data.rows[i].count;
										  	}
										  	/*
											  	bigoSco : {APO:{publicServices}, CAD:{publicServices}...}
										      	bigoSta : {APO:{abierto:0,cerrado:0,fallo:0}, CAD:{abierto:0,cerrado:0,fallo:0}...}
										      	bigoOri : {APO:{reportOrigins}, CAD:{reportOrigins}...}
										  	*/
										  	//console.log("bigoOri");
										  	//console.log(bigoOri);
										  	//console.log(queryOrigin);
										  	drawScore(bigoSco,bigoSta,bigoOri);
										  	
										});
		
						        
						        });
				      });
		      });
	}
	  
	  /* METHODS FOR BUILDING EXECREP VIEW */
	  function displayExecRep(querytehuan){
	  		var _addr;
	  		var _total = document.getElementById("counterVal").value;
	  		if (_total.search(/,/i) != -1){
				_total = parseFloat(_total) + _total.substring(_total.search(/,/i)+1);
			}
	  		if (!closedistance) querytehuan+=" ORDER BY " + table_name + ".created_at DESC LIMIT "+ execRepLimit +" OFFSET "+ execRepLimit*execRepOffset;
	  		
	  		sql.execute(querytehuan).done(function(data) {
		      var execRep="<table id=\"table_rep\"><thead><tr style=\"background-image: url(images/bg-tabletd.png);background-repeat: repeat-x;height: 50px;font-size: 12px;color:#FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle; text-align: center;\"><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">CATEGORIA</td><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">INFORMACIÓN</td><td style=\"background-repeat: repeat-x; height: 50px;font-size: 12px;color: #FFF;padding: 0 30px;border: 1px solid #333;vertical-align: middle;\">ESTADO</td></tr></thead><tbody>"; 
		      for (var i=0;i<data.rows.length;i++){
		  	    status = (data.rows[i].status == 'read') ? status = "Abierto" : status = "Cerrado";
		  	    
		  	    if (data.rows[i].formatted_address.search(/null/i) != -1) addr = "No especificada, ver mapa.";
		  	    else addr=data.rows[i].formatted_address;
		  		execRep+="<tr bgcolor=\"F2F2F2\">";
		  		execRep+="<td valign=\"top\" style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<center><br><a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img width=\"80\" height=\"80\" src=\""+getImg(data.rows[i].post_cat)+"\" class=\"attachment-thumbnail\"/></a></center><br>";
		  		execRep+="<h6 style=\"font-size:12px\">"+data.rows[i].post_cat+"</h6>";
		  		execrep+="</td>";
		  		execRep+="<td valign=\"top\"  style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<h5 style=\"font-size:12px; text-align:left;\"><a class=\"title\" href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\">"+data.rows[i].post_title+"</h5>";
		  		if(getAssets(data.rows[i].assets) != '') execRep+="<img src=\"images/attachment.png\" width=\"15\" height=\"15\" style=\"float: right; margin-top: -27;margin-right: -5;\">";
		  		execRep+="</a>";
		  		execRep+="<h5><a class=\"title\" href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><h5 class=\"direccion\">"+addr+"</a></h5>";
		  		execRep+="<h5 class=\"calendario\">"+new Date(data.rows[i].created_at)+"</h5>";
		  		execrep+="</td>";
		  		execRep+="<td valign=\"top\"  style=\"padding: 15px;vertical-align: top;text-align: center; border-radius: 2px;\">";
		  		execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\" class=\"xcnr\">"+data.rows[i].ticket+"</a>";
				
                if (status == "Abierto"){
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\" class=\"verificado2\">"+status+"</a>";
                	execRep+="<span class=\"icon-span\" style=\"float: left;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+data.rows[i].uuid+"')\"/> "+data.rows[i].votes;
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> 0</span>";
                	execRep+="<div class=\"rating\" style=\"opacity:0.3;\">";
	                for (var j=4; j>=0;j--){
		                execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" disabled><label for=\"star"+j+"\">"+j+" stars</label>";
	                }
	                execRep+="</div>";
                } else{
                	if (data.rows[i].close_fail) execRep+="<a class=\"verificado3\">"+status+"</a></div>";
					else execRep+="<a class=\"verificado\">"+status+"</a>";
                	execRep+="<span class=\"icon-span\" style=\"float: left;\"><img class=\"icon-like\" src=\"images/icon-like.png\" onclick=\"sendVote('"+data.rows[i].uuid+"')\"/> "+data.rows[i].votes;
                	execRep+="<a href=\""+window.location.href.split('?')[0] + '?ticket=' + data.rows[i].ticket + '&table_name=' + table_name+"\"><img class=\"icon-comment2\" src=\"images/icon-comments2.png\"/></a> 0</span>";
	                execRep+="<div class=\"rating\">";
	                for (var j=4; j>=0;j--){
		                if (data.rows[i].stars > j)
		                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" checked=\"checked\" onclick=\"sendStars("+j+",'"+data.rows[i].uuid+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
		                else
		                	execRep+="<input type=\"checkbox\" id=\"star"+j+"\" name=\"rating\" value=\""+j+"\" onclick=\"sendStars("+j+",'"+data.rows[i].uuid+"')\"><label for=\"star"+j+"\">"+j+" stars</label>";
	                }
	                execRep+="</div>";
                }
		  		execrep+="</td>";
		  		execrep+="</tr>";
		  	  }
		  	  execRep+="</table>";
		  	  
		  	  execRep+="<center>";
		  	  if (execRepOffset>0 && execRepOffset < _total/execRepLimit-1){ 
		  	  	execRep+="<a href=\"javascript: execRepOffset=0; setQ();\" class=\"button back dark\" style=\"position:absolute; top:30%; left:10%;\"><span></span></a><a href=\"javascript: execRepOffset--; setQ();\" class=\"button back light\" style=\"position:absolute; top:30%; left:15%\"><span></span></a><a href=\"javascript: execRepOffset++; setQ();\" class=\"button next light\" style=\"position:absolute; top:30%; right:15%;\"><span></span></a><a href=\"javascript: execRepOffset="+_total+"/execRepLimit-1; setQ();\" class=\"button next dark\" style=\"position:absolute; top:30%; right:10%;\"><span></span></a>";
		  	  } else if (execRepOffset==0 && _total > execRepLimit) execRep+="<a href=\"javascript: execRepOffset++; setQ();\" class=\"button next light\" style=\"position:absolute; top:30%; right:15%;\"><span></span></a>";
		  	  else if (execRepOffset == _total/execRepLimit-1 && execRepOffset!=0 ) execRep+="<a href=\"javascript: execRepOffset--; setQ();\" class=\"button back light\" style=\"position:absolute; top:30%; left:15%;\"><span></span></a>";
		  	  execRep+="</center>";
			  $( "#execRepContent" ).html(execRep);
	  		});
	  		
			$('#execrep').css('display', 'block');
	  }
	  
	  /* VIEW CHANGER METHOD */ 
	  function changeView(view){
        activeView = view;
	    switch (view){
		    case 'agebUrbano': if($('#ageb-content').is(':visible')) $("#ageb-content").hide('clip', {}, 400);
		    				   document.getElementById("buttonAgeb").disabled=true;
		    				   document.getElementById('torqueDATGUI').style.display='none';

		    case 'home': 
		    	$('#mun-legend-div').css('display', 'none');
		    	clearAgebHighlight();
		    	fade('showSlides');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); } 
		    	takePolygons();
		    	$('#map').css('display', 'block'); 
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'block');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    case 'heat':
		    case 'intensity': 
		    	fade('showSlides');
		    	$('#mun-legend-div').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	takePolygons();
		    	$('#map').css('display', 'block');
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    case 'torque': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#torque').css('display', 'block'); if (torque) if (!torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'block');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    case 'occur': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#occur').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;	
		    case 'trends': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#trends').css('display', 'block');
		    	$('#_panel').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    case 'stats': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#stats').css('display', 'block');
		    	$('.cluster').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    case 'score': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('all');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'block');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	displayScore(); break;
		    case 'wordle': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides');
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('#_panel').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'block');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;	
		    case 'twitter': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('all');
		    	$('#map').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#_panel').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque)  if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#execrep').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	displayTwitter(); break;
		    case 'execrep': 
		    	$('#mun-legend-div').css('display', 'none');
		    	fade('showSlides'); execRepOffset=0;
		    	$('#map').css('display', 'none');
		    	$('#twitter').css('display', 'none');
		    	$('#stats').css('display', 'none');
		    	$('#trends').css('display', 'none');
		    	$('#_panel').css('display', 'none');
		    	$('#torque').css('display', 'none'); if (torque) if (torque.running) { torque.pause(); dat.GUI.toggleHide(); }
		    	$('.cluster').css('display', 'none');
		    	$('#wordle-container').css('display', 'none');
		    	$('#occur').css('display', 'none');
		    	$('#score').css('display', 'none');
		    	$('#torque-slider').css('display', 'none');
		    	$('#legendAgeb').css('display', 'none');
		    	document.getElementById("buttonAgeb").disabled=true;
		    	$('#ageb-chorodiv').css('display', 'none');
		    	setQ(); break;
		    default: break;
	    }
    }
	  
	  /*					 **
	  **     MAIN QUERY 	 **
	  **  RELATED METHODS    **
	  **					 */
	  
	  /* ONLOAD JQUERY CHECKBOXES FILTER ACTIVATION */
	  $(function() {
	  	
		  	/* SWITCHERS */
		  	
			$('.switch').change(function() {
	
				var that = $(this).attr('id');
		  		/* CATEGORIES */
		  		for (var a in categories){
			  		if (a==that){
					  	this.checked ? categories[that] = true : categories[that] = false;
					  	execRepOffset = 0;
					  	setQ();
					  	break;	
			  		}
		  		}
		  		/* DATES */
		  		for (var b in dates){
			  		if (b==that){
					  	this.checked ? dates[that] = true : dates[that] = false;
					  	clearDates(that);
					  	execRepOffset = 0;
					  	setQ();
					  	break;	
			  		}
		  		}
		  		/* MUNS */
		  		for (var c in mun){
			  		if (c==that){
					  	this.checked ? mun[that] = true : mun[that] = false;
					  	execRepOffset = 0;
					  	setQ();
					  	break;	
			  		}
		  		}
		  		/* REPORT STATUS */
		  		for (var d in repStatus){
			  		if (d==that){
					  	this.checked ? repStatus[that] = true : repStatus[that] = false;
					  	execRepOffset = 0;
					  	setQ();
					  	break;	
			  		}
		  		}
			  	
		  		/* REPORT DETAIL */
		  		for (var e in repDetail){
			  		if (e==that){
					  	this.checked ? repDetail[that] = true : repDetail[that] = false;
					  	execRepOffset = 0;
					  	setQ();
					  	break;	
			  		}
		  		}
			  		
		  	});	  	
		  	
		  	/* DATE SLIDERS */
		  	
		  	$('#slider-ulthoras').on("slidestop", function(event, ui)  {
		  		if (dates.ulthoras) {
		  			clearDates('ulthoras');
		  			execRepOffset = 0;
		  			setQ();
		  		}
		  	});
		  	$('#slider-horasdeldia').on("slidestop", function(event, ui)  {
		  		if (dates.horasdeldia) {
		  			execRepOffset = 0;
		  			setQ();
		  		}
		  	});
		  		  	
		  	
		  	/* DETAIL SLIDERS */
	
		  	$('#slider-voto').on("slidestop", function() {
		  		if (repDetail.voto) {
		  			execRepOffset = 0;
		  			setQ();
		  		}
		  	});
		  	$('#slider-star').on("slidestop", function() {
		  		if (repDetail.star) {
		  			execRepOffset = 0;
		  			setQ();
		  		}
		  	});
		  	
		  	
		  	/* GEO LOCATION */
		  	
		  	$('#closedistance').change(function() {
		  		this.checked ? closedistance = true : closedistance = false;
		  		execRepOffset = 0;
		  		if (!closedistance) {
		  			clearGeo();
		  			setQ();
		  		} else {
		  			clearDistance('close');
		  			detectUserLocation();
		  		}
		  	});
		  	$('#slider-closedistance').on("slidestop", function() {
		  		if (closedistance) {
		  			execRepOffset = 0;
		  			setQ();
		  		}
		  	});
		  	
		  	
		  	/* RADIAL DISTANCE */
		  	
		  	$('#radius').change(function() {
		  		this.checked ? radius.set = true : radius.set = false;
		  		execRepOffset = 0;
		  		if (radius.set) {
		  			radius.lat = map.getCenter().lat();
		  			radius.lng = map.getCenter().lng();
		  			updateRadDeg(radius.rad);
		  			drawCircle();
		  			updateBounds();
		  			clearDistance('rad');
		  		} else {
		  			drawCircle();
		  		}
		  		setQ();
		  	});
		  	$('#slider-radius').on("slidestop", function() {
		  		if (radius.set) {
		  			updateRadDeg(radius.rad);
		  			drawCircle();
		  			updateBounds();
		  			execRepOffset = 0;
		  			setQ();
		  		}
	  	});
	  	
	  	
	  	/* POLYGONS */
	  	
	  	$('#polyfilter').change(function() {
	  		this.checked ? polyfilter = true : polyfilter = false;
	  		if (!polyfilter) {
	  			clearPolygons();
	  			drawingManager.setOptions({
	  				drawingControl: false
	  			});
	  			drawingManager.setDrawingMode(null);
	  		} else {
	  			drawingManager.setOptions({
	  				drawingControl: true
	  			});
	  			drawingManager.setDrawingMode('polygon');
	  			clearDistance('poly');
	  		}
	  		execRepOffset = 0;
	  		setQ();
	  	});
	  	
	  	
	  	/* TEXT SEARCH */
	  	
	  	$('#search-green').searchMeme({
	  		onSearch: function(searchText) {
	  			setTimeout(function() {
	  				$('#search-green').searchMeme({
	  					searchComplete: true
	  				});
	  			}, 3000);
	  			searchInput = searchText;
	  			execRepOffset = 0;
	  			setQ();
	  		},
	  		buttonPlacement: 'right',
	  		button: 'green'
	  	});
	  	
	  	/* AGEB CHOROPLETH */
	  	
	  	$('#ageb-choropleth').change(function() {
	  		this.checked ? choro = true : choro = false;
	  		setQ();
	  	});
	  	
	  	/* MARKER CLUSTER & BUBBLE VIEWS */
	  	
	  	$('#cluster').change(function() {
	  		this.checked ? mapcluster = true : mapcluster = false;
	  		mapcluster ? $("#clusterImg").attr("src", "images/bt-group.png") : $("#clusterImg").attr("src", "images/bt-ungroup.png");
	  		execRepOffset = 0;
	  		setQ();
	  	});
	  	$('#bubbles').change(function() {
	  		this.checked ? bubbles = true : bubbles = false;
	  		execRepOffset = 0;
	  		setQ();
	  	});
	  
	  });
	  
	  
	  /* SET Q */
	  /* QUERY CONSTRUCTOR + CARTODB CALL*/
	  function setQ(){
var auxMun = false;   //helper for querying polygons
var auxWhere = false; //helper for adding 'where' to the query
var auxInter = false; //helper for inter-filtering '(' and ')' toggling
(mun.mty || mun.sp || mun.sn || mun.sc || mun.gpe || mun.apo || mun.esc || mun.jua || mun.gar || mun.cad || mun.stg) ? auxMun = true : auxMun = false;

// Query setup
if(auxMun) { _query="SELECT "+table_name+".* FROM "+table_name+", "+area_name+" WHERE ST_Intersects("+table_name+".the_geom, "+area_name+".the_geom)"; auxWhere = true;}
else  _query="SELECT * FROM "+table_name+"";


/* CATEGORIES */
if (categories.avisos){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%AVISOS%'" ; auxWhere=true; auxInter=true;} 
if (categories.eventos){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%EVENTO%'" ; auxWhere=true; auxInter=true;} 
if (categories.observador){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%OBSERVADOR%'" ; auxWhere=true; auxInter=true;} 
if (categories.mtymuybien){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%MTYMUYBIEN%'" ; auxWhere=true; auxInter=true;} 
if (categories.pcomunidad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%COMUNIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.pseguridad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SEGURIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.pservicios){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SERV PUBLICOS%'" ; auxWhere=true; auxInter=true;} 
if (categories.pvialidad){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%PROPUESTA VIALIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.incendio){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%INCENDIO%'" ; auxWhere=true; auxInter=true;} 
if (categories.robo){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ROBO%'" ; auxWhere=true; auxInter=true;} 
if (categories.sitriesgo){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%RIESGO%'" ; auxWhere=true; auxInter=true;} 
if (categories.alcantarillas){if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ALCANTARILLA%'" ; auxWhere=true; auxInter=true;} 
if (categories.alumbrado){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ALUMBR%'" ; auxWhere=true; auxInter=true;} 
if (categories.electricidad){ if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ELECTRICIDAD%'" ; auxWhere=true; auxInter=true;} 
if (categories.fuga){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%FUGA%'" ; auxWhere=true; auxInter=true;} 
if (categories.parques){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%PARQUES%'" ; auxWhere=true; auxInter=true;} 
if (categories.basura){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%BASURA%'" ; auxWhere=true; auxInter=true;} 
if (categories.accidente){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%ACCIDENTE%'" ; auxWhere=true; auxInter=true;} 
if (categories.bache){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%BACHE%'" ; auxWhere=true; auxInter=true;} 
if (categories.obras){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%OBRAS%'" ; auxWhere=true; auxInter=true;} 
if (categories.semaforo){ 	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%SEMAFORO%'" ; auxWhere=true; auxInter=true;} 
if (categories.emergencias){	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".post_cat ilike '%EMERGENCIA%'" ; auxWhere=true; auxInter=true;} 
if (auxInter) {_query+=")"; auxInter = false}; 

/* DATES */  
if (dates.calendario) {
	if (auxWhere) {
		_query += " AND ("
	} else {
		_query += " WHERE (";
	}
	_query += "(" + table_name + ".created_at at time zone '" + TZ + "' BETWEEN ('" + desde + "') AND (DATE '" + hasta + "' + 1))";
	auxWhere = true;
	auxInter = true;
}
							  
if (dates.sietedias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now() at time zone '"+TZ+"')-"+table_name+".created_at at time zone '"+TZ+"') < INTERVAL '7 day'" ; auxWhere=true; auxInter=true; }
if (dates.quincedias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now() at time zone '"+TZ+"')-"+table_name+".created_at at time zone '"+TZ+"') < INTERVAL '15 day'" ; auxWhere=true; auxInter=true; }
if (dates.treintadias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now() at time zone '"+TZ+"')-"+table_name+".created_at at time zone '"+TZ+"') < INTERVAL '30 day'" ; auxWhere=true; auxInter=true;}
if (dates.noventadias){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now() at time zone '"+TZ+"')-"+table_name+".created_at at time zone '"+TZ+"') < INTERVAL '90 day'" ; auxWhere=true; auxInter=true; }  
if (auxInter) {_query+=")"; auxInter = false;};

/* DAYS */
if (dates.domingo){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 0" ; auxWhere=true; auxInter=true; }  
if (dates.lunes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 1" ; auxWhere=true; auxInter=true; }  
if (dates.martes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 2" ; auxWhere=true; auxInter=true; }  
if (dates.miercoles){ 	if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 3" ; auxWhere=true; auxInter=true; }  
if (dates.jueves){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";}  
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 4" ; auxWhere=true; auxInter=true; }  
if (dates.viernes){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";}  
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 5" ; auxWhere=true; auxInter=true; }  
if (dates.sabado){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+="EXTRACT(dow FROM "+table_name+".created_at) = 6" ; auxWhere=true; auxInter=true; } 
if (auxInter) {_query+=")";auxInter = false;};

/* HOURS */
if (dates.ulthoras){ 		if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+="((now() at time zone '"+TZ+"')-"+table_name+".created_at at time zone '"+TZ+"') < INTERVAL '"+ valUltHoras +" hour'" ; auxWhere=true; auxInter=true; }
if (auxInter) {_query+=")"; auxInter = false;};
if (dates.horasdeldia){ 	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+= queryhorasdeldia; auxWhere=true; auxInter=true; }
if (auxInter) {_query+=")"; auxInter = false;};


/* REP STATUS */
if (repStatus.open){ 		    if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%read%'" ; auxWhere=true; auxInter=true;} 
if (repStatus.closed){ 		if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%closed%' AND "+table_name+".close_fail = false" ; auxWhere=true; auxInter=true;}
if (repStatus.closed_fail){	if (auxWhere) {if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} else {_query+=" WHERE (";} 
							_query+=""+table_name+".status ilike '%closed%' AND "+table_name+".close_fail = true" ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//VOTES
if (repDetail.voto){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".votes >= "+ totalvotos ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//STAR RATING
if ( repDetail.star){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".stars >= "+ totalstar ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

//ASSETS
if ( repDetail.asset){	if (auxWhere) {_query+=" AND (" } else {_query+=" WHERE (";} 
							_query+=table_name+".assets != '[]'" + " AND " + table_name+".assets not ilike '%citivox%'"; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};

/* POLYGON */ 
if (radius.set){	
 if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
 _query+=" ST_Intersects("+table_name+".the_geom,ST_Buffer( ST_SetSRID('POINT(" + radius.lng + " " + radius.lat + ")'::geometry , 4326)" + "," + radDeg + "))"; 
 if (polyfilter && shapesArray.length >0){	
     _query+=" OR ";
     var _q,lnglato;
     if (shapesArray.length==1) _q='POLYGON(';
     else _q='MULTIPOLYGON(';
     
     for(var i = 0; i < shapesArray.length; i++){
         if (i!=0) _q+=',';
         if (shapesArray.length==1) _q+='('; else _q+='((';
         
         shapesArray[i].getPath().forEach(function(xy, j) {
          if (j == 0 ){lnglato=xy.lng() + ' ' + xy.lat();;}
          _q+= xy.lng() + ' ' + xy.lat() + ',';
         });
         _q+=lnglato;
         if (shapesArray.length==1) _q+=')'; else _q+='))';
         
     }
     _query+=" ST_Intersects("+table_name+".the_geom,ST_GeomFromText('"+ _q +")',4326))";
  }  
  auxWhere=true; auxInter=true;
} 
if (auxInter) {_query+=")"; auxInter = false};
/* CUSTOM POLYGON IN CASE RAD IS NOT SET*/
if (polyfilter && shapesArray.length >0 && !radius.set){	
 if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
 var _q,lnglato;
 if (shapesArray.length==1) _q='POLYGON(';
 else _q='MULTIPOLYGON(';
 
 for(var i = 0; i < shapesArray.length; i++){
     if (i!=0) _q+=',';
     if (shapesArray.length==1) _q+='('; else _q+='((';
     
     shapesArray[i].getPath().forEach(function(xy, j) {
      if (j == 0 ){lnglato=xy.lng() + ' ' + xy.lat();;}
	  _q+= xy.lng() + ' ' + xy.lat() + ',';
	 });
	 _q+=lnglato;
	 if (shapesArray.length==1) _q+=')'; else _q+='))';
	 
 }
	 _query+=" ST_Intersects("+table_name+".the_geom,ST_GeomFromText('"+ _q +")',4326))";
	 auxWhere=true; auxInter=true;
} 
if (auxInter) {_query+=")"; auxInter = false};

/* SEARCH INPUT */
if(searchInput != "") {
if (auxWhere) {_query+=" AND ("} else {_query+=" WHERE (";} 
		_query+=" "+table_name+".post_content ilike '%"+ searchInput  +"%' OR "+table_name+".ticket ilike '%"+ searchInput  +"%' OR "+table_name+".formatted_address ilike '%"+ searchInput  +"%')";
	//searchInput = "";  Moved to the end of SetQ
}


/* MUN */ 
if (mun.mty){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}}
								_query+=""+area_name+".name = 'MTY'" ; auxWhere=true; auxInter=true;} 
if (mun.sp){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'SP'" ;auxWhere=true; auxInter=true;} 
if (mun.sn){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'SN'" ; auxWhere=true; auxInter=true;} 
if (mun.sc){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  						        _query+=""+area_name+".name = 'SC'" ; auxWhere=true; auxInter=true;} 
if (mun.gpe){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'GPE'";auxWhere=true; auxInter=true;} 
if (mun.apo){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'APO'" ; auxWhere=true; auxInter=true;} 
if (mun.esc){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'ESC'" ; auxWhere=true; auxInter=true;} 
if (mun.jua){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'JUA'" ; auxWhere=true; auxInter=true;} 
if (mun.gar){		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'GAR'" ; auxWhere=true; auxInter=true;}
if (mun.stg){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'STG'" ; auxWhere=true; auxInter=true;}
if (mun.cad){ 		if (auxWhere) { if(auxInter) {_query+=" OR ";} else {_query+=" AND ("}} 
  								_query+=""+area_name+".name = 'CAD'" ; auxWhere=true; auxInter=true;}
if (auxInter) {_query+=")"; auxInter = false};




/* MAP LAYER OR ACTIVE VIEW UPDATE */
$('#report-content:visible').hide('fold', {}, 400);  // hide report if visible
$('#infowindow:visible').hide('fold', {}, 400);      // hide infowindow if visible
_geoq = _query;
if(closedistance) _geoq += " ORDER BY "+table_name+".the_geom <-> ST_SetSRID(ST_MakePoint("+myLon+","+myLat+"),4326) ASC LIMIT "+closeByReports+"";
checkOptions.q=_geoq;
console.log(checkOptions);
// AT THIS POINT QUERY IS COMPLETE
console.log("MAIN Q");
console.log(_geoq);
if (activeView == 'home'){
	layers[1].hide();
	if ( repDetail.voto){	
		if (mapcluster) {layers[0].setOptions({query: _geoq,tile_style: _tile_style_cluster,interactivity: _interactivity});
				if(polyfilter&&(shapesArray.length==0))layers[0].hide();
				else {layers[0].show();
					document.getElementById("CICCheck").style.display = 'block';
				}
				}
		else {layers[0].setOptions({query: _geoq,tile_style: _tile_style,interactivity: _interactivity});
				if(polyfilter&&(shapesArray.length==0))layers[0].hide();
				else {layers[0].show();
					document.getElementById("CICCheck").style.display = 'block';
				}
				}
		if (bubbles) {layers[0].setOptions({query: _geoq,tile_style: _tile_style_bubbles,interactivity: _interactivity});
				if(polyfilter&&(shapesArray.length==0))layers[0].hide();
				else {layers[0].show();
					document.getElementById("CICCheck").style.display = 'block';
				}
				
				}
	}else if(mapcluster) {
		layers[0].setOptions({query: _geoq,tile_style: _tile_style_cluster,interactivity: _interactivity});
		if(polyfilter&&(shapesArray.length==0))layers[0].hide();
		else {layers[0].show();
			document.getElementById("CICCheck").style.display = 'block';
			}
	}else {layers[0].setOptions({query: _geoq,tile_style: _tile_style,interactivity: _interactivity});
		if(polyfilter&&(shapesArray.length==0))layers[0].hide();
		else {layers[0].show();
			document.getElementById("CICCheck").style.display = 'block';
			}
		}  
}else if (activeView == 'agebUrbano'){
	layers[0].hide();
	drawAgeb(_geoq, "agebUrbano");
}else if (activeView == 'heat'){
	layers[1].hide();
	layers[0].setOptions({query: _geoq,tile_style: _heatmap_style,interactivity: _interactivity}); 
}else if (activeView == 'intensity'){
	layers[1].hide();
	layers[0].setOptions({query: _geoq,tile_style: _intensity_style,interactivity: _interactivity}); 
}else if(activeView == 'torque'){
	layers[1].hide();
	displayTorque(_geoq);
}else if(activeView == 'wordle'){
	layers[1].hide();
	displayWordle(_geoq);
}else if(activeView == 'stats'){
	layers[1].hide();
	displayStats(_query);
}else if(activeView == 'trends'){
	layers[1].hide();
	displayTrends(_query);
}else if(activeView == 'occur'){
	layers[1].hide();
	displayOccurrence(_query);
}else if(activeView == 'execrep'){
	layers[1].hide();
	displayExecRep(_geoq);
}	 
/* COUNTER UPDATE */
var str=_geoq;
var n;
if (auxMun) n=str.replace("SELECT "+table_name+".* FROM "+table_name+", "+area_name+"","SELECT COUNT("+table_name+".*) FROM "+table_name+", "+area_name+"");
else n=str.replace("SELECT * FROM "+table_name+"","SELECT COUNT (*) FROM "+table_name+"");

if (closedistance) n = _geoq;
sql.execute(n).done(function(data) {
    var result;
		if (closedistance) result = data.total_rows;
		else for (var i = 0; i < data.total_rows; i++) { result = data.rows[i].count;} 
		$( "#counterVal" ).val(addCommas(result));
}).error(function(errors) {});

if (auxMun) n=str.replace("SELECT "+table_name+".* FROM "+table_name+", "+area_name+"","SELECT "+table_name+".post_cat, COUNT("+table_name+".*) FROM "+table_name+", "+area_name+"");
else n=str.replace("SELECT * FROM "+table_name+"","SELECT "+table_name+".post_cat, COUNT (*) FROM "+table_name+"");
n+=" GROUP BY "+table_name+".post_cat";
if (closedistance) n = "WITH data AS ("+_geoq+") SELECT post_cat, COUNT(*) FROM data GROUP BY post_cat ORDER BY post_cat ASC";
sql.execute(n).done(function(data) {
		updateCounters(data);
}).error(function(errors) {});


/* ACTIVE FILTERS UPDATE */  
updateActiveFilters();

/* RESET THE SEARCH INPUT */
searchInput = "";
	   }
</script>
  	
		<!--				****
		****				****
		START OF HTML DEFINITION 
		****				****
		****				*-->


  	<!-- CSS-DOCK MENUS -->	
	<div class="dock">
		<!--top dock -->
		<a href="http://cic.mx"><img src="images/cic.png" style="width:auto; z-index:11; position:absolute; top:2px; left:20px; height:35px; "/></a>
		<div id="socialshare" style="width:auto; z-index:11; position:absolute; top:1px; left:125px;"></div>
		<ul class="dock" id="dock">
			<div class="dock-container" data-step="1" data-intro="Este es el menú de vistas, con cada uno de los botones aquí, puedes cambiar el despliegue central de la página. Da clic en siguiente para ver la descripción de cada elemento." >
			    <li class="active"><a class="dock-item" onclick="if (activeView != 'home' || getUrlVars()) changeView('home')"  style="margin-left:0;"><img src="images/bt-home.png" data-step="2" data-intro="Este botón te llevará al despliegue inicial en su vista agrupada. Si deseas desagrupar los marcadores en el mapa puedes desactivar el selector en la parte inferior derecha." data-position="bottom"/><span>Inicio</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'heat') changeView('heat');" style="margin-left:40;"><img src="images/bt-heatmap.png" data-step="3" data-intro="Este botón te llevará al despliegue en mapa de calor de la información que tengas filtrada. Con esta herramienta podrás encontrar focos de interés alrededor de la ciudad." data-position="bottom"/><span>Mapa de Calor</span></a></li>			            <li><a class="dock-item" onclick="if (activeView != 'intensity') changeView('intensity')" style="margin-left:80;"><img src="images/bt-intensity.png" data-step="4" data-intro="Este botón te llevará al despliegue de radios de influencia, permitiéndote observar la permeabilidad de los eventos que ocurren en la ciudad." data-position="bottom"/><span>Radios de influencia</span></a></li>   
				<li><a class="dock-item" onclick="if (activeView != 'torque') changeView('torque')" style="margin-left:120;"><img src="images/bt-play.png" data-step="5" data-intro="Este botón te llevará al despliegue animado, en el cual podrás observar como ocurren en el tiempo los diversos incidentes que se reportan al CIC." data-position="bottom"/><span>Mapa Animado</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'occur') changeView('occur')"style="margin-left:160;"><img src="images/bt-occur.png" data-step="6" data-intro="Este botón te llevará al despliegue de reincidencias, buscando facilitarte el entendimiento de en qué día y a qué hora ocurren diversos eventos en la ciudad." data-position="bottom"/><span>Incidencia Día/Hora</span></a> </li>
				<li><a class="dock-item" onclick="if (activeView != 'trends') changeView('trends')"style="margin-left:200;"><img src="images/bt-trends.png" data-step="7" data-intro="Este botón te llevará al gráfico de las tendencias de reporteo ciudadano. En él podrás apreciar qué eventos van en creciente." data-position="bottom"/><span>Históricos</span></a> </li>
				<li><a class="dock-item" onclick="if (activeView != 'stats') changeView('stats')" style="margin-left:240;"><img src="images/bt-stats.png" data-step="8" data-intro="Este botón te llevará al gráfico por municipios, pudiendo observar de manera comparativa lo que se reporta al CIC en nuestra área metropolitana." data-position="bottom"/><span>Inicidencia por Municipios</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'score') changeView('score')" style="margin-left:280;"><img src="images/bt-score.png" data-step="9" data-intro="Este botón te llevará al despliegue calificativo en el desempeño municipal para resolución de problemas con servicios públicos." data-position="bottom"/><span>Scorecard Municipal</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'wordle') changeView('wordle')" style="margin-left:320;"><img src="images/bt-wordle.png" data-step="10" data-intro="Este botón te llevará al despliegue gráfico de la red de conversación más relevante que se presenta en las redes sociales de nuestra ciudad acorde al tema de tu interés." data-position="bottom"/><span>Red de Conversación</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'twitter') changeView('twitter')" style="margin-left:360;"><img src="images/bt-twitter.png" data-step="11" data-intro="Este botón te llevará al despliegue de la red de ciudadanos en Twitter, que se mantienen activos y nutren la información que traemos para ti en este espacio." data-position="bottom"/><span>Red de Ciudadanos</span></a></li> 
				<li><a class="dock-item" onclick="if (activeView != 'execrep') changeView('execrep')" style="margin-left:400;"><img src="images/bt-execrep.png" data-step="12" data-intro="Finalmente, este botón te llevará al despliegue en formato de lista de reportes según hayas utilizado los filros." data-position="bottom"/><span>Listado de Reportes</span></a></li>
				<li><a class="dock-item" onclick="if (activeView != 'agebUrbano') changeView('agebUrbano')" style="margin-left:440;"><img src="images/bt-ageb.png" data-step="13" data-intro="Este botón te llevará al despliegue de agebs urbanos segun INEGI." data-position="bottom"/><span>AGEBs Urbanos</span></a></li> 
			</div> 
		</ul>
		
		<div id="dockRight" >
			<!-- <a href="http://tehuan.cic.mx/notificaciones-cic/" target="blank" style="text-decoration:none;"><img src="images/bt-flag.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:75px;" data-step="20" data-intro="También te brindamos la opción de suscribirte a las notificaciones con este botón." data-position="left"/><span style="top: 35px; right: 45px;">Notificaciones</span></a> -->
			<a href="http://www.cic.mx/?p=50" target="blank"  style="text-decoration:none;"><img src="images/bt-newrep.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:33px;" data-step="21" data-intro="Y, por último con este botón podrás crear un nuevo reporte desde este mismo espacio, contribuyendo así con una mayor participación ciudadana. Otras formas de contribuir las tendrás al darle un clic a los marcadores en el mapa, pudiendo votar por los reportes creando una suma de voces, podrás comentar en ellos, compartirlos en tus redes sociales, y calificarlos según tu opinión." data-position="left"/><span style="top: 35px; right: 5px;">Crear Reporte</span></a>
			<a href="#" onclick="introJs().start()"><img src="images/bt-help.png" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:-2px;"/></a>
			<div  class="wrapper" style="height:28px; width:auto; z-index:11; position:absolute; top:7px; right:78px;" data-step="19" data-intro="Adicionalmente, en este apartado te proveemos la oportunidad de buscar texto o tickets de reportes que te interesen." data-position="left"><input type="text" id="search-green" />
			</div>
        </div>
		
		<!--bottom dock -->
		<ul class="dock" id="dock2">
		<div class="dock-container2" data-step="13" data-intro="De manera paralela, en esta sección inferior se encuentran los diversos filtros que podrás activar para poder cruzar la información de tu interés e ir a encontrar hasta el más específico detalle." data-position="top">
		<li class="active"><a class="dock-item2" href="" id="slide-cate" style="margin-left:0;"><span> Categorías</span><img src="images/bt-categories.png" data-step="14" data-intro="Este botón te desplegará el panel de filtrado por categorías, pudiendo seleccionar tantas como te interese." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-date" style="margin-left:40;"><span> Fecha</span><img src="images/bt-calendar.png" data-step="15" data-intro="Este botón te desplegará el panel de filtrado por fechas, pudiendo seleccionar últimos días, calendarios, y hasta rango de horas de interés." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-muni" style="margin-left:80;"><span> Municipio</span><img src="images/bt-municip.png"/data-step="16" data-intro="Este botón te desplegará el panel de filtrado por municipios del área metropolitana, facilitando la comparación entre ellos." data-position="top"></a></li> 
		<li><a class="dock-item2" href="" id="slide-stat" style="margin-left:120;"><span> Detalle de Reporte</span><img src="images/bt-lock.png" data-step="17" data-intro="Este botón te desplegará el panel de filtrado por estado de reporte, además de los adicionales de los mismos, pudiendo filtrar por ejemplo todos aquellos que tengan foto." data-position="top"/></a></li> 
		<li><a class="dock-item2" href="" id="slide-dist" style="margin-left:160;"><span> Distancia</span><img src="images/bt-polygon.png"/data-step="18" data-intro="Finalmente, este botón te desplegará el panel de filtrado por radios de distancia en un cierto punto, polígonos que tú denotes, y hasta por tu ubicación geográfica actual." data-position="top"></a></li> 
		</div>
		</ul>
		<div class='cluster' style="position: absolute; bottom: 8px; right: 35px; z-index:15;">	
				<input type="checkbox" id="cluster" class="switch" style="display: none;" title="Agrupar/Desagrupar" checked/>
				<label for="cluster" style="font-weight: bold; color: #FFF;"><img id="clusterImg" src="images/bt-group.png" style="height:20px; width:auto; z-index:11; "/></label>
		</div>
		
		<button type="button" class="ageb-bt" id="buttonAgeb" onclick="showAgebslide();" disabled>AGEB</button>
		
		<div id="legendAgeb" class="rbow2" style="display:none;">
			<ul>
				<li class="q1-3"></li>
				<li class="q2-3"></li>
				<li class="q3-3"></li>
			</ul>
			<p id="upperAgeb" class="more"></p>
			<p id="lowerAgeb" class="less"></p>
		</div>
		
		<div id="ageb-chorodiv" style="display:none;position: absolute; bottom: 8px; right: 10%; z-index:15;">	
			<input type="checkbox" id="ageb-choropleth" class="switch" style="display: none;" title="Choropleth" />
			<label for="ageb-choropleth" style="font-weight: bold; color: #FFF;"><img id="clusterImg" src="images/choropleth.png" style="height:20px; width:auto; z-index:11; "/></label>
		</div>





		
</div>
   
	<!-- TOP-DOCK SUBMENUS -->
	<div>
	
	</div>
	
	
	<!-- VIEWS -->
	<div>
		<div id="map" style="width:100%; height: 95%; top: 35px;" onclick="fade('showSlides')"></div>
		<div id="_panel" style="position: absolute;top: 60px;left: 260px;margin-left: -180px;z-index: 5;padding: 5px;">
				<input id="address" type="textbox" value="" placeholder='Buscar ubicación...' onkeydown="if (event.keyCode == 13) codeAddress();" style="height:20; border-radius: 2px 0 0 2px; box-shadow: 0 4px 6px rgba(0,0,0,0.6);width: 160px;"> 
				<input type="button" value="" onclick="codeAddress()" style="background-color: #163D74;border: 0;background-image: url(images/icon-search.png);border-radius: 0 2px 2px 0;box-shadow: 0 4px 6px rgba(0,0,0,0.6);text-align: center;vertical-align: top;width: 25px;color: white;height:20;margin-left:-5px;cursor:pointer;">
		</div>
		
        <div id="torque" style="width:100%; height: 100%; display:none; background-color:#163D74; opacity:0.9; top: 35px;" >
			<div id="map_canvas" style="width:100%; height: 95%; top: 35px;" onclick="fade('showSlides')"></div>
			<div class="torque_time" style="color:#FFF; font-size:16px; position:absolute; right:167px; bottom:70px; z-index:6; font-size:16px"></div>
			<div class="torqueslide"><div id="torque-slider"></div></div>
        </div>
        
		<div id='occur' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
				<div id="containeroccu" > 
					<center>
						<div id="legend" class="rbow2">
							<ul>
								<li class="q1-11"></li>
								<li class="q2-11"></li>
								<li class="q3-11"></li>
								<li class="q4-11"></li>
								<li class="q5-11"></li>
								<li class="q6-11"></li>
								<li class="q7-11"></li>
								<li class="q8-11"></li>
								<li class="q9-11"></li>
								<li class="q10-11"></li>
								<li class="q11-11"></li>
							</ul>
							<p class="more">más reportes</p>
							<p class="less">menos reportes</p>
						</div>
						
						<div id="vis"></div>
						
						<div id="hourly_values">
								<div class="svg"></div>
								<p class="subtitle"></p>
						</div>
					</center>
				</div>
		
	    </div>

		<div id="trends" style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center><div id="timeContainer" style="width: 70%; height: 80%; padding:60px; margin:auto;"></div>
			<div  style="width: 70%; color:white; position: absolute; left: 15%; bottom: 40px;">
		     		<input type="radio" name="consolidar" value="semanas" onclick="byweeks=true; bymonths=false; setQ();">Consolidar por Semana 
		     		<br>
			 		<input type="radio" name="consolidar" value="mes" onclick="byweeks=false; bymonths=true; setQ();">Consolidar por Mes
			 		<br>
			 		<input type="radio" name="consolidar" value="consoloff" onclick="byweeks=false; bymonths=false; setQ();"checked="checked">Sin consolidar
			 
			</div>
			</center>
		</div>
		
		<div id="stats" style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center>
			 	<div class="actions" id="actions">
			        <button class="cicswitcher" id="column">COLUMNA</button> 
			        <button class="cicswitcher" id="area">AREA</button> 
			        <button class="cicswitcher" id="line">LINEA</button> 
			        <button class="cicswitcher" id="spline">SPLINE</button> 
			        <button class="cicswitcher" id="areaspline">AREA+SPLINE</button>
			     </div>
			<div id="columnContainer" style="width: 70%; height: 80%; margin:auto;"></div>
			<div  style="width: 70%; color:white; position: absolute; left: 15%; bottom: 40px;">
		     		<input type="radio" name="norm" value="pob" onclick="normalpob=true; normalkm=false;setQ();">Normalizar por cada 100k Habitantes 
		     		<br>
			 		<input type="radio" name="norm" value="km" onclick="normalkm=true; normalpob=false;setQ();">Normalizar por Km<sup>2</sup>
			 		<br>
			 		<input type="radio" name="norm" value="none" onclick="normalkm=false; normalpob=false;setQ();" checked="checked">Sin Normalizar
			</div>
			</center>
			<div  style="color:white; position: absolute; left: 15%; bottom: 40px;">
		     		<input type="radio" name="mun" value="muncons" onclick="muncons=true; setQ();">Consolidar categorias 
		     		<br>
			 		<input type="radio" name="mun" value="nomunscons" onclick="muncons=false; setQ();"checked="checked">Sin consolidar
			</div>
		</div>
		
		<div id='score' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')"><center>
				 <div class="actions" id="actions">
			        <button class="cicswitcher" id="column">COLUMNA</button> 
			        <button class="cicswitcher" id="area">AREA</button> 
			        <button class="cicswitcher" id="line">LINEA</button> 
			        <button class="cicswitcher" id="spline">SPLINE</button> 
			        <button class="cicswitcher" id="areaspline">AREA+SPLINE</button>
			     </div>
				 <div id="chart0" style="width: 70%; max-height: 80%; margin:auto;"></div>
				  <div id="accordion">
				          <h3>Resumen Comparativo</h3>
				          <div>
				                <div id="chartRC" class="chart"></div>
				          </div>

					  	  <h3 >Municipio de Monterrey</h3>
				          <div>
				                <div id="chartMTY1" class="chart"></div>
				
				                <div id="chartMTY2" class="chart"></div>
				
				                <div id="chartMTY3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de San Pedro Garza García</h3>
				          <div>
				                <div id="chartSP1" class="chart"></div>
				
				                <div id="chartSP2" class="chart"></div>
				
				                <div id="chartSP3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de San Nicolás de los Garza</h3>
				          <div>
				                <div id="chartSN1" class="chart"></div>
				
				                <div id="chartSN2" class="chart"></div>
				
				                <div id="chartSN3" class="chart"></div>
				            </div>
				          
				          <h3>Municipio de Guadalupe</h3>
				          <div>
				                <div id="chartGPE1" class="chart"></div>
				
				                <div id="chartGPE2" class="chart"></div>
				
				                <div id="chartGPE3" class="chart"></div>
				            </div>
				            
				          <h3>Municipio de General Escobedo</h3>
				          <div>
				                <div id="chartESC1" class="chart"></div>
				
				                <div id="chartESC2" class="chart"></div>
				
				                <div id="chartESC3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Apodaca</h3>
				          <div>
				                <div id="chartAPO1" class="chart"></div>
				
				                <div id="chartAPO2" class="chart"></div>
				
				                <div id="chartAPO3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Santa Catarina</h3>
				          <div>
				                <div id="chartSC1" class="chart"></div>
				
				                <div id="chartSC2" class="chart"></div>
				
				                <div id="chartSC3" class="chart"></div>
				            </div>
				
				          <h3>Municipio de Juárez</h3>
				          <div>
				                <div id="chartJUA1" class="chart"></div>
				
				                <div id="chartJUA2" class="chart"></div>
				
				                <div id="chartJUA3" class="chart"></div>
				            </div>
				            
				          <h3>Municipio de Cadereyta Jiménez</h3>
				          <div>
				                <div id="chartCAD1" class="chart"></div>
				
				                <div id="chartCAD2" class="chart"></div>
				
				                <div id="chartCAD3" class="chart"></div>
				          </div>
				          
				          <h3>Municipio de García</h3>
				          <div>
				                <div id="chartGAR1" class="chart"></div>
				
				                <div id="chartGAR2" class="chart"></div>
				
				                <div id="chartGAR3" class="chart"></div>
				          </div>
				          
				          <h3>Municipio de Santiago</h3>
				          <div>
				                <div id="chartSTG1" class="chart"></div>
				
				                <div id="chartSTG2" class="chart"></div>
				
				                <div id="chartSTG3" class="chart"></div>
				          </div>
				          
				    </div>
				 </center>
		</div>
	
		<div id='wordle-container' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<!-- here wordle renders a new div with -->
		</div>
		
		<div id="twitter" style="width:100%; height: 100%; display:none; background-color:#163D74; opacity:0.9; top: 35px;">
			<center>
				<div id="twitterContent" style="padding: 60px; position:absolute; max-height:80%; overflow-y:auto!important;"></div>
		    </center>
        </div>
        
        <div id='execrep' style="width:100%; height: 100%; background-color:#163D74; opacity:0.9; display:none; position:fixed;
	overflow-y:auto!important;" onclick="fade('showSlides')">
			<center>
				<div id="execRepContent" style="top: 40px; bottom: 60px; position:absolute; height:100%; width:100%; overflow-y:auto!important; position:fixed"></div>
			</center>
		</div>
	</div>
		
	<!-- PAGESLIDES -->
	<div>   
		<div class="reportslide" id="report-content" style="right:265px!important;">
		<div id="disqus_thread"></div>
	</div>
	
	<div class="agebslide" id="ageb-content">
		<div id="ageb_title" >
			<h2 id="ageb-clave"></h2>
			<h3 id="ageb-belong"></h3>
		</div>
		
		<div id="ageb_pob" class="ageb-chart"></div>
		<br>
		<div id="ageb_eco" class="ageb-chart"></div>
		<br>
		<div id="ageb_edu" class="ageb-chart"></div>
		<br>
		<div id="ageb_viv" class="ageb-chart"></div>
	
	</div>
	
	<div id="counterOverlay">
		<div class="counterslide" id="counter" onclick="if ($('.countersslide').is(':visible')){$('.countersslide').hide('fold', {}, 400);}else{$('.countersslide').show('fold', {}, 400);}"  style="width:auto;">
	    <div>
			<input type="text" id="counterVal" class="rangevalue" style="width:auto; text-align:center; font-size:16px;"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="margin-right:294px;">
	    <div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/avisos.jpg" Title="AVISOS">
			<input type="text" id="counterVal_avisos" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="AVISOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/eventos.jpg" Title="EVENTO PÚBLICO">
			<input type="text" id="counterVal_eventos" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="EVENTO PÚBLICO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/observador.png" Title="OBSERVADOR CIUDADANO">
			<input type="text" id="counterVal_observador" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="OBSERVADOR CIUDADANO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pcomunidad.jpg" Title="PROPUESTA COMUNIDAD">
			<input type="text" id="counterVal_pcomunidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA COMUNIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pseguridad.jpg" Title="PROPUESTA SEGURIDAD">
			<input type="text" id="counterVal_pseguridad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA SEGURIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pservicios.jpg" Title="PROPUESTA SERVICIOS">
			<input type="text" id="counterVal_pservicios" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PROPUESTA SERVICIOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/pvialidad.jpg" Title="PROPUESTA VIALIDAD">
			<input type="text" id="counterVal_pvialidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;"Title="PROPUESTA VIALIDAD"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="margin-right:147px;">
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/incendio.jpg" Title="INCENDIO">
			<input type="text" id="counterVal_incendio" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="INCENDIO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/robo.jpg" Title="ROBO">
			<input type="text" id="counterVal_robo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ROBO"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/sitriesgo.jpg" Title="SITUACIÓN DE RIESGO">
			<input type="text" id="counterVal_sitriesgo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="SITUACIÓN DE RIESGO"disabled/>
		</div>
		
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/accidente.jpg" Title="ACCIDENTE">
			<input type="text" id="counterVal_accidente" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ACCIDENTE" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/bache.jpg" Title="BACHE">
			<input type="text" id="counterVal_bache" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="BACHE" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/obras.jpg" Title="OBRA O VÍA CERRADA">
			<input type="text" id="counterVal_obras" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="OBRA O VÍA CERRADA"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/semaforo.jpg" Title="SEMÁFORO DESCOMPUESTO">
			<input type="text" id="counterVal_semaforo" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="SEMÁFORO DESCOMPUESTO"disabled/>
		</div>
	</div>
		<div class="countersslide" onclick="$('.countersslide').hide('fold', {}, 400);"  style="">
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/alcantarillas.jpg" Title="ALCANTARILLAS">
			<input type="text" id="counterVal_alcantarillas" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ALCANTARILLAS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-top" width="17" height="17" src="images/alumbrado.jpg" Title="ALUMBRADO PÚBLICO">
			<input type="text" id="counterVal_alumbrado" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="ALUMBRADO PÚBLICO" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/electricidad.jpg" Title="FALTA ELECTRICIDAD">
			<input type="text" id="counterVal_electricidad" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="FALTA ELECTRICIDAD"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/fuga.jpg" Title="FUGA">
			<input type="text" id="counterVal_fuga" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="FUGA"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/parques.png" Title="PARQUES DESCUIDADOS">
			<input type="text" id="counterVal_parques" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="PARQUES DESCUIDADOS"disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/basura.jpg" Title="RECOLECCIÓN DE BASURA">
			<input type="text" id="counterVal_basura" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="RECOLECCIÓN DE BASURA" disabled/>
		</div>
		<div>
			<img style="vertical-align:text-middle" width="17" height="17" src="images/emergencias.jpg" Title="EMERGENCIAS">
			<input type="text" id="counterVal_emergencias" class="rangevalue" style="width:auto; text-align:center; font-size:16px;" Title="EMERGENCIAS"disabled/>
		</div>
	</div>
	</div>
	
	<div id="filterOverlay">
		<div class="activeslide" onclick="if ($('.activesslide').is(':visible')){$('.activesslide').hide('fold', {}, 400);}else if(anyFilter){$('.activesslide').show('fold', {}, 400);}">
	    <center>
			<img style="border-radius:4px;" width="25px" height="25px" src="images/actfilter.png" alt="Ver filtros">
		</center>
	</div>
		<div class="activeslide" style="margin-left:43px;" onclick="$('.activesslide').hide('fold', {}, 400); if(anyFilter)resetFilters();">
	     <center>
			<img style="border-radius:4px;" width="25px" height="25px" src="images/remfilter.png" alt="Remover filtros">
		</center>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="">
		<div id="activeF_Cat"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:127px;">
		<div id="activeF_Dat"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:254px;">
		<div id="activeF_Mun"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:381px;">
		<div id="activeF_Sta"></div>
	</div>
		<div class="activesslide" onclick="$('.activesslide').hide('fold', {}, 400);"  style="margin-left:508px;">
		<div id="activeF_Dis"></div>
	</div>
	

<div id="mun-legend-div" class='my-legend' style="display:none">
<div class='legend-title'>Municipios</div>
<div class='legend-scale'>
  <ul id="mun-legend"class='legend-labels'></ul>
</div>
<div class='legend-source'>Fuente: <a target="_blank" href="http://cuentame.inegi.gob.mx/monografias/informacion/nl/territorio/div_municipal.aspx?tema=me&e=19">INEGI</a></div>
</div>


<div id="torqueDATGUI" style="display:none;z-index:15;position:absolute;top:0%;right:200px;">
</div>



<!--
    <div class="dropDownContainer" style="z-index: 0; position: absolute; right: 90px; top: 35px;">
        <div class="dropDownControl" id="My Box">Layers<img src="http://maps.gstatic.com/mapfiles/arrow-down.png" class="dropDownArrow"></div>

        <div class="dropDownOptionsDiv" id="myddOptsDiv" style="display: none;">
            <div class="checkboxContainer" title="This allows for multiple selection/toggling on/off">
                <div class="blankDiv" id="terrainCheck">
                    <span class="checkboxSpan"><img class="blankImg" src="http://maps.gstatic.com/mapfiles/mv/imgs8.png"></span>
                </div><label class="checkboxLabel">On/Off</label>
            </div>

            <div class="checkboxContainer" title="This allows for multiple selection/toggling on/off">
                <div class="blankDiv" id="myCheck">
                    <span class="checkboxSpan"><img class="blankImg" src="http://maps.gstatic.com/mapfiles/mv/imgs8.png"></span>
                </div><label class="checkboxLabel">my On/Off</label>
            </div>
        
        </div>
    </div>
-->



	
	
	
	</div>
	
	<div class="filterslide" id="filtercate">
	    <div style="margin-left:15px!important;">
	    	<h2 style="max-width:250px;"> Categoría </h2><br>
			<img style="padding-top:3px; padding-bottom:3px; cursor:pointer;" src="images/comunidad.png" alt="COMUNIDAD" onclick="multipleCat('COMUNIDAD')">
			<div>
				<input type="checkbox" id="avisos" class="switch" />
				<label for="avisos"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/avisos.jpg">
					&nbsp;&nbsp;Avisos
				</label>
			</div>
			<div>
				<input type="checkbox" id="eventos" class="switch" />
				<label for="eventos"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/eventos.jpg">
					&nbsp;&nbsp;Evento público
				</label>
			</div>
			<div>	
				<input type="checkbox" id="observador" class="switch" />
				<label for="observador"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/observador.png">
					&nbsp;&nbsp;Observador ciudadano
				</label>
			</div>
			<div>	
				<input type="checkbox" id="mtymuybien" class="switch" />
				<label for="mtymuybien"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mtymuybien.jpg">
					&nbsp;&nbsp;MTY muy bien
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/propuestas.png"/ alt="PROPUESTAS" onclick="multipleCat('PROPUESTAS CIUDADANAS')">
			<div>
				<input type="checkbox" id="pcomunidad" class="switch" />
				<label for="pcomunidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pcomunidad.jpg">
					&nbsp;&nbsp;Comunidad
				</label>
			</div>
			<div>
				<input type="checkbox" id="pseguridad" class="switch" />
				<label for="pseguridad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pseguridad.jpg">
					&nbsp;&nbsp;Seguridad
				</label>
			</div>
			<div>	
				<input type="checkbox" id="pservicios" class="switch" />
				<label for="pservicios"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pservicios.jpg">
					&nbsp;&nbsp;Servicios públicos
				</label>
			</div>
			<div>	
				<input type="checkbox" id="pvialidad" class="switch" />
				<label for="pvialidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/pvialidad.jpg">
					&nbsp;&nbsp;Vialidad
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/seguridad.png"/ alt="SEGURIDAD" onclick="multipleCat('SEGURIDAD')">
			<div>
				<input type="checkbox" id="incendio" class="switch" />
				<label for="incendio"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/incendio.jpg">
					&nbsp;&nbsp;Incendio
				</label>
			</div>
			<div>
				<input type="checkbox" id="robo" class="switch" />
				<label for="robo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/robo.jpg">
					&nbsp;&nbsp;Robo
				</label>
			</div>
			<div>	
				<input type="checkbox" id="sitriesgo" class="switch" />
				<label for="sitriesgo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/sitriesgo.jpg">
					&nbsp;&nbsp;Situación de riesgo
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/servicios.png"/ alt="SERVICIOS" onclick="multipleCat('SERVICIOS PUBLICOS')">
			<div>	
				<input type="checkbox" id="alcantarillas" class="switch" />
				<label for="alcantarillas"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/alcantarillas.jpg">
					&nbsp;&nbsp;Alcantarillas
				</label>
			</div>
			<div>	
				<input type="checkbox" id="alumbrado" class="switch" />
				<label for="alumbrado"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/alumbrado.jpg">
					&nbsp;&nbsp;Alumbrado
				</label>
			</div>
			<div>	
				<input type="checkbox" id="electricidad" class="switch" />
				<label for="electricidad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/electricidad.jpg">
					&nbsp;&nbsp;Falta electricidad
				</label>
			</div>
			<div>	
				<input type="checkbox" id="fuga" class="switch" />
				<label for="fuga"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/fuga.jpg">
					&nbsp;&nbsp;Fuga
				</label>
			</div>
			<div>	
				<input type="checkbox" id="parques" class="switch" />
				<label for="parques"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/parques.png">
					&nbsp;&nbsp;Parques descuidados
				</label>
			</div>
			<div>	
				<input type="checkbox" id="basura" class="switch" />
				<label for="basura"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/basura.jpg">
					&nbsp;&nbsp;Recolección de basura
				</label>
			</div>
			<img style="padding-top:6px; padding-bottom:3px; cursor:pointer;" src="images/vialidad.png"/ alt="VIALIDAD" onclick="multipleCat('VIALIDAD Y TRANSITO')">
			<div>	
				<input type="checkbox" id="accidente" class="switch" />
				<label for="accidente"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/accidente.jpg">
					&nbsp;&nbsp;Accidente
				</label>
			</div>
			<div>	
				<input type="checkbox" id="bache" class="switch" />
				<label for="bache"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bache.jpg">
					&nbsp;&nbsp;Bache o vía dañada
				</label>
			</div>
			<div>	
				<input type="checkbox" id="obras" class="switch" />
				<label for="obras"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/obras.jpg">
					&nbsp;&nbsp;Obras o vía cerrada
				</label>
			</div>
			<div>	
				<input type="checkbox" id="semaforo" class="switch" />
				<label for="semaforo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/semaforo.jpg">
					&nbsp;&nbsp;Semáforo descompuesto
				</label>
			</div>
			<img style="padding-top:3px; cursor:pointer" src="images/emergencias.png"/ alt="EMERGENCIAS" onclick="multipleCat('EMERGENCIAS')">
			<div>	
				<input type="checkbox" id="emergencias" class="switch" />
				<label for="emergencias"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/emergencias.jpg">
					&nbsp;&nbsp;Emergencias
				</label>
			</div>	
				
		</div>
	</div>
	
	<div class="filterslide" id="filterdate">
	     <div style="margin-left:15px!important; max-width:245px">
		     <h2 style="max-width:250px;"> Fecha </h2><br>
			<img style="padding-top:8px; padding-bottom:6px;" src="images/fecha.png" alt="FECHA">
		    <div>
				<input type="checkbox" id="calendario" name="checkbox" class="switch" />
				<label for="calendario">Activar calendario</label>
				<div>
					<label for="from" style="float:left; margin-top:7px; padding:2px;" >Desde</label>
					<input type="text" id="desde" class="rangevalue" style="float:right; margin-right:35%; width:auto;"/>
				</div>
				<div>
					<label for="to" style="float:left; margin-top:7px; padding:2px;" >Hasta </label>
					<input type="text" id="hasta" class="rangevalue" style="float:right; margin-right:35%; width:auto;"/>
				</div>
		    </div>
		    <div style="margin-top:3px">
				<input type="checkbox" id="sietedias" name="checkbox" class="switch"  />
				<label for="sietedias">Últimos 7 Días</label>
			</div>
			<div>	
				<input type="checkbox" id="quincedias" name="checkbox" class="switch" />
				<label for="quincedias">Últimos 15 Días</label> 
			</div>
			<div>	
				<input type="checkbox" id="treintadias" name="checkbox" class="switch" />
				<label for="treintadias">Últimos 30 Días</label> 
			</div>
			<div>	
				<input type="checkbox" id="noventadias" name="checkbox" class="switch" />
				<label for="noventadias">Últimos 90 Días</label> 
			</div>	
			<img style="padding-top:8px; padding-bottom:3px;" src="images/diario.png" alt="DIAS">
			<div style="margin-top:3px">
				<input type="checkbox" id="domingo" name="checkbox" class="switch"  />
				<label for="domingo">Domingo</label>
			</div>
			<div>	
				<input type="checkbox" id="lunes" name="checkbox" class="switch" />
				<label for="lunes">Lunes</label> 
			</div>
			<div>	
				<input type="checkbox" id="martes" name="checkbox" class="switch" />
				<label for="martes">Martes</label> 
			</div>
			<div>	
				<input type="checkbox" id="miercoles" name="checkbox" class="switch" />
				<label for="miercoles">Miércoles</label> 
			</div>
			<div>	
				<input type="checkbox" id="jueves" name="checkbox" class="switch" />
				<label for="jueves">Jueves</label> 
			</div>
			<div>	
				<input type="checkbox" id="viernes" name="checkbox" class="switch" />
				<label for="viernes">Viernes</label> 
			</div>
			<div>	
				<input type="checkbox" id="sabado" name="checkbox" class="switch" />
				<label for="sabado">Sábado</label> 
			</div>
			<img style="padding-top:8px; padding-bottom:3px;" src="images/horario.png" alt="HORARIO">
			<div>
				<input type="checkbox" id="ulthoras" name="checkbox" class="switch"/>
				<label for="ulthoras">Activar últimas horas</label>
				<input type="text" id="amountUlthoras" class="rangevalue" style="float:left; margin-right: 60%; width: 65px; text-align: center; " disabled/>
				<div id="slider-ulthoras" style="width: 126px; margin-left: 77px!important;"></div>
			</div>
			<div>
				<input type="checkbox" id="horasdeldia" name="checkbox" class="switch"/>
				<label for="horasdeldia">Activar horario de interés</label>
				<input type="text" id="amountHrsDia" class="rangevalue" style="float:left; margin-right: 60%; width: 65px; text-align: center; " disabled/>
				<div id="slider-horasdeldia" style="width: 126px; margin-left: 77px!important;"></div>
			</div>
							
			</div>	
		</div>
	
	<div class="filterslide" id="filtermuni">
	  <div style="margin-left:15px!important;">
		    <h2 style="max-width:250px;"> Municipio </h2><br>
			<img style="padding-top:3px; padding-bottom:6px; cursor:pointer;" src="images/municipio.png" alt="MUNICIPIO" onclick="multipleCat('MUNICIPIO')">
			<div>
				<input type="checkbox" id="mty" class="switch" />
				<label for="mty"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_mty.png">
					&nbsp;&nbsp;Monterrey
				</label>
			</div>
			<div>
				<input type="checkbox" id="sp" class="switch" />
				<label for="sp"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sp.png">
					&nbsp;&nbsp;San Pedro
				</label>
			</div>
			<div>
				<input type="checkbox" id="gpe" class="switch" />
				<label for="gpe"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_gpe.png">
					&nbsp;&nbsp;Guadalupe
				</label>
			</div>
			<div>
				<input type="checkbox" id="sn" class="switch" />
				<label for="sn"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sn.png">
					&nbsp;&nbsp;San Nicolás
				</label>
			</div>
			<div>
				<input type="checkbox" id="sc" class="switch" />
				<label for="sc"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_sc.png">
					&nbsp;&nbsp;Santa Catarina
				</label>
			</div>
			<div>
				<input type="checkbox" id="apo" class="switch" />
				<label for="apo"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_apo.png">
					&nbsp;&nbsp;Apodaca
				</label>
			</div>
			<div>
				<input type="checkbox" id="gar" class="switch" />
				<label for="gar"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_gar.png">
					&nbsp;&nbsp;García
				</label>
			</div>
			<div>
				<input type="checkbox" id="esc" class="switch" />
				<label for="esc"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_esc.png">
					&nbsp;&nbsp;Escobedo
				</label>
			</div>
			<div>
				<input type="checkbox" id="jua" class="switch" />
				<label for="jua"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_jua.png">
					&nbsp;&nbsp;Juárez
				</label>
			</div>
			<div>
				<input type="checkbox" id="cad" class="switch" />
				<label for="cad"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_cad.png">
					&nbsp;&nbsp;Cadereyta
				</label>
			</div>
			<div>
				<input type="checkbox" id="stg" class="switch" />
				<label for="stg"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/mun_stg.png">
					&nbsp;&nbsp;Santiago
				</label>
			</div>
		</div>
	</div>
	
	<div class="filterslide" id="filterstat">
	     <div style="margin-left:15px!important;">
		     <h2 style="max-width:250px;"> Detalle de reporte </h2><br>
			<img style="padding-top:3px; padding-bottom:6px;" src="images/repstatus.png" alt="ESTADO">
			<div>
				<input type="checkbox" id="open" class="switch" />
				<label for="open"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-open.png">
					&nbsp;&nbsp;Abierto
				</label>
			</div>
			<div>
				<input type="checkbox" id="closed" class="switch" />
				<label for="closed"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-closed.png">
					&nbsp;&nbsp;Cerrado con éxito
				</label>
			</div>
			<div>
				<input type="checkbox" id="closed_fail" class="switch" />
				<label for="closed_fail"> 
					<img style="vertical-align:text-top" width="17" height="17" src="images/bt-closed_fail.png">
					&nbsp;&nbsp;Cerrado con fallo
				</label>
			</div>
			
			<img style="padding-top:10px; padding-bottom:6px;" src="images/repmedia.png" alt="ESTADO">
			<div>
				<input type="checkbox" id="voto" class="switch" />
				<label for="voto"> 
					&nbsp;&nbsp;Votos
				</label>
			</div>
			
			<div style="margin-right: 56;float: right;margin-top: -21;">
				<input type="checkbox" id="bubbles">
				<label for="bubbles">Destacar
				</label>
			</div>
			<div>
				<input type="text" id="amountvoto" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-voto" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			
			<div>
				<input type="checkbox" id="star" class="switch" />
				<label for="star"> 
					&nbsp;&nbsp;Calificación
				</label>
				<input type="text" id="amountstar" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-star" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			<div>
				<input type="checkbox" id="asset" class="switch" />
				<label for="asset"> 
					&nbsp;&nbsp;Imágenes
				</label>
			</div>
			
		</div>
	</div>

	<div class="filterslide" id="filterdist">
	     <div style="margin-left:15px!important;">
		     <h2 style="max-width:250px;"> Distancia </h2><br>
			<img class="imgDist" src="images/mapposition.png" alt="POLÍGONO">
			<div>
				<input type="checkbox" id="closedistance" class="switch" />
				<label for="closedistance"> 
					&nbsp;&nbsp;Total de reportes
				</label>
				<input type="text" id="amountReports" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 3px!important; text-align: center; " disabled/>
				<div id="slider-closedistance" style="width: 126px; margin-left: 70px!important;"></div>
			</div>
			<img class="imgDist" src="images/polygonrad.png" alt="RADIO">
			<div>
				<input type="checkbox" id="radius" class="switch" />
				<label for="radius"> 
					&nbsp;&nbsp;Total de metros
				</label>
			</div>
			
			<input type="text" id="radiusval" class="rangevalue" style="float:left; margin-right: 60%; width: 52px!important; margin-left: 9px!important; text-align: center; " disabled/>
			<div id="slider-radius" style="width: 126px; margin-left: 77px!important;"></div>
			<img class="imgDist" src="images/polygons.png" alt="POLÍGONO">
			<div>
				<input type="checkbox" id="polyfilter" class="switch" />
				<label for="polyfilter"> 
					&nbsp;&nbsp;Crear polígonos
				</label>
			</div>
	     </div>
	</div>
	</div>

	<!-- G+ SIGN-IN DIV -->
	<div id="gplus" style="z-index: 10;position: absolute;margin-left: 20px; bottom: 2px;">
			<div id="gConnect">
			    <button class="g-signin"
			        data-scope="https://www.googleapis.com/auth/plus.login"
			        data-requestvisibleactions="http://schemas.google.com/AddActivity"
			        data-clientId="849012671873.apps.googleusercontent.com"
			        data-callback="onSignInCallback"
			        data-theme="dark"
			        data-cookiepolicy="single_host_origin">
			    </button>
			</div>
			<div id="authOps" style="display:none">
			    <h2  style="display:none">User is now signed in to the app using Google+</h2>
			    <p  style="display:none">If the user chooses to disconnect, the app must delete all stored
			    information retrieved from Google for the given user.</p>
			    <button id="disconnect" class="logout danger"></button>
			    
			    <h2  style="display:none">User's profile information</h2>
			    <div id="profile" style="position:absolute;bottom:-23px;height:40px"></div>
			
			    <h2  style="display:none">User's friends that are visible to this app</h2>
			    <div id="visiblePeople"  style="display:none"></div>
			
			    <h2  style="display:none">Authentication Logs</h2>
			    <pre id="authResult"  style="display:none"></pre>
			</div>
			<div id="loaderror">
			    This section will be hidden by JQuery. If you can see this message, you
			    may be viewing the file rather than running a web server.<br />
			    The sample must be run from http or https. See instructions at
			    <a href="https://developers.google.com/+/quickstart/javascript">
			    https://developers.google.com/+/quickstart/javascript</a>.
			</div>
	</div>
	
<!-- DISQUS -->

<script type="text/javascript">
/* * * DON'T EDIT BELOW THIS LINE * * */
(function () {
var s = document.createElement('script'); s.async = true;
s.type = 'text/javascript';
s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
(document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
}());
</script>


<!-- Chartbeat -->


<script type="text/javascript">
var _sf_async_config={};
/** CONFIGURATION START **/
_sf_async_config.uid = 36826;
_sf_async_config.domain = "cic.mx";
/** CONFIGURATION END **/
(function(){
 function loadChartbeat() {
   window._sf_endpt=(new Date()).getTime();
   var e = document.createElement("script");
   e.setAttribute("language", "javascript");
   e.setAttribute("type", "text/javascript");
   e.setAttribute('src', '//static.chartbeat.com/js/chartbeat.js');
   document.body.appendChild(e);
 }
 var oldonload = window.onload;
 window.onload = (typeof window.onload != "function") ?
    loadChartbeat : function() { oldonload(); loadChartbeat(); };
})();
</script>	



</body>

<!--			***

	END OF BODY

***				-->


<!-- G+ SIGN-IN SCRIPTS-->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script');
    po.type = 'text/javascript'; po.async = true;
    po.src = 'https://plus.google.com/js/client:plusone.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
  })();
  </script>





<script type="text/javascript">
var helper = (function() {
  var BASE_API_PATH = 'plus/v1/';

  return {
    /**
     * Hides the sign in button and starts the post-authorization operations.
     *
     * @param {Object} authResult An Object which contains the access token and
     *   other authentication information.
     */
    onSignInCallback: function(authResult) {
      gapi.client.load('plus','v1', function(){
        $('#authResult').html('Auth Result:<br/>');
        for (var field in authResult) {
          $('#authResult').append(' ' + field + ': ' +
              authResult[field] + '<br/>');
        }
        if (authResult['access_token']) {
          $('#authOps').show('slow');
          $('#gConnect').hide();
          helper.profile();
          helper.people();
        } else if (authResult['error']) {
          // There was an error, which means the user is not signed in.
          // As an example, you can handle by writing to the console:
          console.log('There was an error: ' + authResult['error']);
          $('#authResult').append('Logged out');
          $('#authOps').hide('slow');
          $('#gConnect').show();
        }
        //console.log('authResult', authResult);
      });
    },

    /**
     * Calls the OAuth2 endpoint to disconnect the app for the user.
     */
    disconnect: function() {
      // Revoke the access token.
      $.ajax({
        type: 'GET',
        url: 'https://accounts.google.com/o/oauth2/revoke?token=' +
            gapi.auth.getToken().access_token,
        async: false,
        contentType: 'application/json',
        dataType: 'jsonp',
        success: function(result) {
          console.log('revoke response: ' + result);
          $('#gplus').css("bottom","-=31"); 
          $('#authOps').hide();
          $('#profile').empty();
          $('#visiblePeople').empty();
          $('#authResult').empty();
          $('#gConnect').show();
        },
        error: function(e) {
          console.log(e);
        }
      });
    },

    /**
     * Gets and renders the list of people visible to this app.
     */
    people: function() {
      var request = gapi.client.plus.people.list({
        'userId': 'me',
        'collection': 'visible'
      });
      request.execute(function(people) {
        $('#visiblePeople').empty();
        $('#visiblePeople').append('Number of people visible to this app: ' +
            people.totalItems + '<br/>');
        for (var personIndex in people.items) {
          person = people.items[personIndex];
          $('#visiblePeople').append('<img src="' + person.image.url + '">');
        }
      });
    },

    /**
     * Gets and renders the currently signed in user's profile data.
     */
    profile: function(){
      var request = gapi.client.plus.people.get( {'userId' : 'me'} );
      request.execute( function(profile) {
        console.log('Profile',profile);
        $('#profile').empty();
        if (profile.error) {
          $('#profile').append(profile.error);
          return;
        }
        $('#profile').append(
            $('<p><img src=\"' + profile.image.url + '\" height="40" width="40"></p>'));
        $('#gplus').css("bottom","+=31");  
        /*$('#profile').append(
            $('<p>Hello ' + profile.displayName + '!<br />Tagline: ' +
            profile.tagline + '<br />About: ' + profile.aboutMe + '</p>'));
        if (profile.cover && profile.coverPhoto) {
          $('#profile').append(
              $('<img src=\"' + profile.cover.coverPhoto.url + '\">'));
        }*/
      });
    }
  };
})();

/**
 * jQuery initialization
 */
$(document).ready(function() {
  $('#disconnect').click(helper.disconnect);
  $('#loaderror').hide();
  if ($('[data-clientid="YOUR_CLIENT_ID"]').length > 0) {
    alert('This sample requires your OAuth credentials (client ID) ' +
        'from the Google APIs console:\n' +
        '    https://code.google.com/apis/console/#:access\n\n' +
        'Find and replace YOUR_CLIENT_ID with your client ID.'
    );
  }
});

/**
 * Calls the helper method that handles the authentication flow.
 *
 * @param {Object} authResult An Object which contains the access token and
 *   other authentication information.
 */
function onSignInCallback(authResult) {
  helper.onSignInCallback(authResult);
}
</script>
</html>
